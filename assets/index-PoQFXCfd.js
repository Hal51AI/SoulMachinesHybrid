(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var P=function(){function t(){this._callbacks=[]}return t.prototype.addListener=function(e){this._callbacks.push(e)},t.prototype.removeListener=function(e){var n=this._callbacks.indexOf(e);n>-1&&this._callbacks.splice(n,1)},t.prototype.call=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._callbacks.forEach(function(r){r.apply(r,e)},this)},t}(),Ze=function(){function t(e,n){this._scene=e,this._personaId=n,this._scene.onConversationResultEvents[n]||(this._scene.onConversationResultEvents[n]=new P),this._onConversationResultEvent=this._scene.onConversationResultEvents[n],this._scene.onSpeechMarkerEvents[n]||(this._scene.onSpeechMarkerEvents[n]=new P),this._onSpeechMarkerEvent=this._scene.onSpeechMarkerEvents[n]}return t.prototype.startSpeaking=function(e,n,r){n===void 0&&(n=null),r===void 0&&(r=null);var i={personaId:this._personaId,text:e};return n&&(i.context=n),r&&(i.optionalArgs=r),this._scene.sendRequest("startSpeaking",i)},t.prototype.stopSpeaking=function(){var e={personaId:this._personaId};return this._scene.sendRequest("stopSpeaking",e)},t.prototype.conversationSend=function(e,n,r){var i={personaId:this._personaId,text:e,variables:n,optionalArgs:r};return this._scene.sendRequest("conversationSend",i)},t.prototype.conversationSetVariables=function(e){var n={personaId:this._personaId,variables:e};return this._scene.sendRequest("conversationSetVariables",n)},t.prototype.conversationGetVariables=function(){var e={personaId:this._personaId};return this._scene.sendRequest("conversationGetVariables",e)},t.prototype.animateToNamedCameraWithOrbitPan=function(e,n,r,i,o,a){var u={personaId:this._personaId,cameraName:e,time:n,orbitDegX:r,orbitDegY:i,panDeg:o,tiltDeg:a};return this._scene.sendRequest("animateToNamedCamera",u)},t.prototype.playAnimation=function(e){var n={personaId:this._personaId,animation:e};return this._scene.sendRequest("playAnimation",n)},t.prototype.getVariables=function(e,n,r){n===void 0&&(n=!1),r===void 0&&(r="");var i={personaId:this._personaId,names:e,errorTolerant:n,format:r};return this._scene.sendRequest("getVariables",i)},t.prototype.setVariables=function(e){var n={personaId:this._personaId,Variables:e};return this._scene.sendRequest("setVariables",n)},t.prototype.setVariablesOneway=function(e){var n={personaId:this._personaId,Variables:e};this._scene.sendOnewaySceneRequest("setVariables",n)},t.prototype.getVariablesList=function(){var e={personaId:this._personaId};return this._scene.sendRequest("getVariablesList",e)},t.prototype.getModelVariablesList=function(e){var n={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelVariablesList",n)},t.prototype.getModelChildren=function(e){var n={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelChildren",n)},t.prototype.getModelFilterSearchResult=function(e){var n={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelFilterSearchResult",n)},t.prototype.getModelVariableFilterSearchResult=function(e){var n={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelVariableFilterSearchResult",n)},t.prototype.getConnectorEntries=function(e){var n={personaId:this._personaId,model:e};return this._scene.sendRequest("getConnectorEntries",n)},t.prototype.startBlProfiling=function(){var e={personaId:this._personaId};return this._scene.sendRequest("startBlProfiling",e)},t.prototype.stopBlProfiling=function(e){var n={personaId:this._personaId,reverse:e};return this._scene.sendRequest("stopBlProfiling",n)},t.prototype.getModelHierarchy=function(e){var n={personaId:this._personaId,model:e};return this._scene.sendRequest("getModelHierarchy",n)},t.prototype.createMonitorSet=function(e,n){var r={personaId:this._personaId,setName:[{SetName:e}],variables:n};return this._scene.sendRequest("createMonitorSet",r)},t.prototype.removeMonitorSet=function(e){var n={personaId:this._personaId,setName:[{SetName:e}]};return this._scene.sendRequest("removeMonitorSet",n)},t.prototype.addVariableToMonitorSet=function(e,n){var r={personaId:this._personaId,setName:[{SetName:e}],variables:n};return this._scene.sendRequest("addVariableToMonitorSet",r)},t.prototype.removeVariableFromMonitorSet=function(e,n){var r={personaId:this._personaId,setName:[{SetName:e}],variables:n};return this._scene.sendRequest("removeVariableFromMonitorSet",r)},t.prototype.renderModel=function(e){var n={personaId:this._personaId,modelName:e};return this._scene.sendRequest("renderModel",n)},Object.defineProperty(t.prototype,"onConversationResultEvent",{get:function(){return this._onConversationResultEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onSpeechMarkerEvent",{get:function(){return this._onSpeechMarkerEvent},enumerable:!1,configurable:!0}),t}(),Pt=function(t,e){return Pt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Pt(t,e)};function Zr(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Pt(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var x=function(){return x=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},x.apply(this,arguments)};function ei(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function T(t,e,n,r){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(l){try{s(r.next(l))}catch(f){a(f)}}function c(l){try{s(r.throw(l))}catch(f){a(f)}}function s(l){l.done?o(l.value):i(l.value).then(u,c)}s((r=r.apply(t,e||[])).next())})}function S(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(s){return function(l){return c([s,l])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(n=0)),n;)try{if(r=1,i&&(o=s[0]&2?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=e.call(t,n)}catch(l){s=[6,l],i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}function K(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Lt(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o}function Dt(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var Se=function(){function t(){var e=this;this.state="pending",this.fate="unresolved",this.promise=new Promise(function(n,r){e._resolve=n,e._reject=r}),this.promise.then(function(){return e.state="fulfilled"},function(){return e.state="rejected"})}return t.prototype.resolve=function(e){if(this.fate==="resolved"){console.error("Deferred cannot be resolved twice");return}this.fate="resolved",this._resolve(e)},t.prototype.reject=function(e){if(this.fate==="resolved"){console.error("Deferred cannot be resolved twice");return}this.fate="resolved",this._reject(e)},t.prototype.isResolved=function(){return this.fate==="resolved"},t.prototype.isPending=function(){return this.state==="pending"},t.prototype.isFulfilled=function(){return this.state==="fulfilled"},t.prototype.isRejected=function(){return this.state==="rejected"},t}(),ct=function(){function t(){this._hasMicrophone=!1,this._hasCamera=!1,this._isAndroid=!1,this._isBrowserSupported=!1,this._isEdge=!1,this._isIos=!1,this._isAndroid=this.detectAndroid(),this._isEdge=this.detectEdge(),this._isIos=this.detectIos()}return t.prototype.detectEdge=function(){return this.userAgentMatches("Edge")},t.prototype.detectAndroid=function(){return this.userAgentMatches("Android")},t.prototype.detectIos=function(){var e=(/iPad|iPhone|iPod/i.test(navigator.platform)||navigator&&navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream;return e},t.prototype.userAgentMatches=function(e){var n=window.navigator.userAgent,r=n.match(e);return r?r.length>0:!1},t.prototype.detectWebRTCFeatures=function(){var e=this;return new Promise(function(n,r){window.SmIsUnderRuntimeHost&&(e._isBrowserSupported=!0,e._hasMicrophone=!0,e._hasCamera=!0,n(e));var i=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(s){i||s in window&&(i=!0)});var o=navigator.userAgent.match(/iPhone|iPad|iPod/i)&&!window.MSStream,a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);i&&o&&!a&&(i=!1),e._isBrowserSupported=i,e._isBrowserSupported||n(e);var u=null;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(u=function(s){Promise.resolve(navigator.mediaDevices.enumerateDevices()).then(function(l){l===void 0&&(l=[]),s(l)}).catch(function(){s([])})});var c=window.MediaStreamTrack;!u&&c&&c.getSources&&(u=c.getSources.bind(c)),!u&&navigator.enumerateDevices&&(u=navigator.enumerateDevices.bind(navigator)),u?u(function(s){s.forEach(function(l){l.kind==="audioinput"&&(e._hasMicrophone=!0),l.kind==="videoinput"&&(e._hasCamera=!0)}),n(e)}):n(e)})},Object.defineProperty(t.prototype,"hasMicrophone",{get:function(){return this._hasMicrophone},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCamera",{get:function(){return this._hasCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAndroid",{get:function(){return this._isAndroid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBrowserSupported",{get:function(){return this._isBrowserSupported},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEdge",{get:function(){return this._isEdge},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isIos",{get:function(){return this._isIos},enumerable:!1,configurable:!0}),t}(),dn=["debug","log","warn","error"],H=function(){function t(e,n){e===void 0&&(e="log"),n===void 0&&(n=!0),this.isEnabled=n,this.availableLogLevels=[],this._minLogLevel="log",this.setMinLogLevel(e)}return t.prototype.log=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.isEnabled&&this.availableLogLevels.includes(e)&&console[e].apply(console,Dt([],Lt(n),!1))},t.prototype.enableLogging=function(e){this.isEnabled=e},t.prototype.getMinLogLevel=function(){return this._minLogLevel},t.prototype.setMinLogLevel=function(e){var n=dn.indexOf(e);this._minLogLevel=e,this.availableLogLevels=dn.slice(n)},t}();function m(t,e){var n=new Error(t);return n.name=e,n}var ti=function(){function t(e,n){n===void 0&&(n=new H);var r=this;this.logger=n,this._isMicrophoneConnected=!1,this._isCameraConnected=!1,this._onConnectedStorage=function(i,o,a,u){},this._closed=!1,this._outgoingQueue=[],this._microphoneMuteDelay=-1,this._offsetX=0,this._offsetY=0,e&&(this._viewport_element=e),window.SmRuntimeHostReceiveMessage=this.receiveMessage.bind(this),typeof window.SmRuntimeHostStyleViewportElement=="function"&&window.SmRuntimeHostStyleViewportElement(this._viewport_element),this._onClose=function(i){},this._onMessage=function(i){},this._onUserText=function(i){},this.sendVideoBounds(0,0),setTimeout(function(){r.sendVideoBounds(0,0)},3e3),this._features=new ct,this.log("Local session created!")}return t.prototype.receiveMessage=function(e){var n,r,i=JSON.parse(e);this.log("message received: ".concat(e)),this._onMessage(i),i.name==="state"&&i.category==="scene"&&((r=(n=i.body)===null||n===void 0?void 0:n.session)===null||r===void 0?void 0:r.state)==="idle"&&(this.log("Local session ending - conversationEnded"),this.close(!0,"conversationEnded"))},Object.defineProperty(t.prototype,"onConnected",{set:function(e){this._onConnectedStorage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loggingEnabled",{get:function(){return this.logger.isEnabled},set:function(e){this.logger.log("warn","loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)"),this.logger.enableLogging(e)},enumerable:!1,configurable:!0}),t.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},t.prototype.setLogging=function(e){this.logger.enableLogging(e)},t.prototype.log=function(e){this.logger.log("log",e)},t.prototype.sendVideoBounds=function(e,n){var r=this;setTimeout(function(){var i=r._viewport_element;if(i){var o=document.defaultView||window,a=parseInt(o.getComputedStyle(i).width,10),u=parseInt(o.getComputedStyle(i).height,10);for(r._offsetX=0,r._offsetY=0;i&&!isNaN(i.offsetLeft)&&!isNaN(i.offsetTop);)r._offsetX+=i.offsetLeft-i.scrollLeft,r._offsetY+=i.offsetTop-i.scrollTop,i=i.offsetParent;if(document.documentElement){var c=document.documentElement.scrollLeft,s=document.documentElement.scrollTop;r._offsetX-=c,r._offsetY-=s}r.log("Updating bounds: x =  ".concat(r._offsetX," , y = ").concat(r._offsetY,"', w = ").concat(a,", h = ").concat(u));var l=r._offsetY,f=r._offsetX,d=r._offsetY+u,h=r._offsetX+a,v={name:"videoBounds",body:{top:l,left:f,bottom:d,right:h},category:"local",kind:"event"};r.sendMessage(v)}},0)},t.prototype.hideVideo=function(){var e=0,n=0,r=0,i=0,o={name:"videoBounds",body:{top:e,left:n,bottom:r,right:i},category:"local",kind:"event"};this.sendMessage(o)},t.prototype.sendRtcEvent=function(e,n){},t.prototype.connect=function(){return T(this,void 0,void 0,function(){var e,n,r,i=this;return S(this,function(o){switch(o.label){case 0:return e=new Se,this.log("Local session connecting!"),this._closed=!1,[4,this._features.detectWebRTCFeatures()];case 1:return n=o.sent(),this._closed=!1,this._sessionId=void 0,this._isMicrophoneConnected=n.hasMicrophone,this._isCameraConnected=n.hasCamera,typeof window.local_websocket_port=="number"?(this._serverConnection=new WebSocket("ws://localhost:"+window.local_websocket_port),this.log("websocket open"),this._serverConnection.onmessage=function(a){i.gotMessageFromServer(a)},this._serverConnection.onerror=function(a){e.isPending()&&e.reject(m("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(a){window.SmRuntimeHostReceiveMessage=function(){},i.log("Local session connected!");for(var u=0;u<i._outgoingQueue.length;u++)i._serverConnection.send(JSON.stringify(i._outgoingQueue[u])),i.logger.log("log","SmLocalSession.prototype.sendMessage, forwarding message to Web Socket: "+i._outgoingQueue[u]);i._outgoingQueue=[],e.isPending()&&e.resolve()},this._serverConnection.onclose=function(a){i.logger.log("log","websocket closed: code(".concat(a.code,"), reason(").concat(a.reason,"), clean(").concat(a.wasClean,")")),e.isRejected||i.close(!1,"normal")}):(this.log("local_websocket_port not found! Failed to create WebSocket"),e.isPending()&&e.reject(m("websocket failed","local_websocket_port not found"))),r={name:"startSession",body:{},category:"scene",kind:"request"},this.sendMessage(r),[2,e.promise]}})})},t.prototype.gotMessageFromServer=function(e){var n=e.data,r=JSON.parse(n),i=r.category,o=r.name,a=r.body;i!=="webrtc"?this._onMessage(r):o==="close"&&this.close(!1,a.reason),o==="state"&&i==="scene"&&a.session!==null&&a.session!==void 0&&a.session.state==="idle"&&(this.log("Local session ending due to server idle message"),this.close(!0,"conversationEnded"))},t.prototype.sendMessage=function(e){var n=JSON.stringify(e);this._serverConnection&&this._serverConnection.readyState===WebSocket.OPEN?(this._serverConnection.send(n),this.log("SmLocalSession.prototype.sendMessage, forwarding message to Web Socket: ".concat(n))):this._outgoingQueue.push(e)},t.prototype.sendUserText=function(e){this.logger.log("log","SmLocalSession.prototype.sendUserText, discarding text: "+e)},t.prototype.close=function(e,n){if(n===void 0&&(n="normal"),!this._closed&&(this._closed=!0,this._onClose(n),this._isMicrophoneConnected=!1,this._isCameraConnected=!1,this.hideVideo(),this._serverConnection)){this.log("closing server connection");var r=1e3;this._serverConnection.close(r,n)}},Object.defineProperty(t.prototype,"peerConnection",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userMediaStream",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMicrophoneConnected",{get:function(){return this._isMicrophoneConnected},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCameraConnected",{get:function(){return this._isCameraConnected},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneMuteDelay",{get:function(){return this._microphoneMuteDelay},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneMuted",{get:function(){return typeof window.SmRuntimeHostIsMicrophoneMuted=="function"?window.SmRuntimeHostIsMicrophoneMuted():!1},set:function(e){typeof window.SmRuntimeHostMuteMicrophone=="function"&&window.SmRuntimeHostMuteMicrophone(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){return this._offsetX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return this._offsetY},enumerable:!1,configurable:!0}),t.prototype.isMicrophoneActive=function(){return this.isMicrophoneConnected&&!this.microphoneMuted},t.prototype.isCameraActive=function(){return this.isCameraConnected},t.prototype.setMediaDeviceActive=function(e){return e.microphone,e.camera,T(this,void 0,void 0,function(){return S(this,function(n){throw m("setMediaDeviceActive not supported on LocalSession","notSupported")})})},t}(),ni=function(t){Zr(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n.requestName="",n.status=0,n}return Object.defineProperty(e.prototype,"message",{get:function(){return"Scene response failed, status: ".concat(this.status)},enumerable:!1,configurable:!0}),e}(Error),p;(function(t){t[t.None=0]="None",t[t.Microphone=1]="Microphone",t[t.MicrophoneAndCamera=2]="MicrophoneAndCamera",t[t.Camera=3]="Camera"})(p||(p={}));var Ut;(function(t){t.PAGE_METADATA="PAGE_METADATA"})(Ut||(Ut={}));var k;(function(t){t.Disconnected="Disconnected",t.SearchingForDigitalPerson="SearchingForDigitalPerson",t.DownloadingAssets="DownloadingAssets",t.ConnectingToDigitalPerson="ConnectingToDigitalPerson",t.Connected="Connected"})(k||(k={}));var ri=function(){function t(e,n,r,i,o,a,u,c,s,l){var f=this;this._connectPendingRemoteStream=null,this._resumeRequested=!1,this._isResumedSession=!1,this._outgoingQueue=[],this._controlOpen=!1,this._controlQueue=[],this._requestedUserMedia=p.None,this._requiredUserMedia=p.None,this._onConnected=function(d,h,v,y){},this._pendingLog=[],this._closed=!1,this._shouldLogToServer=!1,this._microphoneMuteDelay=-1,this._changeUserMediaQueue=new Array,this._removeListeners=new Array,this._videoOptions={frameRate:10,width:640,height:480,facingMode:"user"},this._audioOptions={noiseSuppression:!1,autoGainControl:!1,channelCount:1,sampleRate:16e3,sampleSize:16,echoCancellation:!0},this._videoElement=e,this._serverUri=n,this._connectUserText=r||"",this._accessToken=i,this._audioOnly=o,this._audioOptions.echoCancellation=c,this._requiredUserMedia=u,this._requestedUserMedia=a,this._logger=s,this._onClose=function(d){},this._onMessage=function(d){},this._onUserText=function(d){},this._sessionError=function(d){f.log("session error: ".concat(d),"error")},this._features=new ct,this._connectionState=l}return Object.defineProperty(t.prototype,"onConnected",{set:function(e){this._onConnected=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loggingEnabled",{get:function(){return this._logger.isEnabled},set:function(e){this.log("loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)","warn"),this._logger.enableLogging(e)},enumerable:!1,configurable:!0}),t.prototype.setMinLogLevel=function(e){this._logger.setMinLogLevel(e)},t.prototype.setLogging=function(e){this._logger.enableLogging(e)},t.prototype.log=function(e,n){if(n===void 0&&(n="debug"),this._logger.isEnabled){var r=new Date,i="smsdk: ".concat(r.toISOString(),": ").concat(e);this._shouldLogToServer&&this.logToServer(i),this._logger.log(n,i)}},t.prototype.logToServer=function(e){this.sessionId?this.sendlogMessage([e]):this._pendingLog.push(e)},t.prototype.sendlogMessage=function(e){if(this._sessionId&&e&&e.length>0){var n={category:"diagnostics",kind:"event",name:"log",body:{name:"browser",text:e}};this.sendMessage(n)}},t.prototype.connect=function(e){return T(this,void 0,void 0,function(){var n,r,i=this;return S(this,function(o){return n=new Se,this._closed=!1,e&&(this._connectUserText=e),this._serverUri&&(this._serverUri.startsWith("ws:")||this._serverUri.startsWith("wss:"))?(this.selectUserMedia(this._requestedUserMedia,this._requiredUserMedia,n,this.getUserMediaSuccess.bind(this)),[2,n.promise]):(r=new XMLHttpRequest,r.open("GET","/api/jwt"+window.location.search),r.onreadystatechange=function(a){return T(i,void 0,void 0,function(){var u;return S(this,function(c){return r.readyState===XMLHttpRequest.DONE&&(r.status===200?(this.log("JWT request returned: ".concat(r.responseText)),u=JSON.parse(r.responseText),this._serverUri=u.url,this._accessToken=u.jwt,this.selectUserMedia(this._requestedUserMedia,this._requiredUserMedia,n,this.getUserMediaSuccess.bind(this))):(this.log("JWT Request failed, status: ".concat(r.statusText),"error"),n.reject(m("Failed to acquire jwt at /api/jwt","noServer")))),[2]})})},r.send(),[2,n.promise])})})},t.prototype.webcamRequested=function(e,n){return!this._audioOnly&&[p.MicrophoneAndCamera,p.Camera].some(function(r){return[e,n].includes(r)})},t.prototype.micRequested=function(e,n){return[p.Microphone,p.MicrophoneAndCamera].some(function(r){return[e,n].includes(r)})},t.prototype.getMediaConstraints=function(e,n){var r=navigator.mediaDevices.getSupportedConstraints();return this.log("Browser supports media constraints: ".concat(r)),{audio:this.micRequested(e,n)?this.buildAudioOptions():!1,video:this.webcamRequested(e,n)?this._videoOptions:!1}},t.prototype.buildAudioOptions=function(){var e=navigator.mediaDevices.getSupportedConstraints(),n=x({},this._audioOptions);return Object.keys(n).forEach(function(r){e[r]||delete n[r]}),n},t.prototype.selectUserMedia=function(e,n,r,i){var o=this;if(e===p.None&&n===p.None){i(null,r);return}if(navigator.mediaDevices.getUserMedia){var a=this.getMediaConstraints(e,n);this.log("Best video constraints: ".concat(a)),navigator.mediaDevices.getUserMedia(a).then(function(u){i(u,r)}).catch(function(u){n===e?(o.log("getUserMedia could not get required media, error given: ".concat(u),"error"),r.reject(o.MakeErrorForUserMedia(u))):n!==p.None?o.getUserMediaRequiredOnlyFallback(n,r,i):e===p.MicrophoneAndCamera?o.getUserMediaAudioOnlyFallback(r,i):i(null,r)})}else r.reject(m("Your browser does not support getUserMedia API","notSupported"))},t.prototype.getUserMediaRequiredOnlyFallback=function(e,n,r){var i=this;this.log("Retrying with required media only");var o=this.getMediaConstraints(p.None,e);return this.log("Attempt constraints: ".concat(o)),navigator.mediaDevices.getUserMedia(o).then(function(a){r(a,n)}).catch(function(a){i.log("getUserMedia could not get required media, error given: ".concat(a),"error"),n.reject(i.MakeErrorForUserMedia(a))})},t.prototype.getUserMediaAudioOnlyFallback=function(e,n){var r=this;this.log("Retrying with microphone only");var i={video:!1,audio:this.buildAudioOptions()};return this.log("Attempt constraints: ".concat(i)),navigator.mediaDevices.getUserMedia(i).then(function(o){n(o,e)}).catch(function(o){r.log("getUserMedia could not get microphone audio, error given: ".concat(o),"error"),n(null,e)})},t.prototype.MakeErrorForUserMedia=function(e){var n="noUserMedia";return m(e.message,n)},t.prototype.getUserMediaSuccess=function(e,n){var r=this;this.log("Got user media"),this._localStream=e,this.microphoneMuted=!0,this.log("connecting to: ".concat(this._serverUri)),this._accessToken?this._serverConnection=new WebSocket(this._serverUri+"?access_token="+this._accessToken):this._serverConnection=new WebSocket(this._serverUri),this._serverConnection.onmessage=function(i){try{r.gotMessageFromServer(i,n)}catch(o){r.log("unexpected exception processing received message: ".concat(o),"error")}},this._serverConnection.onerror=function(i){n.isPending()&&n.reject(m("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(i){r.log("Websocket open"),r._connectionState.setConnectionState(k.SearchingForDigitalPerson)},this._serverConnection.onclose=function(i){r.log("websocket closed: code(".concat(i.code,"), reason(").concat(i.reason,"), clean(").concat(i.wasClean,")")),n.isRejected||r.close(!1,"normal",n)}},t.prototype.hasTurnServer=function(e){var n,r,i,o;if(!e)return!1;try{for(var a=K(e),u=a.next();!u.done;u=a.next()){var c=u.value;if(!(!c||!c.urls))try{for(var s=(i=void 0,K(c.urls)),l=s.next();!l.done;l=s.next()){var f=l.value;if(f.indexOf("turn:")===0)return!0}}catch(d){i={error:d}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}}catch(d){n={error:d}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return!1},t.prototype.gotMessageFromServer=function(e,n){var r=this,i,o,a=e.data;this.log("message received: ".concat(a));var u=JSON.parse(a),c=u.category,s=u.name,l=u.body;if(c!=="webrtc"){this._controlConnection!==null&&c==="scene"&&(this._controlOpen&&this._serverConnection.readyState===WebSocket.OPEN?this._controlConnection.send(a):this._controlQueue.push(a)),this._onMessage(u);return}if(u.kind==="event")if(s==="established"){this._connectionState.setConnectionState(k.DownloadingAssets);var f={iceServers:[]};if(l.iceServers&&(f.iceServers=l.iceServers,this.hasTurnServer(l.iceServers)&&(this.log("Detected turn server, forcing relay mode"),f.iceTransportPolicy="relay")),this.log("selected ice servers: ".concat(f.iceServers)),l.settings&&typeof l.settings.microphoneMuteDelay=="number"&&(this._microphoneMuteDelay=l.settings.microphoneMuteDelay),this.log("microphone mute delay after persona speech: ".concat(this._microphoneMuteDelay)),this._shouldLogToServer=(o=(i=l.settings)===null||i===void 0?void 0:i.logToServer)!==null&&o!==void 0?o:!1,this._peerConnection=new RTCPeerConnection(f),this._peerConnection.onicecandidate=this.gotIceCandidate.bind(this),"ontrack"in this._peerConnection&&!this._features.isEdge?(this._peerConnection.ontrack=function(E){(E.track.kind==="video"||E.track.kind==="audio")&&(!r._remoteStream||!r._audioOnly&&E.track.kind==="video")&&r.onRemoteStream(E.streams[0])},this._videoElement.addEventListener("loadeddata",this.onVideoLoaded.bind(this)),this._removeListeners.push({target:this._videoElement,name:"loadeddata",callback:this.onVideoLoaded})):this._peerConnection.onaddstream=function(E){r.onRemoteStream(E.stream)},this._peerConnection.oniceconnectionstatechange=function(E){r.log("ICE connection state: ".concat(r._peerConnection.iceConnectionState)),r._peerConnection.iceConnectionState==="failed"&&(m("ice connection failed","mediaStreamFailed"),n&&n.isPending()&&(r._serverConnection.close(),r._controlConnection&&(r._controlConnection.readyState===WebSocket.OPEN||r._controlConnection.readyState===WebSocket.CONNECTING)&&r._controlConnection.close(),n.reject(m("ice connection failed","mediaStreamFailed"))))},this.log("adding local media stream if any"),this._localStream)if(!this._peerConnection.addTrack)this._peerConnection.addStream(this._localStream),this.log("adding local media stream by stream");else try{this.log("adding local media stream by track"),this._localStream.getTracks().forEach(function(E){r._peerConnection.addTrack(E,r._localStream)})}catch(E){this.log("error: ".concat(E),"error")}if(this._peerConnection.addTransceiver("audio",{direction:"sendrecv"}),this._peerConnection.addTransceiver("video",{direction:"sendrecv"}),l.resumeSessionId){var d={voiceActivityDetection:!1,iceRestart:!0};this._sessionId=l.resumeSessionId,this._isResumedSession=!0,this.log("established, trying to resume session with session_id = ".concat(l.resumeSessionId)),this.createOffer(this._peerConnection,d).then(function(E){r.createdDescription.bind(r),r.createdDescription(E,"updateOffer")}).catch(this._sessionError.bind(this))}else{var d={voiceActivityDetection:!1,iceRestart:!1};this._isResumedSession=!1,this.createOffer(this._peerConnection,d).then(this.createdDescription.bind(this)).catch(this._sessionError.bind(this))}}else if(s==="accepted"){this._connectionState.setConnectionState(k.ConnectingToDigitalPerson),this.log("accepted, session_id = ".concat(l.sessionId)),this._sessionId=l.sessionId,this._resumeRequested=l.resumeRequested,this._server=l.server,this._sceneId=l.sceneId;for(var h=0;h<this._outgoingQueue.length;h++)this._outgoingQueue[h].body.sessionId=this._sessionId,this.sendMessage(this._outgoingQueue[h]);this._outgoingQueue=[];var v=function(){r&&r.sendCameraRotation()};window.addEventListener("orientationchange",v),this._removeListeners.push({target:window,name:"orientationchange",callback:v}),this.sendCameraRotation();var y=document.defaultView||window,O=y.getComputedStyle(this._videoElement),b=parseInt("".concat(O.width),10),A=parseInt("".concat(O.height),10);this.log("accepted, sending video width/height: ".concat(b," / ").concat(A)),this.sendVideoBounds(b,A),this.sendlogMessage(this._pendingLog),this._pendingLog=[],l.controlUrl&&(this._controlUrl=l.controlUrl,this._controlQueue=[],this._controlOpen=!1,this._controlConnection=new WebSocket(l.controlUrl+"?access_token="+this._accessToken),this._controlConnection.onmessage=function(E){var B=E.data;B&&r._serverConnection.readyState===WebSocket.OPEN&&r._serverConnection.send(B)},this._controlConnection.onerror=function(){r.close(!0,"controlFailed",n)},this._controlConnection.onopen=function(E){if(r.log("control websocket open"),!r._controlOpen){r._controlOpen=!0;for(var B=0;B<r._controlQueue.length;B++)r.log("control websocket now open, forwarding queued message: ".concat(r._controlQueue[B])),r._controlConnection.send(r._controlQueue[B]);r._controlQueue=[]}},this._controlConnection.onclose=function(E){r.log("control closed: code(".concat(E.code,"), reason(").concat(E.reason,"), clean(").concat(E.wasClean,")")),r.close(!0,"controlDisconnected",n)})}else if(s==="answer"){this.log("set remote description"),this.log(JSON.stringify(l));var C={sdp:l.sdp,type:"answer"};this.setRemoteDescription(this._peerConnection,C).then(function(){}).catch(this._sessionError.bind(this))}else if(s==="connected")this._remoteStream?(this._connectionState.setConnectionState(k.Connected),this.onConnectedSuccess(),n&&n.resolve(l.sessionId)):(this.log("Connected but no remote media stream available"),this._connectPendingRemoteStream=function(){r.onConnectedSuccess(),n&&n.resolve(l.sessionId)});else if(s==="ice"){this.log("add ice candidate");var w=void 0;if(l.complete)this._features.isEdge&&(w=this._peerConnection.addIceCandidate(new RTCIceCandidate({candidate:"",sdpMid:"",sdpMLineIndex:0})));else{var R=new RTCIceCandidate({candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex});w=this._peerConnection.addIceCandidate(R)}w&&w.catch(this._sessionError.bind(this))}else if(s==="offer"){this._sessionId=l.sessionId;var C={sdp:l.sdp,type:"offer"};this.setRemoteDescription(this._peerConnection,C).then(function(){return r.createAnswer(r._peerConnection)}).then(this.createdDescription.bind(this)).catch(this._sessionError.bind(this))}else s==="userText"?(this.log("rtc - user text message received: ".concat(l.userText)),this._onUserText(l.userText)):s==="close"&&this.close(!1,l.reason,n)},t.prototype.gotIceCandidate=function(e){e.candidate?(this.log("got local ice candidate"),this.sendRtcEvent("ice",{complete:!1,candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex})):(this.log("end ice candidate"),this.sendRtcEvent("ice",{complete:!0,candidate:"",sdpMid:"",sdpMLineIndex:0}))},t.prototype.createdDescription=function(e,n){var r=this;n===void 0&&(n="offer"),this.log("got description");var i={sdp:e.sdp,type:e.type};this.log(JSON.stringify({sdp:i})),this.setLocalDescription(this._peerConnection,e).then(function(){r.log("send sdp offer to server"),r.sendRtcEvent(n,{sdp:r._peerConnection.localDescription?r._peerConnection.localDescription.sdp:null,type:r._peerConnection.localDescription?r._peerConnection.localDescription.type:null,user_text:r._connectUserText,features:{videoStartedEvent:!0}})}).catch(this._sessionError.bind(this))},t.prototype.onRemoteStream=function(e){this.log("got remote stream"),this._remoteStream=e,this.log("ICE connection state: ".concat(this._peerConnection.iceConnectionState)),this._connectPendingRemoteStream&&(this._connectPendingRemoteStream(),this._connectPendingRemoteStream=null)},t.prototype.onConnectedSuccess=function(){var e=this,n,r;this._onConnected(this._resumeRequested,this._isResumedSession,this._server,this.sessionId),this._videoElement.hidden=!1,this._videoElement.srcObject=this._remoteStream;var i=function(o){return T(e,void 0,void 0,function(){return S(this,function(a){return this._remoteStream&&this._remoteStream.addTrack(o.track),[2]})})};this._peerConnection.addEventListener("track",i),this._removeListeners.push({target:this._peerConnection,name:"track",callback:i}),this.log("video enabled"),this.sendUserCamera(),(n=this._onMicrophoneActive)===null||n===void 0||n.call(this.isMicrophoneActive()),(r=this._onCameraActive)===null||r===void 0||r.call(this.isCameraActive())},t.prototype.onVideoLoaded=function(e){var n=this;this.log("video has loaded");var r=function(){n.log("video has started playing"),n.sendRtcEvent("videoStarted",{}),n.microphoneMuted=!1};if(!this._videoElement.muted){r();return}var i=function(){r(),n._videoElement.removeEventListener("volumechange",i)};this._videoElement.addEventListener("volumechange",i,!1)},t.prototype.sendRtcEvent=function(e,n){if(this._serverConnection!==null){this._sessionId&&(n.sessionId=this._sessionId);var r={category:"webrtc",kind:"event",name:e,body:n};this._sessionId||e==="offer"?this.sendMessage(r):this._outgoingQueue.push(r)}},t.prototype.sendVideoBounds=function(e,n){this.sendRtcEvent("videoBounds",{width:e,height:n})},t.prototype.sendUserCamera=function(e){var n={active:this.isCameraActive()};e!==void 0&&(n.rotation=e),this.sendRtcEvent("userCamera",n)},t.prototype.sendCameraRotation=function(){if(this._features.isIos){var e=window.orientation;this.log("send updated camera rotation, device orientation: ".concat(e));var n=0;e===0?n=90:e===90?n=180:e===180?n=270:e===-90&&(n=0),this.sendUserCamera(n)}},t.prototype.sendMessage=function(e){this._serverConnection&&(this._serverConnection.readyState===WebSocket.OPEN?this._serverConnection.send(JSON.stringify(e)):this.log("server connection not ready, discarding message: ".concat(e)))},t.prototype.sendUserText=function(e){this.sendRtcEvent("userText",{userText:e})},t.prototype.hasCamera=function(e){return e===p.Camera||e===p.MicrophoneAndCamera},t.prototype.hasMicrophone=function(e){return e===p.Microphone||e===p.MicrophoneAndCamera},t.prototype.makeUserMedia=function(e,n){return e&&n?p.MicrophoneAndCamera:e?p.Microphone:n?p.Camera:p.None},t.prototype.findSenderTrackByKind=function(e){var n,r,i;if(!this._peerConnection)return null;var o=this._peerConnection.getSenders();try{for(var a=K(o),u=a.next();!u.done;u=a.next()){var c=u.value;if(c.track&&((i=c.track)===null||i===void 0?void 0:i.kind)===e)return c.track}}catch(s){n={error:s}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return null},t.prototype.findSenderByKind=function(e){var n,r,i,o,a,u;if(!this._peerConnection)return null;try{for(var c=K(this._peerConnection.getTransceivers()),s=c.next();!s.done;s=c.next()){var l=s.value;if(l.direction==="sendrecv"&&((u=(a=l.receiver)===null||a===void 0?void 0:a.track)===null||u===void 0?void 0:u.kind)===e)return l.sender}}catch(v){n={error:v}}finally{try{s&&!s.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}try{for(var f=K(this._peerConnection.getSenders()),d=f.next();!d.done;d=f.next()){var h=d.value;if(h.track===null||h.track.kind===e)return h}}catch(v){i={error:v}}finally{try{d&&!d.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}return null},t.prototype.processChangeUserMediaQueue=function(){var e,n,r,i;return T(this,void 0,void 0,function(){var o,a,u,c;return S(this,function(s){switch(s.label){case 0:if(o=this._changeUserMediaQueue.length>0?this._changeUserMediaQueue[0]:void 0,!o)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),a=this.isMicrophoneActive(),u=this.isCameraActive(),[4,this.changeUserMediaInternal(this.makeUserMedia((e=o.microphone)!==null&&e!==void 0?e:a,(n=o.camera)!==null&&n!==void 0?n:u))];case 2:return s.sent(),o.microphone!==void 0&&o.microphone!==a&&((r=this._onMicrophoneActive)===null||r===void 0||r.call(this.isMicrophoneActive())),o.camera!==void 0&&o.camera!==u&&((i=this._onCameraActive)===null||i===void 0||i.call(this.isCameraActive())),o.deferred.resolve(),[3,4];case 3:return c=s.sent(),o.deferred.reject(c),[3,4];case 4:this._changeUserMediaQueue.shift(),s.label=5;case 5:if(o)return[3,0];s.label=6;case 6:return[2]}})})},t.prototype.changeUserMediaInternal=function(e){return T(this,void 0,void 0,function(){var n,r,i,o,a,u,c,s=this;return S(this,function(l){switch(l.label){case 0:return n=this.findSenderTrackByKind("audio"),r=this.findSenderTrackByKind("video"),i=this.hasMicrophone(e)&&(!n||n.readyState==="ended"),o=this.hasCamera(e)&&(!r||r.readyState==="ended"),a=null,i||o?(u=this.makeUserMedia(i,o),c=new Se,this.selectUserMedia(u,u,c,function(f,d){return T(s,void 0,void 0,function(){return S(this,function(h){return a=f,d.resolve(),[2]})})}),[4,c.promise]):[3,2];case 1:l.sent(),this._localStream||(this._localStream=new MediaStream),l.label=2;case 2:return[4,this.updateSenderTrack("audio",this.hasMicrophone(e),a)];case 3:return l.sent(),[4,this.updateSenderTrack("video",this.hasCamera(e),a)];case 4:return l.sent(),this.sendUserCamera(),[2]}})})},t.prototype.updateSenderTrack=function(e,n,r){var i,o;return T(this,void 0,void 0,function(){var a,u,c,s;return S(this,function(l){switch(l.label){case 0:if(a=this.findSenderByKind(e),u=a==null?void 0:a.track,!(a&&(!u||n!==u.enabled)))return[3,7];if(this.log("new user "+e+" active state = "+n),!n)return[3,6];l.label=1;case 1:return l.trys.push([1,4,,5]),u&&((i=this._localStream)===null||i===void 0||i.removeTrack(u)),r?(c=this.getTrackByKind(r,e),c?((o=this._localStream)===null||o===void 0||o.addTrack(c),a.track===c?[3,3]:(this.log("replacing user "+e+" track"),[4,a.replaceTrack(c)])):[3,3]):[3,3];case 2:l.sent(),l.label=3;case 3:return[3,5];case 4:throw s=l.sent(),this.log("failed to get user ".concat(e," track, error: ").concat(s),"error"),m("failed to get user "+e+": "+s,"failedUpgrade");case 5:return[3,7];case 6:u&&(u.enabled=!1,u.stop()),l.label=7;case 7:return[2]}})})},t.prototype.getTrackByKind=function(e,n){var r,i;if(e)try{for(var o=K(e.getTracks()),a=o.next();!a.done;a=o.next()){var u=a.value;if(u.kind===n)return u}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},t.prototype.isSenderTrackEnabled=function(e){var n=this.findSenderTrackByKind(e);return!!(n!=null&&n.enabled)},t.prototype.isMicrophoneActive=function(){return this.isSenderTrackEnabled("audio")},t.prototype.isCameraActive=function(){return this.isSenderTrackEnabled("video")},t.prototype.setMediaDeviceActive=function(e){var n=e.microphone,r=e.camera;return T(this,void 0,void 0,function(){var i;return S(this,function(o){return i=new Se,this._changeUserMediaQueue.push({microphone:n,camera:r,deferred:i}),this._changeUserMediaQueue.length===1&&this.processChangeUserMediaQueue(),[2,i.promise]})})},t.prototype.close=function(e,n,r){var i,o;if(e===void 0&&(e=!0),n===void 0&&(n="normal"),!this._closed){if(this._closed=!0,this._peerConnection)try{this._peerConnection.close()}catch(f){this.log("error: ".concat(f),"error")}if(this._localStream)try{var a=this._localStream.getTracks();for(var u in a)a[u].stop()}catch(f){this.log("error: ".concat(f),"error")}e&&this.sendRtcEvent("close",{reason:"normal"}),r&&(r.isResolved()?this._onClose(n):r.reject(m("websocket closed: "+n,n))),this._serverConnection&&(this.log("closing server connection"),this._serverConnection.close()),this._controlConnection&&this._controlConnection.close();try{for(var c=K(this._removeListeners),s=c.next();!s.done;s=c.next()){var l=s.value;l.target.removeEventListener(l.name,l.callback)}}catch(f){i={error:f}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}}},t.prototype.createOffer=function(e,n){return e.createOffer(n)},t.prototype.setRemoteDescription=function(e,n){return e.setRemoteDescription(n)},t.prototype.setLocalDescription=function(e,n){return e.setLocalDescription(n)},t.prototype.createAnswer=function(e){return e.createAnswer()},Object.defineProperty(t.prototype,"peerConnection",{get:function(){return this._peerConnection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"server",{get:function(){return this._server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sceneId",{get:function(){return this._sceneId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMicrophoneConnected",{get:function(){return!!this.findSenderTrackByKind("audio")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCameraConnected",{get:function(){return!!this.findSenderTrackByKind("video")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneMuteDelay",{get:function(){return this._microphoneMuteDelay},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userMediaStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneMuted",{get:function(){if(!this._localStream)return!0;var e=this._localStream.getAudioTracks();return!e||e.length<1?!0:!e[0].enabled},set:function(e){var n,r;if(this._localStream){var i=this._localStream.getAudioTracks();if(!(!i||i.length<1)){var o=this.findSenderByKind("audio");if(((n=o==null?void 0:o.track)===null||n===void 0?void 0:n.readyState)==="live"&&o.track===i[0]){var a=!e;i[0].enabled=a,this.log("microphone muted active notification: ".concat(a)),(r=this._onMicrophoneActive)===null||r===void 0||r.call(a)}}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"webcamMuted",{get:function(){if(!this._localStream)return!0;var e=this._localStream.getVideoTracks();return!e||e.length<1?!0:!e[0].enabled},set:function(e){var n,r;if(this._localStream){var i=this._localStream.getVideoTracks();if(!(!i||i.length<1)){var o=this.findSenderByKind("video");if(((n=o==null?void 0:o.track)===null||n===void 0?void 0:n.readyState)==="live"&&o.track===i[0]){var a=!e;i[0].enabled=a,(r=this._onCameraActive)===null||r===void 0||r.call(a)}}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneActiveCallbacks",{set:function(e){this._onMicrophoneActive=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraActiveCallbacks",{set:function(e){this._onCameraActive=e},enumerable:!1,configurable:!0}),t}(),ii=function(){function t(e,n,r){r===void 0&&(r=new H);var i=this;this.logger=r,this._outgoingQueue=[],this._onConnectedStorage=function(o,a,u,c){},this._pendingLog=[],this._closed=!1,this._shouldLogToServer=!1,this._serverUri=e,this._accessToken=n,this._onClose=function(o){},this._onMessage=function(o){},this._sessionError=function(o){i.logger.log("error","session error: ".concat(o))},this._features=new ct}return Object.defineProperty(t.prototype,"onConnected",{set:function(e){this._onConnectedStorage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loggingEnabled",{get:function(){return this.logger.isEnabled},set:function(e){this.logger.log("warn","loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)"),this.logger.enableLogging(e)},enumerable:!1,configurable:!0}),t.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},t.prototype.setLogging=function(e){this.logger.enableLogging(e)},t.prototype.log=function(e){this.loggingEnabled&&(this._shouldLogToServer?this.logToServer(e):this.logger.log("log",e))},t.prototype.logToServer=function(e){this.sessionId?this.sendlogMessage([e]):this._pendingLog.push(e)},t.prototype.sendlogMessage=function(e){if(this._sessionId&&e&&e.length>0){var n={category:"diagnostics",kind:"event",name:"log",body:{name:"browser",text:e}};this.sendMessage(n)}},t.prototype.connect=function(){return T(this,void 0,void 0,function(){var e;return S(this,function(n){return e=new Se,this._closed=!1,this._serverUri&&(this._serverUri.startsWith("ws:")||this._serverUri.startsWith("wss:"))&&this.connectByWebSocket(e),[2,e.promise]})})},t.prototype.connectByWebSocket=function(e){var n=this;this.log("connecting to: ".concat(this._serverUri)),this._accessToken?this._serverConnection=new WebSocket(this._serverUri+"?access_token="+this._accessToken):this._serverConnection=new WebSocket(this._serverUri),this._serverConnection.onmessage=function(r){n.gotMessageFromServer(r,e)},this._serverConnection.onerror=function(r){e.isPending()&&e.reject(m("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(r){n.log("websocket open"),e.resolve()},this._serverConnection.onclose=function(r){n.log("websocket closed: code(".concat(r.code,"), reason(").concat(r.reason,"), clean(").concat(r.wasClean,")")),e.isRejected||n.close(!1,"normal",e)}},t.prototype.gotMessageFromServer=function(e,n){var r=e.data;this.log("message received: ".concat(r));var i=JSON.parse(r),o=i.category,a=i.name,u=i.body;if(o!=="webrtc"){this._onMessage(i);return}if(i.kind==="event")if(a==="accepted"){this.log("accepted, session_id = ".concat(u.sessionId)),this._sessionId=u.sessionId;for(var c=0;c<this._outgoingQueue.length;c++)this._outgoingQueue[c].body.sessionId=this._sessionId,this.sendMessage(this._outgoingQueue[c]);this._outgoingQueue=[],this.sendlogMessage(this._pendingLog),this._pendingLog=[]}else a==="close"&&this.close(!1,u.reason,n)},t.prototype.sendMessage=function(e){this._serverConnection&&(this._serverConnection.readyState===WebSocket.OPEN?this._serverConnection.send(JSON.stringify(e)):this.log("not ready, discarding message: ".concat(e)))},t.prototype.close=function(e,n,r){n===void 0&&(n="normal"),!this._closed&&(this._closed=!0,r&&(r.isResolved()?this._onClose(n):r.reject(m("websocket closed: "+n,n))),this._serverConnection&&(this.log("closing server connection"),this._serverConnection.close()))},Object.defineProperty(t.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"peerConnection",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),t.prototype.sendRtcEvent=function(e,n){},t.prototype.sendVideoBounds=function(e,n){},t.prototype.sendUserText=function(e){this.logger.log("error","WebSocketSession discarding text: "+e)},Object.defineProperty(t.prototype,"microphoneMuteDelay",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneMuted",{get:function(){return null},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onUserText",{set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMicrophoneConnected",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCameraConnected",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return 0},enumerable:!1,configurable:!0}),t.prototype.isMicrophoneActive=function(){return!1},t.prototype.isCameraActive=function(){return!1},t.prototype.setMediaDeviceActive=function(e){return e.microphone,e.camera,T(this,void 0,void 0,function(){return S(this,function(n){throw m("setMediaDeviceActive not supported on WebSocketSession","notSupported")})})},t}(),et;(function(t){t.Scene="scene"})(et||(et={}));var Oe;(function(t){t.Response="response",t.Request="request"})(Oe||(Oe={}));var we;(function(t){t.Idle="idle",t.Animating="animating",t.Speaking="speaking"})(we||(we={}));var xt;(function(t){t.UI_CONTENT_AWARENESS="UI_CONTENT_AWARENESS",t.UI_SDK_CAMERA_CONTROL="UI_SDK_CAMERA_CONTROL"})(xt||(xt={}));var Q=[],oi=function(){return Q.some(function(t){return t.activeTargets.length>0})},ai=function(){return Q.some(function(t){return t.skippedTargets.length>0})},_n="ResizeObserver loop completed with undelivered notifications.",si=function(){var t;typeof ErrorEvent=="function"?t=new ErrorEvent("error",{message:_n}):(t=document.createEvent("Event"),t.initEvent("error",!1,!1),t.message=_n),window.dispatchEvent(t)},Ne;(function(t){t.BORDER_BOX="border-box",t.CONTENT_BOX="content-box",t.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"})(Ne||(Ne={}));var Z=function(t){return Object.freeze(t)},ui=function(){function t(e,n){this.inlineSize=e,this.blockSize=n,Z(this)}return t}(),er=function(){function t(e,n,r,i){return this.x=e,this.y=n,this.width=r,this.height=i,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,Z(this)}return t.prototype.toJSON=function(){var e=this,n=e.x,r=e.y,i=e.top,o=e.right,a=e.bottom,u=e.left,c=e.width,s=e.height;return{x:n,y:r,top:i,right:o,bottom:a,left:u,width:c,height:s}},t.fromRect=function(e){return new t(e.x,e.y,e.width,e.height)},t}(),Qt=function(t){return t instanceof SVGElement&&"getBBox"in t},tr=function(t){if(Qt(t)){var e=t.getBBox(),n=e.width,r=e.height;return!n&&!r}var i=t,o=i.offsetWidth,a=i.offsetHeight;return!(o||a||t.getClientRects().length)},hn=function(t){var e;if(t instanceof Element)return!0;var n=(e=t==null?void 0:t.ownerDocument)===null||e===void 0?void 0:e.defaultView;return!!(n&&t instanceof n.Element)},ci=function(t){switch(t.tagName){case"INPUT":if(t.type!=="image")break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},be=typeof window<"u"?window:{},xe=new WeakMap,pn=/auto|scroll/,li=/^tb|vertical/,fi=/msie|trident/i.test(be.navigator&&be.navigator.userAgent),L=function(t){return parseFloat(t||"0")},ae=function(t,e,n){return t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=!1),new ui((n?e:t)||0,(n?t:e)||0)},vn=Z({devicePixelContentBoxSize:ae(),borderBoxSize:ae(),contentBoxSize:ae(),contentRect:new er(0,0,0,0)}),nr=function(t,e){if(e===void 0&&(e=!1),xe.has(t)&&!e)return xe.get(t);if(tr(t))return xe.set(t,vn),vn;var n=getComputedStyle(t),r=Qt(t)&&t.ownerSVGElement&&t.getBBox(),i=!fi&&n.boxSizing==="border-box",o=li.test(n.writingMode||""),a=!r&&pn.test(n.overflowY||""),u=!r&&pn.test(n.overflowX||""),c=r?0:L(n.paddingTop),s=r?0:L(n.paddingRight),l=r?0:L(n.paddingBottom),f=r?0:L(n.paddingLeft),d=r?0:L(n.borderTopWidth),h=r?0:L(n.borderRightWidth),v=r?0:L(n.borderBottomWidth),y=r?0:L(n.borderLeftWidth),O=f+s,b=c+l,A=y+h,C=d+v,w=u?t.offsetHeight-C-t.clientHeight:0,R=a?t.offsetWidth-A-t.clientWidth:0,E=i?O+A:0,B=i?b+C:0,De=r?r.width:L(n.width)-E-R,Ue=r?r.height:L(n.height)-B-w,Jr=De+O+R+A,Qr=Ue+b+w+C,fn=Z({devicePixelContentBoxSize:ae(Math.round(De*devicePixelRatio),Math.round(Ue*devicePixelRatio),o),borderBoxSize:ae(Jr,Qr,o),contentBoxSize:ae(De,Ue,o),contentRect:new er(f,c,De,Ue)});return xe.set(t,fn),fn},rr=function(t,e,n){var r=nr(t,n),i=r.borderBoxSize,o=r.contentBoxSize,a=r.devicePixelContentBoxSize;switch(e){case Ne.DEVICE_PIXEL_CONTENT_BOX:return a;case Ne.BORDER_BOX:return i;default:return o}},di=function(){function t(e){var n=nr(e);this.target=e,this.contentRect=n.contentRect,this.borderBoxSize=Z([n.borderBoxSize]),this.contentBoxSize=Z([n.contentBoxSize]),this.devicePixelContentBoxSize=Z([n.devicePixelContentBoxSize])}return t}(),ir=function(t){if(tr(t))return 1/0;for(var e=0,n=t.parentNode;n;)e+=1,n=n.parentNode;return e},_i=function(){var t=1/0,e=[];Q.forEach(function(a){if(a.activeTargets.length!==0){var u=[];a.activeTargets.forEach(function(s){var l=new di(s.target),f=ir(s.target);u.push(l),s.lastReportedSize=rr(s.target,s.observedBox),f<t&&(t=f)}),e.push(function(){a.callback.call(a.observer,u,a.observer)}),a.activeTargets.splice(0,a.activeTargets.length)}});for(var n=0,r=e;n<r.length;n++){var i=r[n];i()}return t},En=function(t){Q.forEach(function(n){n.activeTargets.splice(0,n.activeTargets.length),n.skippedTargets.splice(0,n.skippedTargets.length),n.observationTargets.forEach(function(i){i.isActive()&&(ir(i.target)>t?n.activeTargets.push(i):n.skippedTargets.push(i))})})},hi=function(){var t=0;for(En(t);oi();)t=_i(),En(t);return ai()&&si(),t>0},ht,or=[],pi=function(){return or.splice(0).forEach(function(t){return t()})},vi=function(t){if(!ht){var e=0,n=document.createTextNode(""),r={characterData:!0};new MutationObserver(function(){return pi()}).observe(n,r),ht=function(){n.textContent="".concat(e?e--:e++)}}or.push(t),ht()},Ei=function(t){vi(function(){requestAnimationFrame(t)})},We=0,gi=function(){return!!We},yi=250,mi={attributes:!0,characterData:!0,childList:!0,subtree:!0},gn=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],yn=function(t){return t===void 0&&(t=0),Date.now()+t},pt=!1,Ti=function(){function t(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return t.prototype.run=function(e){var n=this;if(e===void 0&&(e=yi),!pt){pt=!0;var r=yn(e);Ei(function(){var i=!1;try{i=hi()}finally{if(pt=!1,e=r-yn(),!gi())return;i?n.run(1e3):e>0?n.run(e):n.start()}})}},t.prototype.schedule=function(){this.stop(),this.run()},t.prototype.observe=function(){var e=this,n=function(){return e.observer&&e.observer.observe(document.body,mi)};document.body?n():be.addEventListener("DOMContentLoaded",n)},t.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),gn.forEach(function(n){return be.addEventListener(n,e.listener,!0)}))},t.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),gn.forEach(function(n){return be.removeEventListener(n,e.listener,!0)}),this.stopped=!0)},t}(),kt=new Ti,mn=function(t){!We&&t>0&&kt.start(),We+=t,!We&&kt.stop()},Si=function(t){return!Qt(t)&&!ci(t)&&getComputedStyle(t).display==="inline"},Oi=function(){function t(e,n){this.target=e,this.observedBox=n||Ne.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return t.prototype.isActive=function(){var e=rr(this.target,this.observedBox,!0);return Si(this.target)&&(this.lastReportedSize=e),this.lastReportedSize.inlineSize!==e.inlineSize||this.lastReportedSize.blockSize!==e.blockSize},t}(),bi=function(){function t(e,n){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=n}return t}(),ke=new WeakMap,Tn=function(t,e){for(var n=0;n<t.length;n+=1)if(t[n].target===e)return n;return-1},Be=function(){function t(){}return t.connect=function(e,n){var r=new bi(e,n);ke.set(e,r)},t.observe=function(e,n,r){var i=ke.get(e),o=i.observationTargets.length===0;Tn(i.observationTargets,n)<0&&(o&&Q.push(i),i.observationTargets.push(new Oi(n,r&&r.box)),mn(1),kt.schedule())},t.unobserve=function(e,n){var r=ke.get(e),i=Tn(r.observationTargets,n),o=r.observationTargets.length===1;i>=0&&(o&&Q.splice(Q.indexOf(r),1),r.observationTargets.splice(i,1),mn(-1))},t.disconnect=function(e){var n=this,r=ke.get(e);r.observationTargets.slice().forEach(function(i){return n.unobserve(e,i.target)}),r.activeTargets.splice(0,r.activeTargets.length)},t}(),Ai=function(){function t(e){if(arguments.length===0)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if(typeof e!="function")throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");Be.connect(this,e)}return t.prototype.observe=function(e,n){if(arguments.length===0)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!hn(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");Be.observe(this,e,n)},t.prototype.unobserve=function(e){if(arguments.length===0)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!hn(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");Be.unobserve(this,e)},t.prototype.disconnect=function(){Be.disconnect(this)},t.toString=function(){return"function ResizeObserver () { [polyfill code] }"},t}(),Ri=function(){return Promise.all(Array.from(document.images).filter(function(t){return!t.complete}).map(function(t){return new Promise(function(e){t.onload=e,t.onerror=e})}))},Ci=function(t,e){e===void 0&&(e=500);var n=-1;return function(){n&&clearTimeout(n),n=setTimeout(function(){return t()},e)}},Ii=function(){function t(e,n,r){n===void 0&&(n=300),r===void 0&&(r=new H);var i=this;this.scene=e,this.debounceTime=n,this.logger=r,this.VIDEO_FRAME_STR="data-sm-video",this.VIDEO_FRAME_STR_BRACKETED="[".concat(this.VIDEO_FRAME_STR,"]"),this.CONTENT_STR="data-sm-content",this.CONTENT_STR_BRACKETED="[".concat(this.CONTENT_STR,"]"),this.CUE_ATTRIBUTES=[this.VIDEO_FRAME_STR,this.CONTENT_STR],this.CUE_ATTRIBUTES_BRACKETED=[this.VIDEO_FRAME_STR_BRACKETED,this.CONTENT_STR_BRACKETED].join(),this.RESIZE_OBSERVER_BOX_OPTIONS="border-box",this.callMeasure=!1,this.contentCollection={},this.videoFrame=null,this.debouncedMeasure=Ci(function(){return i.measureInternal()},n),this.resizeObserver=new Ai(function(){return i.measureDebounced()}),this.getInitialElements(),this.mutationObserver=new MutationObserver(function(o){return i.mutationCallback(o)}),this.setupEventListeners(),this.observeMutations(),this.measureInternal()}return t.prototype.isLoggingEnabled=function(){return this.logger.isEnabled},t.prototype.setLogging=function(e){this.logger.enableLogging(e)},t.prototype.getMinLogLevel=function(){return this.logger.getMinLogLevel()},t.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},t.prototype.setupEventListeners=function(){var e=this;window.addEventListener("resize",function(){return e.measureDebounced()})},t.prototype.getInitialElements=function(){var e=this,n=document.querySelector(this.VIDEO_FRAME_STR_BRACKETED),r=document.querySelectorAll(this.CONTENT_STR_BRACKETED);this.trackVideoElement(n),Array.from(r).map(function(i){return e.trackContentElement(i)})},t.prototype.observeMutations=function(){var e=document.documentElement||document.body;this.mutationObserver.observe(e,{attributeFilter:this.CUE_ATTRIBUTES,attributeOldValue:!0,childList:!0,subtree:!0})},t.prototype.disconnect=function(){var e=this;this.mutationObserver.disconnect(),this.resizeObserver.disconnect(),window.removeEventListener("resize",function(){return e.measureDebounced()}),this.scene.contentAwareness=void 0},t.prototype.reconnect=function(){this.scene.contentAwareness=this,this.observeMutations(),this.setupEventListeners(),this.measure()},t.prototype.measure=function(){this.measureInternal()},t.prototype.measureDebounced=function(){this.debouncedMeasure()},t.prototype.measureInternal=function(){if(!this.scene.isConnected()){this.logger.log("error","ContentAwareness: Scene does not exist or is not connected yet");return}var e=this.measureWindow(),n=this.measureVideoFrame(),r=this.measureContent();if(e&&n&&r){var i=this.buildUpdateContentAwarenessRequest(e.innerWidth,e.innerHeight,n,r);this.scene.sendRequest("updateContentAwareness",i)}},t.prototype.measureVideoFrame=function(){if(!this.videoFrame)return this.logger.log("warn","ContentAwareness: Unable to find a video element"),null;var e=this.videoFrame.getBoundingClientRect();return this.invalidDimensions(e)?(this.logger.log("warn","ContentAwareness: Video has a zero width and height"),null):{x1:Math.round(e.left),x2:Math.round(e.right),y1:Math.round(e.top),y2:Math.round(e.bottom)}},t.prototype.measureContent=function(){var e=this,n=[];return Object.keys(this.contentCollection).map(function(r){var i=e.contentCollection[r],o=i.getBoundingClientRect();if(e.invalidDimensions(o)&&e.logger.log("warn","ContentAwareness: Element '".concat(r,"' has a zero width and height")),e.invalidContent(o)){e.logger.log("warn","ContentAwareness: Element '".concat(r,"' is not being tracked")),delete e.contentCollection[r];return}n.push({id:r,x1:Math.round(o.left),x2:Math.round(o.right),y1:Math.round(o.top),y2:Math.round(o.bottom)})}),n},t.prototype.invalidDimensions=function(e){return e.width===0&&e.height===0},t.prototype.invalidContent=function(e){return e.top===0&&e.bottom===0&&e.right===0&&e.left===0},t.prototype.measureWindow=function(){return{innerHeight:Math.round(window.innerHeight),innerWidth:Math.round(window.innerWidth)}},t.prototype.buildUpdateContentAwarenessRequest=function(e,n,r,i){return{viewWidth:e,viewHeight:n,videoFrame:r,content:i}},t.prototype.trackVideoElement=function(e){e&&(this.videoFrame&&(this.logger.log("warn","ContentAwareness: Already observing a video element, switching to new video element"),this.untrackVideoElement(this.videoFrame)),this.videoFrame=e,this.resizeObserver.observe(this.videoFrame,{box:this.RESIZE_OBSERVER_BOX_OPTIONS}))},t.prototype.trackContentElement=function(e){var n=e.getAttribute(this.CONTENT_STR);return n?(this.contentCollection[n]=e,this.resizeObserver.observe(e,{box:this.RESIZE_OBSERVER_BOX_OPTIONS}),!0):!1},t.prototype.untrackContentElement=function(e){var n=e.getAttribute(this.CONTENT_STR),r=this.contentCollection[n];e===r&&(delete this.contentCollection[n],this.resizeObserver.unobserve(e))},t.prototype.untrackVideoElement=function(e){e===this.videoFrame&&(this.videoFrame=null),this.resizeObserver.unobserve(e)},t.prototype.mutationCallback=function(e){var n=this,r=!1;this.callMeasure=!1;for(var i=0;i<e.length;++i)switch(e[i].type){case"childList":{if(e[i].target.nodeType!==Node.ELEMENT_NODE)break;this.untrackRemovedNodeWithCUE(e[i].removedNodes),this.trackAddedNodeWithCUE(e[i].addedNodes);for(var o=0;o<e[i].addedNodes.length;o++)try{var a=e[i].addedNodes[o];if(!a.hasAttribute)continue;var u=a.tagName==="IMG",c=!!a.querySelector("img");if(r=u||c,r)break}catch{this.logger.log("warn","ContentAwareness: Failed to track non-element node",e[i].addedNodes[o])}break}case"attributes":{if(e[i].target.nodeType!==Node.ELEMENT_NODE)break;try{var a=e[i].target,s=e[i].attributeName;if(s===this.VIDEO_FRAME_STR)a.hasAttribute(s)?(this.trackVideoElement(a),this.callMeasure=!0):this.videoFrame&&this.untrackVideoElement(a);else if(s===this.CONTENT_STR){var l=a.getAttribute(s),f=e[i].oldValue;f&&(this.resizeObserver.unobserve(this.contentCollection[f]),delete this.contentCollection[f]),l&&(this.contentCollection[l]=a,this.resizeObserver.observe(a,{box:this.RESIZE_OBSERVER_BOX_OPTIONS})),this.callMeasure=!0}break}catch{this.logger.log("warn","ContentAwareness: Failed to track non-element node",e[i].target)}}}this.callMeasure&&(r?Ri().then(function(){n.measureDebounced()}):this.measureDebounced())},t.prototype.trackAddedNodeWithCUE=function(e){var n=this;e.forEach(function(r){try{var i=r;if(!i.hasAttribute)return;i.hasAttribute(n.VIDEO_FRAME_STR)?(n.trackVideoElement(i),n.callMeasure=!0):i.hasAttribute(n.CONTENT_STR)&&(n.callMeasure=n.trackContentElement(i)),i.querySelector(n.CUE_ATTRIBUTES_BRACKETED)!==null&&i.querySelectorAll(n.CUE_ATTRIBUTES_BRACKETED).forEach(function(o){o.hasAttribute(n.VIDEO_FRAME_STR)?(n.trackVideoElement(o),n.callMeasure=!0):o.hasAttribute(n.CONTENT_STR)&&(n.callMeasure=n.trackContentElement(o))})}catch{n.logger.log("warn","ContentAwareness: Failed to track non-element node",r)}})},t.prototype.untrackRemovedNodeWithCUE=function(e){var n=this;e.forEach(function(r){try{var i=r;if(!i.hasAttribute)return;i.hasAttribute(n.VIDEO_FRAME_STR)?n.untrackVideoElement(i):i.hasAttribute(n.CONTENT_STR)&&(n.untrackContentElement(i),n.callMeasure=!0),i.querySelector(n.CUE_ATTRIBUTES_BRACKETED)!==null&&i.querySelectorAll(n.CUE_ATTRIBUTES_BRACKETED).forEach(function(o){o.hasAttribute(n.VIDEO_FRAME_STR)?n.untrackVideoElement(o):o.hasAttribute(n.CONTENT_STR)&&(n.untrackContentElement(o),n.callMeasure=!0)})}catch{n.logger.log("warn","ContentAwareness: Failed to track non-element node",r)}})},t}(),wi=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},se="1.2.0",Sn=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Ni(t){var e=new Set([t]),n=new Set,r=t.match(Sn);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(c){return c===t};function o(u){return n.add(u),!1}function a(u){return e.add(u),!0}return function(c){if(e.has(c))return!0;if(n.has(c))return!1;var s=c.match(Sn);if(!s)return o(c);var l={major:+s[1],minor:+s[2],patch:+s[3],prerelease:s[4]};return l.prerelease!=null||i.major!==l.major?o(c):i.major===0?i.minor===l.minor&&i.patch<=l.patch?a(c):o(c):i.minor<=l.minor?a(c):o(c)}}var Mi=Ni(se),Pi=se.split(".")[0],Me=Symbol.for("opentelemetry.js.api."+Pi),Pe=wi;function lt(t,e,n,r){var i;r===void 0&&(r=!1);var o=Pe[Me]=(i=Pe[Me])!==null&&i!==void 0?i:{version:se};if(!r&&o[t]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return n.error(a.stack||a.message),!1}if(o.version!==se){var a=new Error("@opentelemetry/api: All API registration versions must match");return n.error(a.stack||a.message),!1}return o[t]=e,n.debug("@opentelemetry/api: Registered a global for "+t+" v"+se+"."),!0}function le(t){var e,n,r=(e=Pe[Me])===null||e===void 0?void 0:e.version;if(!(!r||!Mi(r)))return(n=Pe[Me])===null||n===void 0?void 0:n[t]}function ft(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+se+".");var n=Pe[Me];n&&delete n[t]}var Li=function(){function t(e){this._namespace=e.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Ee("debug",this._namespace,e)},t.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Ee("error",this._namespace,e)},t.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Ee("info",this._namespace,e)},t.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Ee("warn",this._namespace,e)},t.prototype.verbose=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Ee("verbose",this._namespace,e)},t}();function Ee(t,e,n){var r=le("diag");if(r)return n.unshift(e),r[t].apply(r,n)}var g;(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(g||(g={}));function Di(t,e){t<g.NONE?t=g.NONE:t>g.ALL&&(t=g.ALL),e=e||{};function n(r,i){var o=e[r];return typeof o=="function"&&t>=i?o.bind(e):function(){}}return{error:n("error",g.ERROR),warn:n("warn",g.WARN),info:n("info",g.INFO),debug:n("debug",g.DEBUG),verbose:n("verbose",g.VERBOSE)}}var Ui="diag",X=function(){function t(){function e(r){return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var a=le("diag");if(a)return a[r].apply(a,i)}}var n=this;n.setLogger=function(r,i){var o,a;if(i===void 0&&(i=g.INFO),r===n){var u=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((o=u.stack)!==null&&o!==void 0?o:u.message),!1}var c=le("diag"),s=Di(i,r);if(c){var l=(a=new Error().stack)!==null&&a!==void 0?a:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+l),s.warn("Current logger will overwrite one already registered from "+l)}return lt("diag",s,n,!0)},n.disable=function(){ft(Ui,n)},n.createComponentLogger=function(r){return new Li(r)},n.verbose=e("verbose"),n.debug=e("debug"),n.info=e("info"),n.warn=e("warn"),n.error=e("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),xi=function(){function t(e){this._entries=e?new Map(e):new Map}return t.prototype.getEntry=function(e){var n=this._entries.get(e);if(n)return Object.assign({},n)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var n=e[0],r=e[1];return[n,r]})},t.prototype.setEntry=function(e,n){var r=new t(this._entries);return r._entries.set(e,n),r},t.prototype.removeEntry=function(e){var n=new t(this._entries);return n._entries.delete(e),n},t.prototype.removeEntries=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=new t(this._entries),i=0,o=e;i<o.length;i++){var a=o[i];r._entries.delete(a)}return r},t.prototype.clear=function(){return new t},t}(),ki=Symbol("BaggageEntryMetadata"),Bi=X.instance();function Gi(t){return t===void 0&&(t={}),new xi(new Map(Object.entries(t)))}function ar(t){return typeof t!="string"&&(Bi.error("Cannot create baggage metadata from unknown type: "+typeof t),t=""),{__TYPE__:ki,toString:function(){return t}}}var Vi={get:function(t,e){if(t!=null)return t[e]},keys:function(t){return t==null?[]:Object.keys(t)}},ji={set:function(t,e,n){t!=null&&(t[e]=n)}};function Zt(t){return Symbol.for(t)}var Fi=function(){function t(e){var n=this;n._currentContext=e?new Map(e):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,i){var o=new t(n._currentContext);return o._currentContext.set(r,i),o},n.deleteValue=function(r){var i=new t(n._currentContext);return i._currentContext.delete(r),i}}return t}(),z=new Fi,Hi=function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t},Xi=function(){function t(){}return t.prototype.active=function(){return z},t.prototype.with=function(e,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return n.call.apply(n,Hi([r],i))},t.prototype.bind=function(e,n){return n},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),Ki=function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t},vt="context",Wi=new Xi,en=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(e){return lt(vt,e,X.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(e,n,r){for(var i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return(i=this._getContextManager()).with.apply(i,Ki([e,n,r],o))},t.prototype.bind=function(e,n){return this._getContextManager().bind(e,n)},t.prototype._getContextManager=function(){return le(vt)||Wi},t.prototype.disable=function(){this._getContextManager().disable(),ft(vt,X.instance())},t}(),G;(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(G||(G={}));var sr="0000000000000000",ur="00000000000000000000000000000000",cr={traceId:ur,spanId:sr,traceFlags:G.NONE},Ae=function(){function t(e){e===void 0&&(e=cr),this._spanContext=e}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,n){return this},t.prototype.setAttributes=function(e){return this},t.prototype.addEvent=function(e,n){return this},t.prototype.setStatus=function(e){return this},t.prototype.updateName=function(e){return this},t.prototype.end=function(e){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(e,n){},t}(),tn=Zt("OpenTelemetry Context Key SPAN");function nn(t){return t.getValue(tn)||void 0}function Yi(){return nn(en.getInstance().active())}function rn(t,e){return t.setValue(tn,e)}function zi(t){return t.deleteValue(tn)}function $i(t,e){return rn(t,new Ae(e))}function lr(t){var e;return(e=nn(t))===null||e===void 0?void 0:e.spanContext()}var qi=/^([0-9a-f]{32})$/i,Ji=/^[0-9a-f]{16}$/i;function fr(t){return qi.test(t)&&t!==ur}function Qi(t){return Ji.test(t)&&t!==sr}function dt(t){return fr(t.traceId)&&Qi(t.spanId)}function Zi(t){return new Ae(t)}var On=en.getInstance(),dr=function(){function t(){}return t.prototype.startSpan=function(e,n,r){var i=!!(n!=null&&n.root);if(i)return new Ae;var o=r&&lr(r);return eo(o)&&dt(o)?new Ae(o):new Ae},t.prototype.startActiveSpan=function(e,n,r,i){var o,a,u;if(!(arguments.length<2)){arguments.length===2?u=n:arguments.length===3?(o=n,u=r):(o=n,a=r,u=i);var c=a??On.active(),s=this.startSpan(e,o,c),l=rn(c,s);return On.with(l,u,void 0,s)}},t}();function eo(t){return typeof t=="object"&&typeof t.spanId=="string"&&typeof t.traceId=="string"&&typeof t.traceFlags=="number"}var to=new dr,no=function(){function t(e,n,r,i){this._provider=e,this.name=n,this.version=r,this.options=i}return t.prototype.startSpan=function(e,n,r){return this._getTracer().startSpan(e,n,r)},t.prototype.startActiveSpan=function(e,n,r,i){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):to},t}(),ro=function(){function t(){}return t.prototype.getTracer=function(e,n,r){return new dr},t}(),io=new ro,bn=function(){function t(){}return t.prototype.getTracer=function(e,n,r){var i;return(i=this.getDelegateTracer(e,n,r))!==null&&i!==void 0?i:new no(this,e,n,r)},t.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:io},t.prototype.setDelegate=function(e){this._delegate=e},t.prototype.getDelegateTracer=function(e,n,r){var i;return(i=this._delegate)===null||i===void 0?void 0:i.getTracer(e,n,r)},t}(),tt;(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(tt||(tt={}));var Bt;(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(Bt||(Bt={}));var Gt;(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(Gt||(Gt={}));var Et="trace",oo=function(){function t(){this._proxyTracerProvider=new bn,this.wrapSpanContext=Zi,this.isSpanContextValid=dt,this.deleteSpan=zi,this.getSpan=nn,this.getActiveSpan=Yi,this.getSpanContext=lr,this.setSpan=rn,this.setSpanContext=$i}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(e){var n=lt(Et,this._proxyTracerProvider,X.instance());return n&&this._proxyTracerProvider.setDelegate(e),n},t.prototype.getTracerProvider=function(){return le(Et)||this._proxyTracerProvider},t.prototype.getTracer=function(e,n){return this.getTracerProvider().getTracer(e,n)},t.prototype.disable=function(){ft(Et,X.instance()),this._proxyTracerProvider=new bn},t}(),ao=function(){function t(){}return t.prototype.inject=function(e,n){},t.prototype.extract=function(e,n){return e},t.prototype.fields=function(){return[]},t}(),on=Zt("OpenTelemetry Baggage Key");function so(t){return t.getValue(on)||void 0}function uo(t,e){return t.setValue(on,e)}function co(t){return t.deleteValue(on)}var gt="propagation",lo=new ao,fo=function(){function t(){this.createBaggage=Gi,this.getBaggage=so,this.setBaggage=uo,this.deleteBaggage=co}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(e){return lt(gt,e,X.instance())},t.prototype.inject=function(e,n,r){return r===void 0&&(r=ji),this._getGlobalPropagator().inject(e,n,r)},t.prototype.extract=function(e,n,r){return r===void 0&&(r=Vi),this._getGlobalPropagator().extract(e,n,r)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){ft(gt,X.instance())},t.prototype._getGlobalPropagator=function(){return le(gt)||lo},t}(),ee=en.getInstance(),D=oo.getInstance(),Ye=fo.getInstance(),_=X.instance(),An=function(t,e){return e===void 0&&(e=p.None),t?t.camera&&t.microphone?p.MicrophoneAndCamera:t.camera?p.Camera:t.microphone?p.Microphone:p.None:e};function _o(t){return t.replace(/^wss:\/\//,"https://")}function Rn(t){try{if(!t)return;var e=new URL(t);return e.pathname="",e.search="",e.toString()}catch{return}}var Re;(function(t){t.Showcards="showcards",t.Hidecards="hidecards",t.Feature="feature",t.Marker="marker"})(Re||(Re={}));var V;(function(t){t.dpSpeaking="dpSpeaking",t.userSpeaking="userSpeaking",t.dpProcessing="dpProcessing",t.idle="idle"})(V||(V={}));var ho=function(){function t(e){e===void 0&&(e=new H),this.logger=e,this._conversationState=V.idle,this._userActive=!1,this._onConversationStateUpdated=new P}return t.prototype.processStateMessage=function(e){if(e&&e.persona&&Object.keys(e.persona).length>0){var n=Object.keys(e.persona)[0];if(!this._userActive&&e.persona[n].speechState){var r=e.persona[n].speechState;r===we.Idle?this.setSpeechState(V.idle):r===we.Speaking&&this.setSpeechState(V.dpSpeaking)}}},t.prototype.processRecognizeResultsMessage=function(e){this._userActive=!0;var n=e.status!==0,r=e.results&&e.results.some(function(o){return o.final});if(n){var i=typeof e.errorMessage<"u"?e.errorMessage:"recognizeResults sent back a message with non-zero status but no error message.";this.logger.log("error",i)}else r?this.setSpeechState(V.dpProcessing):this.setSpeechState(V.userSpeaking);this._userActive=!1},t.prototype.setSpeechState=function(e){this._conversationState!==e&&(this._conversationState=e,this._onConversationStateUpdated.call(this._conversationState))},t.prototype.getSpeechState=function(){return this._conversationState},Object.defineProperty(t.prototype,"onConversationStateUpdated",{get:function(){return this._onConversationStateUpdated},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this._userActive=!1,this._conversationState=V.idle,this._onConversationStateUpdated.call(this._conversationState)},t}(),po=function(){function t(){}return t.prototype.format=function(e){var n,r=(n=e.provider.meta.dialogflow)===null||n===void 0?void 0:n.queryResult.fulfillmentMessages,i=r==null?void 0:r.find(function(o){return!!(o!=null&&o.payload)});return i?this.formatLegacyDialogflow(i):this.formatContextData(e.output.context)},t.prototype.formatLegacyDialogflow=function(e){var n=this,r=e.payload.soulmachines;return Object.keys(r).map(function(i){return{id:i,data:x({id:i},n.formatCardData(r[i]))}})},t.prototype.formatContextData=function(e){var n=this;return this.allowedIds(e).map(function(r){var i=r.replace("public-","");return{id:i,data:x({id:i},n.formatCardData(e[r]))}})},t.prototype.allowedIds=function(e){return Object.keys(e).filter(function(n){return/public-/.test(n)===!0}).filter(function(n){return/\.original/gm.test(n)===!1})},t.prototype.formatCardData=function(e){var n=typeof e=="string"?JSON.parse(e):e,r=n.component,i=n.type,o=ei(n,["component","type"]);return x({type:i||r},o)},t}(),vo=function(){function t(e,n,r){e===void 0&&(e=new H),n===void 0&&(n=new ho),r===void 0&&(r=new po),this.logger=e,this.conversationState=n,this.contentCardFormatter=r,this._onCardChanged=new P,this._autoClearCards=!1,this.cardData=new Map,this.activeCardIds=new Set}return t.prototype.processStateMessage=function(e){this.conversationState.processStateMessage(e)},t.prototype.processRecognizeResultsMessage=function(e){this.conversationState.processRecognizeResultsMessage(e)},Object.defineProperty(t.prototype,"onConversationStateUpdated",{get:function(){return this.conversationState.onConversationStateUpdated},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoClearCards",{set:function(e){this._autoClearCards=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onCardChanged",{get:function(){return this._onCardChanged},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeCards",{get:function(){var e=this,n=[];return this.activeCardIds.forEach(function(r){var i=e.cardData.get(r);i?n.push(i):e.logger.log("error","card data for ".concat(r," does not exist"))}),n},enumerable:!1,configurable:!0}),t.prototype.onSpeechMarker=function(e){var n=e.arguments;e.name===Re.Showcards?this.addActiveCardIds(n):e.name===Re.Hidecards&&this.removeActiveCards(n),n.length===0&&e.name===Re.Hidecards&&this.clearActiveCards()},t.prototype.onConversationResult=function(e){var n=this,r=this.contentCardFormatter.format(e);this._autoClearCards&&this.clearActiveCards(),r.map(function(i){var o=i.id,a=i.data;n.cardData.set(o,a)})},t.prototype.reset=function(){this.clearActiveCards(),this.cardData.clear(),this.conversationState.reset()},t.prototype.clearActiveCards=function(){this.activeCardIds.clear(),this.onCardChanged.call(this.activeCards)},t.prototype.addActiveCardIds=function(e){this.activeCardIds=new Set(Dt(Dt([],Lt(this.activeCardIds),!1),Lt(e),!1)),this.onCardChanged.call(this.activeCards)},t.prototype.removeActiveCards=function(e){var n=this;e.forEach(function(r){return n.activeCardIds.delete(r)}),this.onCardChanged.call(this.activeCards)},t}(),Eo=function(){function t(e){var n=this;this.scene=e,this._previousUrl=window.location.href,this._observer=new MutationObserver(function(){return n.observeDocumentChanges()})}return t.prototype.observeUrlChanges=function(){this._observer.observe(document,{subtree:!0,childList:!0})},t.prototype.disconnect=function(){this._observer.disconnect()},t.prototype.send=function(){var e={personaId:this.scene.currentPersonaId,text:Ut.PAGE_METADATA,variables:{pageUrl:window.location.href.split("?")[0]},optionalArgs:{}};this.scene.sendRequest("conversationSend",e)},t.prototype.observeDocumentChanges=function(){window.location.href!==this._previousUrl&&(this._previousUrl=window.location.href,this.send())},t}(),yt=Object.keys(k).length,go=function(){function t(){this._connectionState={name:k.Disconnected,totalSteps:yt,currentStep:0,percentageLoaded:0},this._onConnectionStateUpdated=new P}return t.prototype.setConnectionState=function(e){if(this._connectionState.name!==e){var n=Object.keys(k).indexOf(e),r={name:e,currentStep:n,totalSteps:yt,percentageLoaded:100/(yt-1)*n};this._connectionState=r,this._onConnectionStateUpdated.call(r)}},t.prototype.getConnectionState=function(){return this._connectionState},Object.defineProperty(t.prototype,"onConnectionStateUpdated",{get:function(){return this._onConnectionStateUpdated},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.setConnectionState(k.Disconnected)},t}(),W={CLOUD_PROVIDER:"cloud.provider",CLOUD_ACCOUNT_ID:"cloud.account.id",CLOUD_REGION:"cloud.region",CLOUD_AVAILABILITY_ZONE:"cloud.availability_zone",CLOUD_PLATFORM:"cloud.platform",AWS_ECS_CONTAINER_ARN:"aws.ecs.container.arn",AWS_ECS_CLUSTER_ARN:"aws.ecs.cluster.arn",AWS_ECS_LAUNCHTYPE:"aws.ecs.launchtype",AWS_ECS_TASK_ARN:"aws.ecs.task.arn",AWS_ECS_TASK_FAMILY:"aws.ecs.task.family",AWS_ECS_TASK_REVISION:"aws.ecs.task.revision",AWS_EKS_CLUSTER_ARN:"aws.eks.cluster.arn",AWS_LOG_GROUP_NAMES:"aws.log.group.names",AWS_LOG_GROUP_ARNS:"aws.log.group.arns",AWS_LOG_STREAM_NAMES:"aws.log.stream.names",AWS_LOG_STREAM_ARNS:"aws.log.stream.arns",CONTAINER_NAME:"container.name",CONTAINER_ID:"container.id",CONTAINER_RUNTIME:"container.runtime",CONTAINER_IMAGE_NAME:"container.image.name",CONTAINER_IMAGE_TAG:"container.image.tag",DEPLOYMENT_ENVIRONMENT:"deployment.environment",DEVICE_ID:"device.id",DEVICE_MODEL_IDENTIFIER:"device.model.identifier",DEVICE_MODEL_NAME:"device.model.name",FAAS_NAME:"faas.name",FAAS_ID:"faas.id",FAAS_VERSION:"faas.version",FAAS_INSTANCE:"faas.instance",FAAS_MAX_MEMORY:"faas.max_memory",HOST_ID:"host.id",HOST_NAME:"host.name",HOST_TYPE:"host.type",HOST_ARCH:"host.arch",HOST_IMAGE_NAME:"host.image.name",HOST_IMAGE_ID:"host.image.id",HOST_IMAGE_VERSION:"host.image.version",K8S_CLUSTER_NAME:"k8s.cluster.name",K8S_NODE_NAME:"k8s.node.name",K8S_NODE_UID:"k8s.node.uid",K8S_NAMESPACE_NAME:"k8s.namespace.name",K8S_POD_UID:"k8s.pod.uid",K8S_POD_NAME:"k8s.pod.name",K8S_CONTAINER_NAME:"k8s.container.name",K8S_REPLICASET_UID:"k8s.replicaset.uid",K8S_REPLICASET_NAME:"k8s.replicaset.name",K8S_DEPLOYMENT_UID:"k8s.deployment.uid",K8S_DEPLOYMENT_NAME:"k8s.deployment.name",K8S_STATEFULSET_UID:"k8s.statefulset.uid",K8S_STATEFULSET_NAME:"k8s.statefulset.name",K8S_DAEMONSET_UID:"k8s.daemonset.uid",K8S_DAEMONSET_NAME:"k8s.daemonset.name",K8S_JOB_UID:"k8s.job.uid",K8S_JOB_NAME:"k8s.job.name",K8S_CRONJOB_UID:"k8s.cronjob.uid",K8S_CRONJOB_NAME:"k8s.cronjob.name",OS_TYPE:"os.type",OS_DESCRIPTION:"os.description",OS_NAME:"os.name",OS_VERSION:"os.version",PROCESS_PID:"process.pid",PROCESS_EXECUTABLE_NAME:"process.executable.name",PROCESS_EXECUTABLE_PATH:"process.executable.path",PROCESS_COMMAND:"process.command",PROCESS_COMMAND_LINE:"process.command_line",PROCESS_COMMAND_ARGS:"process.command_args",PROCESS_OWNER:"process.owner",PROCESS_RUNTIME_NAME:"process.runtime.name",PROCESS_RUNTIME_VERSION:"process.runtime.version",PROCESS_RUNTIME_DESCRIPTION:"process.runtime.description",SERVICE_NAME:"service.name",SERVICE_NAMESPACE:"service.namespace",SERVICE_INSTANCE_ID:"service.instance.id",SERVICE_VERSION:"service.version",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version",TELEMETRY_AUTO_VERSION:"telemetry.auto.version",WEBENGINE_NAME:"webengine.name",WEBENGINE_VERSION:"webengine.version",WEBENGINE_DESCRIPTION:"webengine.description"},yo="=",Cn=";",mo=",";function To(t){var e=t.split(Cn);if(!(e.length<=0)){var n=e.shift();if(n){var r=n.split(yo);if(r.length===2){var i=decodeURIComponent(r[0].trim()),o=decodeURIComponent(r[1].trim()),a;return e.length>0&&(a=ar(e.join(Cn))),{key:i,value:o,metadata:a}}}}}function _r(t){return typeof t!="string"||t.length===0?{}:t.split(mo).map(function(e){return To(e)}).filter(function(e){return e!==void 0&&e.value.length>0}).reduce(function(e,n){return e[n.key]=n.value,e},{})}function So(){return function(t){_.error(Oo(t))}}function Oo(t){return typeof t=="string"?t:JSON.stringify(bo(t))}function bo(t){for(var e={},n=t;n!==null;)Object.getOwnPropertyNames(n).forEach(function(r){if(!e[r]){var i=n[r];i&&(e[r]=String(i))}}),n=Object.getPrototypeOf(n);return e}var Ao=So();function Ro(t){try{Ao(t)}catch{}}var Vt;(function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"})(Vt||(Vt={}));var Co=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Io=",",wo=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function No(t){return wo.indexOf(t)>-1}var Mo=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function Po(t){return Mo.indexOf(t)>-1}var In=1/0,wn=128,hr={CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:g.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:In,OTEL_ATTRIBUTE_COUNT_LIMIT:wn,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:In,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:wn,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"none",OTEL_TRACES_SAMPLER:Vt.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:""};function Lo(t,e,n,r,i){if(r===void 0&&(r=-1/0),i===void 0&&(i=1/0),typeof n[t]<"u"){var o=Number(n[t]);isNaN(o)||(o<r?e[t]=r:o>i?e[t]=i:e[t]=o)}}function Do(t,e,n,r){r===void 0&&(r=Io);var i=n[t];typeof i=="string"&&(e[t]=i.split(r).map(function(o){return o.trim()}))}var Uo={ALL:g.ALL,VERBOSE:g.VERBOSE,DEBUG:g.DEBUG,INFO:g.INFO,WARN:g.WARN,ERROR:g.ERROR,NONE:g.NONE};function xo(t,e,n){var r=n[t];if(typeof r=="string"){var i=Uo[r.toUpperCase()];i!=null&&(e[t]=i)}}function ko(t){var e={};for(var n in hr){var r=n;switch(r){case"OTEL_LOG_LEVEL":xo(r,e,t);break;default:if(No(r))Lo(r,e,t);else if(Po(r))Do(r,e,t);else{var i=t[r];typeof i<"u"&&i!==null&&(e[r]=String(i))}}}return e}function F(){var t=ko(Co);return Object.assign({},hr,t)}function Ce(t){for(var e=t.length,n="",r=0;r<e;r+=2){var i=t.substring(r,r+2),o=parseInt(i,16);n+=String.fromCharCode(o)}return btoa(n)}Array(32);var jt=performance,Bo="1.7.0",Ge={CLOUD_PROVIDER:"cloud.provider",CLOUD_ACCOUNT_ID:"cloud.account.id",CLOUD_REGION:"cloud.region",CLOUD_AVAILABILITY_ZONE:"cloud.availability_zone",CLOUD_PLATFORM:"cloud.platform",AWS_ECS_CONTAINER_ARN:"aws.ecs.container.arn",AWS_ECS_CLUSTER_ARN:"aws.ecs.cluster.arn",AWS_ECS_LAUNCHTYPE:"aws.ecs.launchtype",AWS_ECS_TASK_ARN:"aws.ecs.task.arn",AWS_ECS_TASK_FAMILY:"aws.ecs.task.family",AWS_ECS_TASK_REVISION:"aws.ecs.task.revision",AWS_EKS_CLUSTER_ARN:"aws.eks.cluster.arn",AWS_LOG_GROUP_NAMES:"aws.log.group.names",AWS_LOG_GROUP_ARNS:"aws.log.group.arns",AWS_LOG_STREAM_NAMES:"aws.log.stream.names",AWS_LOG_STREAM_ARNS:"aws.log.stream.arns",CONTAINER_NAME:"container.name",CONTAINER_ID:"container.id",CONTAINER_RUNTIME:"container.runtime",CONTAINER_IMAGE_NAME:"container.image.name",CONTAINER_IMAGE_TAG:"container.image.tag",DEPLOYMENT_ENVIRONMENT:"deployment.environment",DEVICE_ID:"device.id",DEVICE_MODEL_IDENTIFIER:"device.model.identifier",DEVICE_MODEL_NAME:"device.model.name",FAAS_NAME:"faas.name",FAAS_ID:"faas.id",FAAS_VERSION:"faas.version",FAAS_INSTANCE:"faas.instance",FAAS_MAX_MEMORY:"faas.max_memory",HOST_ID:"host.id",HOST_NAME:"host.name",HOST_TYPE:"host.type",HOST_ARCH:"host.arch",HOST_IMAGE_NAME:"host.image.name",HOST_IMAGE_ID:"host.image.id",HOST_IMAGE_VERSION:"host.image.version",K8S_CLUSTER_NAME:"k8s.cluster.name",K8S_NODE_NAME:"k8s.node.name",K8S_NODE_UID:"k8s.node.uid",K8S_NAMESPACE_NAME:"k8s.namespace.name",K8S_POD_UID:"k8s.pod.uid",K8S_POD_NAME:"k8s.pod.name",K8S_CONTAINER_NAME:"k8s.container.name",K8S_REPLICASET_UID:"k8s.replicaset.uid",K8S_REPLICASET_NAME:"k8s.replicaset.name",K8S_DEPLOYMENT_UID:"k8s.deployment.uid",K8S_DEPLOYMENT_NAME:"k8s.deployment.name",K8S_STATEFULSET_UID:"k8s.statefulset.uid",K8S_STATEFULSET_NAME:"k8s.statefulset.name",K8S_DAEMONSET_UID:"k8s.daemonset.uid",K8S_DAEMONSET_NAME:"k8s.daemonset.name",K8S_JOB_UID:"k8s.job.uid",K8S_JOB_NAME:"k8s.job.name",K8S_CRONJOB_UID:"k8s.cronjob.uid",K8S_CRONJOB_NAME:"k8s.cronjob.name",OS_TYPE:"os.type",OS_DESCRIPTION:"os.description",OS_NAME:"os.name",OS_VERSION:"os.version",PROCESS_PID:"process.pid",PROCESS_EXECUTABLE_NAME:"process.executable.name",PROCESS_EXECUTABLE_PATH:"process.executable.path",PROCESS_COMMAND:"process.command",PROCESS_COMMAND_LINE:"process.command_line",PROCESS_COMMAND_ARGS:"process.command_args",PROCESS_OWNER:"process.owner",PROCESS_RUNTIME_NAME:"process.runtime.name",PROCESS_RUNTIME_VERSION:"process.runtime.version",PROCESS_RUNTIME_DESCRIPTION:"process.runtime.description",SERVICE_NAME:"service.name",SERVICE_NAMESPACE:"service.namespace",SERVICE_INSTANCE_ID:"service.instance.id",SERVICE_VERSION:"service.version",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version",TELEMETRY_AUTO_VERSION:"telemetry.auto.version",WEBENGINE_NAME:"webengine.name",WEBENGINE_VERSION:"webengine.version",WEBENGINE_DESCRIPTION:"webengine.description"},Go={CPP:"cpp",DOTNET:"dotnet",ERLANG:"erlang",GO:"go",JAVA:"java",NODEJS:"nodejs",PHP:"php",PYTHON:"python",RUBY:"ruby",WEBJS:"webjs"},ne,mt=(ne={},ne[Ge.TELEMETRY_SDK_NAME]="opentelemetry",ne[Ge.PROCESS_RUNTIME_NAME]="browser",ne[Ge.TELEMETRY_SDK_LANGUAGE]=Go.WEBJS,ne[Ge.TELEMETRY_SDK_VERSION]=Bo,ne);var pr=9,nt=Math.pow(10,pr);function Nn(t){var e=t/1e3,n=Math.trunc(e),r=Number((e-n).toFixed(pr))*nt;return[n,r]}function Vo(){var t=jt.timeOrigin;if(typeof t!="number"){var e=jt;t=e.timing&&e.timing.fetchStart}return t}function vr(t){var e=Nn(Vo()),n=Nn(typeof t=="number"?t:jt.now()),r=e[0]+n[0],i=e[1]+n[1];return i>nt&&(i-=nt,r+=1),[r,i]}function Ft(t){return t[0]*nt+t[1]}function Ve(t){return Math.round(t[0]*1e6+t[1]/1e3)}var J;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"})(J||(J={}));var Mn;(function(t){t.HTTP="http"})(Mn||(Mn={}));var jo=Function.prototype,Fo=jo.toString;Fo.call(Object);var Ho=function(){function t(){var e=this;this._promise=new Promise(function(n,r){e._resolve=n,e._reject=r})}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),t.prototype.resolve=function(e){this._resolve(e)},t.prototype.reject=function(e){this._reject(e)},t}(),Xo=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Ko=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))},Wo=function(){function t(e,n){this._callback=e,this._that=n,this._isCalled=!1,this._deferred=new Ho}return Object.defineProperty(t.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),t.prototype.call=function(){for(var e,n=this,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,Ko([this._that],Xo(r),!1))).then(function(o){return n._deferred.resolve(o)},function(o){return n._deferred.reject(o)})}catch(o){this._deferred.reject(o)}}return this._deferred.promise},t}();function Yo(){return"unknown_service"}var zo=function(){function t(e){this.attributes=e}return t.empty=function(){return t.EMPTY},t.default=function(){var e;return new t((e={},e[W.SERVICE_NAME]=Yo(),e[W.TELEMETRY_SDK_LANGUAGE]=mt[W.TELEMETRY_SDK_LANGUAGE],e[W.TELEMETRY_SDK_NAME]=mt[W.TELEMETRY_SDK_NAME],e[W.TELEMETRY_SDK_VERSION]=mt[W.TELEMETRY_SDK_VERSION],e))},t.prototype.merge=function(e){if(!e||!Object.keys(e.attributes).length)return this;var n=Object.assign({},this.attributes,e.attributes);return new t(n)},t.EMPTY=new t({}),t}();var Y={AWS_LAMBDA_INVOKED_ARN:"aws.lambda.invoked_arn",DB_SYSTEM:"db.system",DB_CONNECTION_STRING:"db.connection_string",DB_USER:"db.user",DB_JDBC_DRIVER_CLASSNAME:"db.jdbc.driver_classname",DB_NAME:"db.name",DB_STATEMENT:"db.statement",DB_OPERATION:"db.operation",DB_MSSQL_INSTANCE_NAME:"db.mssql.instance_name",DB_CASSANDRA_KEYSPACE:"db.cassandra.keyspace",DB_CASSANDRA_PAGE_SIZE:"db.cassandra.page_size",DB_CASSANDRA_CONSISTENCY_LEVEL:"db.cassandra.consistency_level",DB_CASSANDRA_TABLE:"db.cassandra.table",DB_CASSANDRA_IDEMPOTENCE:"db.cassandra.idempotence",DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT:"db.cassandra.speculative_execution_count",DB_CASSANDRA_COORDINATOR_ID:"db.cassandra.coordinator.id",DB_CASSANDRA_COORDINATOR_DC:"db.cassandra.coordinator.dc",DB_HBASE_NAMESPACE:"db.hbase.namespace",DB_REDIS_DATABASE_INDEX:"db.redis.database_index",DB_MONGODB_COLLECTION:"db.mongodb.collection",DB_SQL_TABLE:"db.sql.table",EXCEPTION_TYPE:"exception.type",EXCEPTION_MESSAGE:"exception.message",EXCEPTION_STACKTRACE:"exception.stacktrace",EXCEPTION_ESCAPED:"exception.escaped",FAAS_TRIGGER:"faas.trigger",FAAS_EXECUTION:"faas.execution",FAAS_DOCUMENT_COLLECTION:"faas.document.collection",FAAS_DOCUMENT_OPERATION:"faas.document.operation",FAAS_DOCUMENT_TIME:"faas.document.time",FAAS_DOCUMENT_NAME:"faas.document.name",FAAS_TIME:"faas.time",FAAS_CRON:"faas.cron",FAAS_COLDSTART:"faas.coldstart",FAAS_INVOKED_NAME:"faas.invoked_name",FAAS_INVOKED_PROVIDER:"faas.invoked_provider",FAAS_INVOKED_REGION:"faas.invoked_region",NET_TRANSPORT:"net.transport",NET_PEER_IP:"net.peer.ip",NET_PEER_PORT:"net.peer.port",NET_PEER_NAME:"net.peer.name",NET_HOST_IP:"net.host.ip",NET_HOST_PORT:"net.host.port",NET_HOST_NAME:"net.host.name",NET_HOST_CONNECTION_TYPE:"net.host.connection.type",NET_HOST_CONNECTION_SUBTYPE:"net.host.connection.subtype",NET_HOST_CARRIER_NAME:"net.host.carrier.name",NET_HOST_CARRIER_MCC:"net.host.carrier.mcc",NET_HOST_CARRIER_MNC:"net.host.carrier.mnc",NET_HOST_CARRIER_ICC:"net.host.carrier.icc",PEER_SERVICE:"peer.service",ENDUSER_ID:"enduser.id",ENDUSER_ROLE:"enduser.role",ENDUSER_SCOPE:"enduser.scope",THREAD_ID:"thread.id",THREAD_NAME:"thread.name",CODE_FUNCTION:"code.function",CODE_NAMESPACE:"code.namespace",CODE_FILEPATH:"code.filepath",CODE_LINENO:"code.lineno",HTTP_METHOD:"http.method",HTTP_URL:"http.url",HTTP_TARGET:"http.target",HTTP_HOST:"http.host",HTTP_SCHEME:"http.scheme",HTTP_STATUS_CODE:"http.status_code",HTTP_FLAVOR:"http.flavor",HTTP_USER_AGENT:"http.user_agent",HTTP_REQUEST_CONTENT_LENGTH:"http.request_content_length",HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED:"http.request_content_length_uncompressed",HTTP_RESPONSE_CONTENT_LENGTH:"http.response_content_length",HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED:"http.response_content_length_uncompressed",HTTP_SERVER_NAME:"http.server_name",HTTP_ROUTE:"http.route",HTTP_CLIENT_IP:"http.client_ip",AWS_DYNAMODB_TABLE_NAMES:"aws.dynamodb.table_names",AWS_DYNAMODB_CONSUMED_CAPACITY:"aws.dynamodb.consumed_capacity",AWS_DYNAMODB_ITEM_COLLECTION_METRICS:"aws.dynamodb.item_collection_metrics",AWS_DYNAMODB_PROVISIONED_READ_CAPACITY:"aws.dynamodb.provisioned_read_capacity",AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY:"aws.dynamodb.provisioned_write_capacity",AWS_DYNAMODB_CONSISTENT_READ:"aws.dynamodb.consistent_read",AWS_DYNAMODB_PROJECTION:"aws.dynamodb.projection",AWS_DYNAMODB_LIMIT:"aws.dynamodb.limit",AWS_DYNAMODB_ATTRIBUTES_TO_GET:"aws.dynamodb.attributes_to_get",AWS_DYNAMODB_INDEX_NAME:"aws.dynamodb.index_name",AWS_DYNAMODB_SELECT:"aws.dynamodb.select",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES:"aws.dynamodb.global_secondary_indexes",AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES:"aws.dynamodb.local_secondary_indexes",AWS_DYNAMODB_EXCLUSIVE_START_TABLE:"aws.dynamodb.exclusive_start_table",AWS_DYNAMODB_TABLE_COUNT:"aws.dynamodb.table_count",AWS_DYNAMODB_SCAN_FORWARD:"aws.dynamodb.scan_forward",AWS_DYNAMODB_SEGMENT:"aws.dynamodb.segment",AWS_DYNAMODB_TOTAL_SEGMENTS:"aws.dynamodb.total_segments",AWS_DYNAMODB_COUNT:"aws.dynamodb.count",AWS_DYNAMODB_SCANNED_COUNT:"aws.dynamodb.scanned_count",AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS:"aws.dynamodb.attribute_definitions",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES:"aws.dynamodb.global_secondary_index_updates",MESSAGING_SYSTEM:"messaging.system",MESSAGING_DESTINATION:"messaging.destination",MESSAGING_DESTINATION_KIND:"messaging.destination_kind",MESSAGING_TEMP_DESTINATION:"messaging.temp_destination",MESSAGING_PROTOCOL:"messaging.protocol",MESSAGING_PROTOCOL_VERSION:"messaging.protocol_version",MESSAGING_URL:"messaging.url",MESSAGING_MESSAGE_ID:"messaging.message_id",MESSAGING_CONVERSATION_ID:"messaging.conversation_id",MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES:"messaging.message_payload_size_bytes",MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES:"messaging.message_payload_compressed_size_bytes",MESSAGING_OPERATION:"messaging.operation",MESSAGING_CONSUMER_ID:"messaging.consumer_id",MESSAGING_RABBITMQ_ROUTING_KEY:"messaging.rabbitmq.routing_key",MESSAGING_KAFKA_MESSAGE_KEY:"messaging.kafka.message_key",MESSAGING_KAFKA_CONSUMER_GROUP:"messaging.kafka.consumer_group",MESSAGING_KAFKA_CLIENT_ID:"messaging.kafka.client_id",MESSAGING_KAFKA_PARTITION:"messaging.kafka.partition",MESSAGING_KAFKA_TOMBSTONE:"messaging.kafka.tombstone",RPC_SYSTEM:"rpc.system",RPC_SERVICE:"rpc.service",RPC_METHOD:"rpc.method",RPC_GRPC_STATUS_CODE:"rpc.grpc.status_code",RPC_JSONRPC_VERSION:"rpc.jsonrpc.version",RPC_JSONRPC_REQUEST_ID:"rpc.jsonrpc.request_id",RPC_JSONRPC_ERROR_CODE:"rpc.jsonrpc.error_code",RPC_JSONRPC_ERROR_MESSAGE:"rpc.jsonrpc.error_message",MESSAGE_TYPE:"message.type",MESSAGE_ID:"message.id",MESSAGE_COMPRESSED_SIZE:"message.compressed_size",MESSAGE_UNCOMPRESSED_SIZE:"message.uncompressed_size"},M={CLOUD_PROVIDER:"cloud.provider",CLOUD_ACCOUNT_ID:"cloud.account.id",CLOUD_REGION:"cloud.region",CLOUD_AVAILABILITY_ZONE:"cloud.availability_zone",CLOUD_PLATFORM:"cloud.platform",AWS_ECS_CONTAINER_ARN:"aws.ecs.container.arn",AWS_ECS_CLUSTER_ARN:"aws.ecs.cluster.arn",AWS_ECS_LAUNCHTYPE:"aws.ecs.launchtype",AWS_ECS_TASK_ARN:"aws.ecs.task.arn",AWS_ECS_TASK_FAMILY:"aws.ecs.task.family",AWS_ECS_TASK_REVISION:"aws.ecs.task.revision",AWS_EKS_CLUSTER_ARN:"aws.eks.cluster.arn",AWS_LOG_GROUP_NAMES:"aws.log.group.names",AWS_LOG_GROUP_ARNS:"aws.log.group.arns",AWS_LOG_STREAM_NAMES:"aws.log.stream.names",AWS_LOG_STREAM_ARNS:"aws.log.stream.arns",CONTAINER_NAME:"container.name",CONTAINER_ID:"container.id",CONTAINER_RUNTIME:"container.runtime",CONTAINER_IMAGE_NAME:"container.image.name",CONTAINER_IMAGE_TAG:"container.image.tag",DEPLOYMENT_ENVIRONMENT:"deployment.environment",DEVICE_ID:"device.id",DEVICE_MODEL_IDENTIFIER:"device.model.identifier",DEVICE_MODEL_NAME:"device.model.name",FAAS_NAME:"faas.name",FAAS_ID:"faas.id",FAAS_VERSION:"faas.version",FAAS_INSTANCE:"faas.instance",FAAS_MAX_MEMORY:"faas.max_memory",HOST_ID:"host.id",HOST_NAME:"host.name",HOST_TYPE:"host.type",HOST_ARCH:"host.arch",HOST_IMAGE_NAME:"host.image.name",HOST_IMAGE_ID:"host.image.id",HOST_IMAGE_VERSION:"host.image.version",K8S_CLUSTER_NAME:"k8s.cluster.name",K8S_NODE_NAME:"k8s.node.name",K8S_NODE_UID:"k8s.node.uid",K8S_NAMESPACE_NAME:"k8s.namespace.name",K8S_POD_UID:"k8s.pod.uid",K8S_POD_NAME:"k8s.pod.name",K8S_CONTAINER_NAME:"k8s.container.name",K8S_REPLICASET_UID:"k8s.replicaset.uid",K8S_REPLICASET_NAME:"k8s.replicaset.name",K8S_DEPLOYMENT_UID:"k8s.deployment.uid",K8S_DEPLOYMENT_NAME:"k8s.deployment.name",K8S_STATEFULSET_UID:"k8s.statefulset.uid",K8S_STATEFULSET_NAME:"k8s.statefulset.name",K8S_DAEMONSET_UID:"k8s.daemonset.uid",K8S_DAEMONSET_NAME:"k8s.daemonset.name",K8S_JOB_UID:"k8s.job.uid",K8S_JOB_NAME:"k8s.job.name",K8S_CRONJOB_UID:"k8s.cronjob.uid",K8S_CRONJOB_NAME:"k8s.cronjob.name",OS_TYPE:"os.type",OS_DESCRIPTION:"os.description",OS_NAME:"os.name",OS_VERSION:"os.version",PROCESS_PID:"process.pid",PROCESS_EXECUTABLE_NAME:"process.executable.name",PROCESS_EXECUTABLE_PATH:"process.executable.path",PROCESS_COMMAND:"process.command",PROCESS_COMMAND_LINE:"process.command_line",PROCESS_COMMAND_ARGS:"process.command_args",PROCESS_OWNER:"process.owner",PROCESS_RUNTIME_NAME:"process.runtime.name",PROCESS_RUNTIME_VERSION:"process.runtime.version",PROCESS_RUNTIME_DESCRIPTION:"process.runtime.description",SERVICE_NAME:"service.name",SERVICE_NAMESPACE:"service.namespace",SERVICE_INSTANCE_ID:"service.instance.id",SERVICE_VERSION:"service.version",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version",TELEMETRY_AUTO_VERSION:"telemetry.auto.version",WEBENGINE_NAME:"webengine.name",WEBENGINE_VERSION:"webengine.version",WEBENGINE_DESCRIPTION:"webengine.description"},$o={CPP:"cpp",DOTNET:"dotnet",ERLANG:"erlang",GO:"go",JAVA:"java",NODEJS:"nodejs",PHP:"php",PYTHON:"python",RUBY:"ruby",WEBJS:"webjs"},Er=Zt("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function qo(t){return t.setValue(Er,!0)}function an(t){return t.getValue(Er)===!0}var Jo="=",Ht=";",Xt=",",Tt="baggage",Qo=180,Zo=4096,ea=8192,ta=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function na(t){return t.reduce(function(e,n){var r=""+e+(e!==""?Xt:"")+n;return r.length>ea?e:r},"")}function ra(t){return t.getAllEntries().map(function(e){var n=ta(e,2),r=n[0],i=n[1],o=encodeURIComponent(r)+"="+encodeURIComponent(i.value);return i.metadata!==void 0&&(o+=Ht+i.metadata.toString()),o})}function ia(t){var e=t.split(Ht);if(!(e.length<=0)){var n=e.shift();if(n){var r=n.indexOf(Jo);if(!(r<=0)){var i=decodeURIComponent(n.substring(0,r).trim()),o=decodeURIComponent(n.substring(r+1).trim()),a;return e.length>0&&(a=ar(e.join(Ht))),{key:i,value:o,metadata:a}}}}}var oa=function(){function t(){}return t.prototype.inject=function(e,n,r){var i=Ye.getBaggage(e);if(!(!i||an(e))){var o=ra(i).filter(function(u){return u.length<=Zo}).slice(0,Qo),a=na(o);a.length>0&&r.set(n,Tt,a)}},t.prototype.extract=function(e,n,r){var i=r.get(n,Tt),o=Array.isArray(i)?i.join(Xt):i;if(!o)return e;var a={};if(o.length===0)return e;var u=o.split(Xt);return u.forEach(function(c){var s=ia(c);if(s){var l={value:s.value};s.metadata&&(l.metadata=s.metadata),a[s.key]=l}}),Object.entries(a).length===0?e:Ye.setBaggage(e,Ye.createBaggage(a))},t.prototype.fields=function(){return[Tt]},t}(),gr=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},aa=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function ze(t){var e,n,r={};if(typeof t!="object"||t==null)return r;try{for(var i=gr(Object.entries(t)),o=i.next();!o.done;o=i.next()){var a=aa(o.value,2),u=a[0],c=a[1];if(!sa(u)){_.warn("Invalid attribute key: "+u);continue}if(!yr(c)){_.warn("Invalid attribute value set for key: "+u);continue}Array.isArray(c)?r[u]=c.slice():r[u]=c}}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function sa(t){return typeof t=="string"&&t.length>0}function yr(t){return t==null?!0:Array.isArray(t)?ua(t):mr(t)}function ua(t){var e,n,r;try{for(var i=gr(t),o=i.next();!o.done;o=i.next()){var a=o.value;if(a!=null){if(!r){if(mr(a)){r=typeof a;continue}return!1}if(typeof a!==r)return!1}}}catch(u){e={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return!0}function mr(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}function ca(){return function(t){_.error(la(t))}}function la(t){return typeof t=="string"?t:JSON.stringify(fa(t))}function fa(t){for(var e={},n=t;n!==null;)Object.getOwnPropertyNames(n).forEach(function(r){if(!e[r]){var i=n[r];i&&(e[r]=String(i))}}),n=Object.getPrototypeOf(n);return e}var da=ca();function rt(t){try{da(t)}catch{}}var U;(function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"})(U||(U={}));var Tr=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Pn={},_a=",",ha=["OTEL_SDK_DISABLED"];function pa(t){return ha.indexOf(t)>-1}var va=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Ea(t){return va.indexOf(t)>-1}var ga=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function ya(t){return ga.indexOf(t)>-1}var $e=1/0,qe=128,ma=128,Ta=128,Sr={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:g.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:$e,OTEL_ATTRIBUTE_COUNT_LIMIT:qe,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:$e,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:qe,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:$e,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:qe,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:ma,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:Ta,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:U.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};function Sa(t,e,n){if(!(typeof n[t]>"u")){var r=String(n[t]);e[t]=r.toLowerCase()==="true"}}function Oa(t,e,n,r,i){if(r===void 0&&(r=-1/0),i===void 0&&(i=1/0),typeof n[t]<"u"){var o=Number(n[t]);isNaN(o)||(o<r?e[t]=r:o>i?e[t]=i:e[t]=o)}}function ba(t,e,n,r){r===void 0&&(r=_a);var i=n[t];typeof i=="string"&&(e[t]=i.split(r).map(function(o){return o.trim()}))}var Aa={ALL:g.ALL,VERBOSE:g.VERBOSE,DEBUG:g.DEBUG,INFO:g.INFO,WARN:g.WARN,ERROR:g.ERROR,NONE:g.NONE};function Ra(t,e,n){var r=n[t];if(typeof r=="string"){var i=Aa[r.toUpperCase()];i!=null&&(e[t]=i)}}function Kt(t){var e={};for(var n in Sr){var r=n;switch(r){case"OTEL_LOG_LEVEL":Ra(r,e,t);break;default:if(pa(r))Sa(r,e,t);else if(Ea(r))Oa(r,e,t);else if(ya(r))ba(r,e,t);else{var i=t[r];typeof i<"u"&&i!==null&&(e[r]=String(i))}}}return e}function Ca(){return Kt(typeof process<"u"&&process&&Pn?Pn:Tr)}function N(){var t=Kt(Tr);return Object.assign({},Sr,t)}var ue=performance,Ia="1.18.1",re,St=(re={},re[M.TELEMETRY_SDK_NAME]="opentelemetry",re[M.PROCESS_RUNTIME_NAME]="browser",re[M.TELEMETRY_SDK_LANGUAGE]=$o.WEBJS,re[M.TELEMETRY_SDK_VERSION]=Ia,re);var wa=9,Na=6,Ma=Math.pow(10,Na),Wt=Math.pow(10,wa);function oe(t){var e=t/1e3,n=Math.trunc(e),r=Math.round(t%1e3*Ma);return[n,r]}function Or(){var t=ue.timeOrigin;if(typeof t!="number"){var e=ue;t=e.timing&&e.timing.fetchStart}return t}function Pa(t){var e=oe(Or()),n=oe(typeof t=="number"?t:ue.now());return Ar(e,n)}function La(t,e){var n=e[0]-t[0],r=e[1]-t[1];return r<0&&(n-=1,r+=Wt),[n,r]}function br(t){return Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"}function Ln(t){return br(t)||typeof t=="number"||t instanceof Date}function Ar(t,e){var n=[t[0]+e[0],t[1]+e[1]];return n[1]>=Wt&&(n[1]-=Wt,n[0]+=1),n}var Yt;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"})(Yt||(Yt={}));var Da=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ua=function(){function t(e){e===void 0&&(e={});var n;this._propagators=(n=e.propagators)!==null&&n!==void 0?n:[],this._fields=Array.from(new Set(this._propagators.map(function(r){return typeof r.fields=="function"?r.fields():[]}).reduce(function(r,i){return r.concat(i)},[])))}return t.prototype.inject=function(e,n,r){var i,o;try{for(var a=Da(this._propagators),u=a.next();!u.done;u=a.next()){var c=u.value;try{c.inject(e,n,r)}catch(s){_.warn("Failed to inject with "+c.constructor.name+". Err: "+s.message)}}}catch(s){i={error:s}}finally{try{u&&!u.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}},t.prototype.extract=function(e,n,r){return this._propagators.reduce(function(i,o){try{return o.extract(i,n,r)}catch(a){_.warn("Failed to inject with "+o.constructor.name+". Err: "+a.message)}return i},e)},t.prototype.fields=function(){return this._fields.slice()},t}(),zt="[_0-9a-z-*/]",xa="[a-z]"+zt+"{0,255}",ka="[a-z0-9]"+zt+"{0,240}@[a-z]"+zt+"{0,13}",Ba=new RegExp("^(?:"+xa+"|"+ka+")$"),Ga=/^[ -~]{0,255}[!-~]$/,Va=/,|=/;function ja(t){return Ba.test(t)}function Fa(t){return Ga.test(t)&&!Va.test(t)}var Dn=32,Ha=512,Un=",",xn="=",Xa=function(){function t(e){this._internalState=new Map,e&&this._parse(e)}return t.prototype.set=function(e,n){var r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,n),r},t.prototype.unset=function(e){var n=this._clone();return n._internalState.delete(e),n},t.prototype.get=function(e){return this._internalState.get(e)},t.prototype.serialize=function(){var e=this;return this._keys().reduce(function(n,r){return n.push(r+xn+e.get(r)),n},[]).join(Un)},t.prototype._parse=function(e){e.length>Ha||(this._internalState=e.split(Un).reverse().reduce(function(n,r){var i=r.trim(),o=i.indexOf(xn);if(o!==-1){var a=i.slice(0,o),u=i.slice(o+1,r.length);ja(a)&&Fa(u)&&n.set(a,u)}return n},new Map),this._internalState.size>Dn&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,Dn))))},t.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},t.prototype._clone=function(){var e=new t;return e._internalState=new Map(this._internalState),e},t}(),Ot="traceparent",bt="tracestate",Ka="00",Wa="(?!ff)[\\da-f]{2}",Ya="(?![0]{32})[\\da-f]{32}",za="(?![0]{16})[\\da-f]{16}",$a="[\\da-f]{2}",qa=new RegExp("^\\s?("+Wa+")-("+Ya+")-("+za+")-("+$a+")(-.*)?\\s?$");function Ja(t){var e=qa.exec(t);return!e||e[1]==="00"&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}}var Qa=function(){function t(){}return t.prototype.inject=function(e,n,r){var i=D.getSpanContext(e);if(!(!i||an(e)||!dt(i))){var o=Ka+"-"+i.traceId+"-"+i.spanId+"-0"+Number(i.traceFlags||G.NONE).toString(16);r.set(n,Ot,o),i.traceState&&r.set(n,bt,i.traceState.serialize())}},t.prototype.extract=function(e,n,r){var i=r.get(n,Ot);if(!i)return e;var o=Array.isArray(i)?i[0]:i;if(typeof o!="string")return e;var a=Ja(o);if(!a)return e;a.isRemote=!0;var u=r.get(n,bt);if(u){var c=Array.isArray(u)?u.join(","):u;a.traceState=new Xa(typeof c=="string"?c:void 0)}return D.setSpanContext(e,a)},t.prototype.fields=function(){return[Ot,bt]},t}(),Za="[object Object]",es="[object Null]",ts="[object Undefined]",ns=Function.prototype,Rr=ns.toString,rs=Rr.call(Object),is=os(Object.getPrototypeOf,Object),Cr=Object.prototype,Ir=Cr.hasOwnProperty,$=Symbol?Symbol.toStringTag:void 0,wr=Cr.toString;function os(t,e){return function(n){return t(e(n))}}function kn(t){if(!as(t)||ss(t)!==Za)return!1;var e=is(t);if(e===null)return!0;var n=Ir.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&Rr.call(n)===rs}function as(t){return t!=null&&typeof t=="object"}function ss(t){return t==null?t===void 0?ts:es:$&&$ in Object(t)?us(t):cs(t)}function us(t){var e=Ir.call(t,$),n=t[$],r=!1;try{t[$]=void 0,r=!0}catch{}var i=wr.call(t);return r&&(e?t[$]=n:delete t[$]),i}function cs(t){return wr.call(t)}var ls=20;function fs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t.shift(),r=new WeakMap;t.length>0;)n=Nr(n,t.shift(),0,r);return n}function At(t){return it(t)?t.slice():t}function Nr(t,e,n,r){n===void 0&&(n=0);var i;if(!(n>ls)){if(n++,Je(t)||Je(e)||Mr(e))i=At(e);else if(it(t)){if(i=t.slice(),it(e))for(var o=0,a=e.length;o<a;o++)i.push(At(e[o]));else if(ge(e))for(var u=Object.keys(e),o=0,a=u.length;o<a;o++){var c=u[o];i[c]=At(e[c])}}else if(ge(t))if(ge(e)){if(!ds(t,e))return e;i=Object.assign({},t);for(var u=Object.keys(e),o=0,a=u.length;o<a;o++){var c=u[o],s=e[c];if(Je(s))typeof s>"u"?delete i[c]:i[c]=s;else{var l=i[c],f=s;if(Bn(t,c,r)||Bn(e,c,r))delete i[c];else{if(ge(l)&&ge(f)){var d=r.get(l)||[],h=r.get(f)||[];d.push({obj:t,key:c}),h.push({obj:e,key:c}),r.set(l,d),r.set(f,h)}i[c]=Nr(i[c],s,n,r)}}}}else i=e;return i}}function Bn(t,e,n){for(var r=n.get(t[e])||[],i=0,o=r.length;i<o;i++){var a=r[i];if(a.key===e&&a.obj===t)return!0}return!1}function it(t){return Array.isArray(t)}function Mr(t){return typeof t=="function"}function ge(t){return!Je(t)&&!it(t)&&!Mr(t)&&typeof t=="object"}function Je(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t>"u"||t instanceof Date||t instanceof RegExp||t===null}function ds(t,e){return!(!kn(t)||!kn(e))}var _s=function(){function t(){var e=this;this._promise=new Promise(function(n,r){e._resolve=n,e._reject=r})}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),t.prototype.resolve=function(e){this._resolve(e)},t.prototype.reject=function(e){this._reject(e)},t}(),hs=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},ps=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))},vs=function(){function t(e,n){this._callback=e,this._that=n,this._isCalled=!1,this._deferred=new _s}return Object.defineProperty(t.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),t.prototype.call=function(){for(var e,n=this,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,ps([this._that],hs(r),!1))).then(function(o){return n._deferred.resolve(o)},function(o){return n._deferred.reject(o)})}catch(o){this._deferred.reject(o)}}return this._deferred.promise},t}(),Es="exception",gs=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ys=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},ms=function(){function t(e,n,r,i,o,a,u,c,s){u===void 0&&(u=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:Gt.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=r,this._spanContext=i,this.parentSpanId=a,this.kind=o,this.links=u;var l=Date.now();this._performanceStartTime=ue.now(),this._performanceOffset=l-(this._performanceStartTime+Or()),this._startTimeProvided=c!=null,this.startTime=this._getTime(c??l),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,n),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,n){return n==null||this._isSpanEnded()?this:e.length===0?(_.warn("Invalid attribute key: "+e),this):yr(n)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(n),this):(_.warn("Invalid attribute value set for key: "+e),this)},t.prototype.setAttributes=function(e){var n,r;try{for(var i=gs(Object.entries(e)),o=i.next();!o.done;o=i.next()){var a=ys(o.value,2),u=a[0],c=a[1];this.setAttribute(u,c)}}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return this},t.prototype.addEvent=function(e,n,r){if(this._isSpanEnded())return this;if(this._spanLimits.eventCountLimit===0)return _.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(_.warn("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),Ln(n)&&(Ln(r)||(r=n),n=void 0);var i=ze(n);return this.events.push({name:e,attributes:i,time:this._getTime(r),droppedAttributesCount:0}),this},t.prototype.setStatus=function(e){return this._isSpanEnded()?this:(this.status=e,this)},t.prototype.updateName=function(e){return this._isSpanEnded()?this:(this.name=e,this)},t.prototype.end=function(e){if(this._isSpanEnded()){_.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once.");return}this._ended=!0,this.endTime=this._getTime(e),this._duration=La(this.startTime,this.endTime),this._duration[0]<0&&(_.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._spanProcessor.onEnd(this)},t.prototype._getTime=function(e){if(typeof e=="number"&&e<ue.now())return Pa(e+this._performanceOffset);if(typeof e=="number")return oe(e);if(e instanceof Date)return oe(e.getTime());if(br(e))return e;if(this._startTimeProvided)return oe(Date.now());var n=ue.now()-this._performanceStartTime;return Ar(this.startTime,oe(n))},t.prototype.isRecording=function(){return this._ended===!1},t.prototype.recordException=function(e,n){var r={};typeof e=="string"?r[Y.EXCEPTION_MESSAGE]=e:e&&(e.code?r[Y.EXCEPTION_TYPE]=e.code.toString():e.name&&(r[Y.EXCEPTION_TYPE]=e.name),e.message&&(r[Y.EXCEPTION_MESSAGE]=e.message),e.stack&&(r[Y.EXCEPTION_STACKTRACE]=e.stack)),r[Y.EXCEPTION_TYPE]||r[Y.EXCEPTION_MESSAGE]?this.addEvent(Es,r,n):_.warn("Failed to record an exception "+e)},Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),t.prototype._isSpanEnded=function(){return this._ended&&_.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},t.prototype._truncateToLimitUtil=function(e,n){return e.length<=n?e:e.substr(0,n)},t.prototype._truncateToSize=function(e){var n=this,r=this._attributeValueLengthLimit;return r<=0?(_.warn("Attribute value limit must be positive, got "+r),e):typeof e=="string"?this._truncateToLimitUtil(e,r):Array.isArray(e)?e.map(function(i){return typeof i=="string"?n._truncateToLimitUtil(i,r):i}):e},t}(),fe;(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(fe||(fe={}));var ot=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:fe.NOT_RECORD}},t.prototype.toString=function(){return"AlwaysOffSampler"},t}(),ce=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:fe.RECORD_AND_SAMPLED}},t.prototype.toString=function(){return"AlwaysOnSampler"},t}(),Rt=function(){function t(e){var n,r,i,o;this._root=e.root,this._root||(rt(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new ce),this._remoteParentSampled=(n=e.remoteParentSampled)!==null&&n!==void 0?n:new ce,this._remoteParentNotSampled=(r=e.remoteParentNotSampled)!==null&&r!==void 0?r:new ot,this._localParentSampled=(i=e.localParentSampled)!==null&&i!==void 0?i:new ce,this._localParentNotSampled=(o=e.localParentNotSampled)!==null&&o!==void 0?o:new ot}return t.prototype.shouldSample=function(e,n,r,i,o,a){var u=D.getSpanContext(e);return!u||!dt(u)?this._root.shouldSample(e,n,r,i,o,a):u.isRemote?u.traceFlags&G.SAMPLED?this._remoteParentSampled.shouldSample(e,n,r,i,o,a):this._remoteParentNotSampled.shouldSample(e,n,r,i,o,a):u.traceFlags&G.SAMPLED?this._localParentSampled.shouldSample(e,n,r,i,o,a):this._localParentNotSampled.shouldSample(e,n,r,i,o,a)},t.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},t}(),Gn=function(){function t(e){e===void 0&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(this._ratio*4294967295)}return t.prototype.shouldSample=function(e,n){return{decision:fr(n)&&this._accumulate(n)<this._upperBound?fe.RECORD_AND_SAMPLED:fe.NOT_RECORD}},t.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},t.prototype._normalize=function(e){return typeof e!="number"||isNaN(e)?0:e>=1?1:e<=0?0:e},t.prototype._accumulate=function(e){for(var n=0,r=0;r<e.length/8;r++){var i=r*8,o=parseInt(e.slice(i,i+8),16);n=(n^o)>>>0}return n},t}(),Ts=N(),Ss=U.AlwaysOn,ie=1;function Pr(){return{sampler:Lr(Ts),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:N().OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:N().OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:N().OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:N().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:N().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:N().OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:N().OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:N().OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT}}}function Lr(t){switch(t===void 0&&(t=N()),t.OTEL_TRACES_SAMPLER){case U.AlwaysOn:return new ce;case U.AlwaysOff:return new ot;case U.ParentBasedAlwaysOn:return new Rt({root:new ce});case U.ParentBasedAlwaysOff:return new Rt({root:new ot});case U.TraceIdRatio:return new Gn(Vn(t));case U.ParentBasedTraceIdRatio:return new Rt({root:new Gn(Vn(t))});default:return _.error('OTEL_TRACES_SAMPLER value "'+t.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+Ss+'".'),new ce}}function Vn(t){if(t.OTEL_TRACES_SAMPLER_ARG===void 0||t.OTEL_TRACES_SAMPLER_ARG==="")return _.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to "+ie+"."),ie;var e=Number(t.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(_.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to "+ie+"."),ie):e<0||e>1?(_.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to "+ie+"."),ie):e}function Os(t){var e={sampler:Lr()},n=Pr(),r=Object.assign({},n,e,t);return r.generalLimits=Object.assign({},n.generalLimits,t.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,t.spanLimits||{}),r}function bs(t){var e,n,r,i,o,a,u,c,s,l,f,d,h=Object.assign({},t.spanLimits),v=Ca();return h.attributeCountLimit=(a=(o=(i=(n=(e=t.spanLimits)===null||e===void 0?void 0:e.attributeCountLimit)!==null&&n!==void 0?n:(r=t.generalLimits)===null||r===void 0?void 0:r.attributeCountLimit)!==null&&i!==void 0?i:v.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)!==null&&o!==void 0?o:v.OTEL_ATTRIBUTE_COUNT_LIMIT)!==null&&a!==void 0?a:qe,h.attributeValueLengthLimit=(d=(f=(l=(c=(u=t.spanLimits)===null||u===void 0?void 0:u.attributeValueLengthLimit)!==null&&c!==void 0?c:(s=t.generalLimits)===null||s===void 0?void 0:s.attributeValueLengthLimit)!==null&&l!==void 0?l:v.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&f!==void 0?f:v.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&d!==void 0?d:$e,Object.assign({},t,{spanLimits:h})}var As=function(){function t(e,n){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;var r=N();this._maxExportBatchSize=typeof(n==null?void 0:n.maxExportBatchSize)=="number"?n.maxExportBatchSize:r.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize=typeof(n==null?void 0:n.maxQueueSize)=="number"?n.maxQueueSize:r.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis=typeof(n==null?void 0:n.scheduledDelayMillis)=="number"?n.scheduledDelayMillis:r.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis=typeof(n==null?void 0:n.exportTimeoutMillis)=="number"?n.exportTimeoutMillis:r.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new vs(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(_.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return t.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},t.prototype.onStart=function(e,n){},t.prototype.onEnd=function(e){this._shutdownOnce.isCalled||e.spanContext().traceFlags&G.SAMPLED&&this._addToBuffer(e)},t.prototype.shutdown=function(){return this._shutdownOnce.call()},t.prototype._shutdown=function(){var e=this;return Promise.resolve().then(function(){return e.onShutdown()}).then(function(){return e._flushAll()}).then(function(){return e._exporter.shutdown()})},t.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize){this._droppedSpansCount===0&&_.debug("maxQueueSize reached, dropping spans"),this._droppedSpansCount++;return}this._droppedSpansCount>0&&(_.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},t.prototype._flushAll=function(){var e=this;return new Promise(function(n,r){for(var i=[],o=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize),a=0,u=o;a<u;a++)i.push(e._flushOneBatch());Promise.all(i).then(function(){n()}).catch(r)})},t.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),this._finishedSpans.length===0?Promise.resolve():new Promise(function(n,r){var i=setTimeout(function(){r(new Error("Timeout"))},e._exportTimeoutMillis);ee.with(qo(ee.active()),function(){var o=e._finishedSpans.splice(0,e._maxExportBatchSize),a=function(){return e._exporter.export(o,function(c){var s;clearTimeout(i),c.code===Yt.SUCCESS?n():r((s=c.error)!==null&&s!==void 0?s:new Error("BatchSpanProcessor: span export failed"))})},u=o.map(function(c){return c.resource}).filter(function(c){return c.asyncAttributesPending});u.length===0?a():Promise.all(u.map(function(c){var s;return(s=c.waitForAsyncAttributes)===null||s===void 0?void 0:s.call(c)})).then(a,function(c){rt(c),r(c)})})})},t.prototype._maybeStartTimer=function(){var e=this;if(!this._isExporting){var n=function(){e._isExporting=!0,e._flushOneBatch().then(function(){e._isExporting=!1,e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())}).catch(function(r){e._isExporting=!1,rt(r)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return n();this._timer===void 0&&(this._timer=setTimeout(function(){return n()},this._scheduledDelayMillis),this._timer,void 0)}},t.prototype._clearTimer=function(){this._timer!==void 0&&(clearTimeout(this._timer),this._timer=void 0)},t}(),Rs=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Dr=function(t){Rs(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.onInit(r),i}return e.prototype.onInit=function(n){var r=this;(n==null?void 0:n.disableAutoFlushOnDocumentHide)!==!0&&typeof document<"u"&&(this._visibilityChangeListener=function(){document.visibilityState==="hidden"&&r.forceFlush()},this._pageHideListener=function(){r.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},e.prototype.onShutdown=function(){typeof document<"u"&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},e}(As),Cs=8,Is=16,ws=function(){function t(){this.generateTraceId=jn(Is),this.generateSpanId=jn(Cs)}return t}(),je=Array(32);function jn(t){return function(){for(var n=0;n<t*2;n++)je[n]=Math.floor(Math.random()*16)+48,je[n]>=58&&(je[n]+=39);return String.fromCharCode.apply(null,je.slice(0,t*2))}}var Ns=function(){function t(e,n,r){this._tracerProvider=r;var i=Os(n);this._sampler=i.sampler,this._generalLimits=i.generalLimits,this._spanLimits=i.spanLimits,this._idGenerator=n.idGenerator||new ws,this.resource=r.resource,this.instrumentationLibrary=e}return t.prototype.startSpan=function(e,n,r){var i,o,a;n===void 0&&(n={}),r===void 0&&(r=ee.active()),n.root&&(r=D.deleteSpan(r));var u=D.getSpan(r);if(an(r)){_.debug("Instrumentation suppressed, returning Noop Span");var c=D.wrapSpanContext(cr);return c}var s=u==null?void 0:u.spanContext(),l=this._idGenerator.generateSpanId(),f,d,h;!s||!D.isSpanContextValid(s)?f=this._idGenerator.generateTraceId():(f=s.traceId,d=s.traceState,h=s.spanId);var v=(i=n.kind)!==null&&i!==void 0?i:Bt.INTERNAL,y=((o=n.links)!==null&&o!==void 0?o:[]).map(function(E){return{context:E.context,attributes:ze(E.attributes)}}),O=ze(n.attributes),b=this._sampler.shouldSample(r,f,e,v,O,y);d=(a=b.traceState)!==null&&a!==void 0?a:d;var A=b.decision===tt.RECORD_AND_SAMPLED?G.SAMPLED:G.NONE,C={traceId:f,spanId:l,traceFlags:A,traceState:d};if(b.decision===tt.NOT_RECORD){_.debug("Recording is off, propagating context in a non-recording span");var c=D.wrapSpanContext(C);return c}var w=new ms(this,r,e,C,v,h,y,n.startTime),R=ze(Object.assign(O,b.attributes));return w.setAttributes(R),w},t.prototype.startActiveSpan=function(e,n,r,i){var o,a,u;if(!(arguments.length<2)){arguments.length===2?u=n:arguments.length===3?(o=n,u=r):(o=n,a=r,u=i);var c=a??ee.active(),s=this.startSpan(e,o,c),l=D.setSpan(c,s);return ee.with(l,u,void 0,s)}},t.prototype.getGeneralLimits=function(){return this._generalLimits},t.prototype.getSpanLimits=function(){return this._spanLimits},t.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},t}();function Ms(){return"unknown_service"}var j=function(){return j=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},j.apply(this,arguments)},Ps=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(l){try{s(r.next(l))}catch(f){a(f)}}function c(l){try{s(r.throw(l))}catch(f){a(f)}}function s(l){l.done?o(l.value):i(l.value).then(u,c)}s((r=r.apply(t,e||[])).next())})},Ls=function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(s){return function(l){return c([s,l])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=s[0]&2?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=e.call(t,n)}catch(l){s=[6,l],i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Ds=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Fn=function(){function t(e,n){var r=this,i;this._attributes=e,this.asyncAttributesPending=n!=null,this._syncAttributes=(i=this._attributes)!==null&&i!==void 0?i:{},this._asyncAttributesPromise=n==null?void 0:n.then(function(o){return r._attributes=Object.assign({},r._attributes,o),r.asyncAttributesPending=!1,o},function(o){return _.debug("a resource's async attributes promise rejected: %s",o),r.asyncAttributesPending=!1,{}})}return t.empty=function(){return t.EMPTY},t.default=function(){var e;return new t((e={},e[M.SERVICE_NAME]=Ms(),e[M.TELEMETRY_SDK_LANGUAGE]=St[M.TELEMETRY_SDK_LANGUAGE],e[M.TELEMETRY_SDK_NAME]=St[M.TELEMETRY_SDK_NAME],e[M.TELEMETRY_SDK_VERSION]=St[M.TELEMETRY_SDK_VERSION],e))},Object.defineProperty(t.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&_.error("Accessing resource attributes before async attributes settled"),(e=this._attributes)!==null&&e!==void 0?e:{}},enumerable:!1,configurable:!0}),t.prototype.waitForAsyncAttributes=function(){return Ps(this,void 0,void 0,function(){return Ls(this,function(e){switch(e.label){case 0:return this.asyncAttributesPending?[4,this._asyncAttributesPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.merge=function(e){var n=this,r;if(!e)return this;var i=j(j({},this._syncAttributes),(r=e._syncAttributes)!==null&&r!==void 0?r:e.attributes);if(!this._asyncAttributesPromise&&!e._asyncAttributesPromise)return new t(i);var o=Promise.all([this._asyncAttributesPromise,e._asyncAttributesPromise]).then(function(a){var u,c=Ds(a,2),s=c[0],l=c[1];return j(j(j(j({},n._syncAttributes),s),(u=e._syncAttributes)!==null&&u!==void 0?u:e.attributes),l)});return new t(i,o)},t.EMPTY=new t({}),t}(),Fe=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Us=function(){function t(e){this._spanProcessors=e}return t.prototype.forceFlush=function(){var e,n,r=[];try{for(var i=Fe(this._spanProcessors),o=i.next();!o.done;o=i.next()){var a=o.value;r.push(a.forceFlush())}}catch(u){e={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return new Promise(function(u){Promise.all(r).then(function(){u()}).catch(function(c){rt(c||new Error("MultiSpanProcessor: forceFlush failed")),u()})})},t.prototype.onStart=function(e,n){var r,i;try{for(var o=Fe(this._spanProcessors),a=o.next();!a.done;a=o.next()){var u=a.value;u.onStart(e,n)}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},t.prototype.onEnd=function(e){var n,r;try{for(var i=Fe(this._spanProcessors),o=i.next();!o.done;o=i.next()){var a=o.value;a.onEnd(e)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.shutdown=function(){var e,n,r=[];try{for(var i=Fe(this._spanProcessors),o=i.next();!o.done;o=i.next()){var a=o.value;r.push(a.shutdown())}}catch(u){e={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return new Promise(function(u,c){Promise.all(r).then(function(){u()},c)})},t}(),xs=function(){function t(){}return t.prototype.onStart=function(e,n){},t.prototype.onEnd=function(e){},t.prototype.shutdown=function(){return Promise.resolve()},t.prototype.forceFlush=function(){return Promise.resolve()},t}(),q;(function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"})(q||(q={}));var ks=function(){function t(e){e===void 0&&(e={});var n;this._registeredSpanProcessors=[],this._tracers=new Map;var r=fs({},Pr(),bs(e));this.resource=(n=r.resource)!==null&&n!==void 0?n:Fn.empty(),this.resource=Fn.default().merge(this.resource),this._config=Object.assign({},r,{resource:this.resource});var i=this._buildExporterFromEnv();if(i!==void 0){var o=new Dr(i);this.activeSpanProcessor=o}else this.activeSpanProcessor=new xs}return t.prototype.getTracer=function(e,n,r){var i=e+"@"+(n||"")+":"+((r==null?void 0:r.schemaUrl)||"");return this._tracers.has(i)||this._tracers.set(i,new Ns({name:e,version:n,schemaUrl:r==null?void 0:r.schemaUrl},this._config,this)),this._tracers.get(i)},t.prototype.addSpanProcessor=function(e){this._registeredSpanProcessors.length===0&&this.activeSpanProcessor.shutdown().catch(function(n){return _.error("Error while trying to shutdown current span processor",n)}),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new Us(this._registeredSpanProcessors)},t.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},t.prototype.register=function(e){e===void 0&&(e={}),D.setGlobalTracerProvider(this),e.propagator===void 0&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&ee.setGlobalContextManager(e.contextManager),e.propagator&&Ye.setGlobalPropagator(e.propagator)},t.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,n=this._registeredSpanProcessors.map(function(r){return new Promise(function(i){var o,a=setTimeout(function(){i(new Error("Span processor did not completed within timeout period of "+e+" ms")),o=q.timeout},e);r.forceFlush().then(function(){clearTimeout(a),o!==q.timeout&&(o=q.resolved,i(o))}).catch(function(u){clearTimeout(a),o=q.error,i(u)})})});return new Promise(function(r,i){Promise.all(n).then(function(o){var a=o.filter(function(u){return u!==q.resolved});a.length>0?i(a):r()}).catch(function(o){return i([o])})})},t.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},t.prototype._getPropagator=function(e){var n;return(n=this.constructor._registeredPropagators.get(e))===null||n===void 0?void 0:n()},t.prototype._getSpanExporter=function(e){var n;return(n=this.constructor._registeredExporters.get(e))===null||n===void 0?void 0:n()},t.prototype._buildPropagatorFromEnv=function(){var e=this,n=Array.from(new Set(N().OTEL_PROPAGATORS)),r=n.map(function(o){var a=e._getPropagator(o);return a||_.warn('Propagator "'+o+'" requested through environment variable is unavailable.'),a}),i=r.reduce(function(o,a){return a&&o.push(a),o},[]);if(i.length!==0)return n.length===1?i[0]:new Ua({propagators:i})},t.prototype._buildExporterFromEnv=function(){var e=N().OTEL_TRACES_EXPORTER;if(!(e==="none"||e==="")){var n=this._getSpanExporter(e);return n||_.error('Exporter "'+e+'" requested through environment variable is unavailable.'),n}},t._registeredPropagators=new Map([["tracecontext",function(){return new Qa}],["baggage",function(){return new oa}]]),t._registeredExporters=new Map,t}(),Bs=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Gs=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))},Vs=function(){function t(){this._enabled=!1,this._currentContext=z}return t.prototype._bindFunction=function(e,n){e===void 0&&(e=z);var r=this,i=function(){for(var o=this,a=[],u=0;u<arguments.length;u++)a[u]=arguments[u];return r.with(e,function(){return n.apply(o,a)})};return Object.defineProperty(i,"length",{enumerable:!1,configurable:!0,writable:!1,value:n.length}),i},t.prototype.active=function(){return this._currentContext},t.prototype.bind=function(e,n){return e===void 0&&(e=this.active()),typeof n=="function"?this._bindFunction(e,n):n},t.prototype.disable=function(){return this._currentContext=z,this._enabled=!1,this},t.prototype.enable=function(){return this._enabled?this:(this._enabled=!0,this._currentContext=z,this)},t.prototype.with=function(e,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var a=this._currentContext;this._currentContext=e||z;try{return n.call.apply(n,Gs([r],Bs(i),!1))}finally{this._currentContext=a}},t}(),js=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fs=function(t){js(e,t);function e(n){n===void 0&&(n={});var r=t.call(this,n)||this;if(n.contextManager)throw"contextManager should be defined in register method not in constructor";if(n.propagator)throw"propagator should be defined in register method not in constructor";return r}return e.prototype.register=function(n){n===void 0&&(n={}),n.contextManager===void 0&&(n.contextManager=new Vs),n.contextManager&&n.contextManager.enable(),t.prototype.register.call(this,n)},e}(ks),Hs=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Ur=1e4;function Xs(t){t===void 0&&(t={});var e={};return Object.entries(t).forEach(function(n){var r=Hs(n,2),i=r[0],o=r[1];typeof o<"u"?e[i]=String(o):_.warn('Header "'+i+'" has wrong value and will be ignored')}),e}function Ks(t,e){return t.endsWith("/")||(t=t+"/"),t+e}function Ws(t,e){return!t.includes(e)&&!t.endsWith("/")&&(t=t+"/"),t}function Ys(t){return typeof t=="number"?t<=0?xr(t,Ur):t:zs()}function zs(){var t,e=Number((t=F().OTEL_EXPORTER_OTLP_TRACES_TIMEOUT)!==null&&t!==void 0?t:F().OTEL_EXPORTER_OTLP_TIMEOUT);return e<=0?xr(e,Ur):e}function xr(t,e){return _.warn("Timeout must be greater than 0",t),e}var $s=function(){function t(e){e===void 0&&(e={}),this._sendingPromises=[],this.url=this.getDefaultUrl(e),typeof e.hostname=="string"&&(this.hostname=e.hostname),this.shutdown=this.shutdown.bind(this),this._shutdownOnce=new Wo(this._shutdown,this),this._concurrencyLimit=typeof e.concurrencyLimit=="number"?e.concurrencyLimit:1/0,this.timeoutMillis=Ys(e.timeoutMillis),this.onInit(e)}return t.prototype.export=function(e,n){if(this._shutdownOnce.isCalled){n({code:J.FAILED,error:new Error("Exporter has been shutdown")});return}if(this._sendingPromises.length>=this._concurrencyLimit){n({code:J.FAILED,error:new Error("Concurrent export limit reached")});return}this._export(e).then(function(){n({code:J.SUCCESS})}).catch(function(r){n({code:J.FAILED,error:r})})},t.prototype._export=function(e){var n=this;return new Promise(function(r,i){try{_.debug("items to be sent",e),n.send(e,r,i)}catch(o){i(o)}})},t.prototype.shutdown=function(){return this._shutdownOnce.call()},t.prototype._shutdown=function(){return _.debug("shutdown started"),this.onShutdown(),Promise.all(this._sendingPromises).then(function(){})},t}(),qs=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),$t=function(t){qs(e,t);function e(n,r,i){var o=t.call(this,n)||this;return o.name="OTLPExporterError",o.data=i,o.code=r,o}return e}(Error),at=function(){return at=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},at.apply(this,arguments)},Js=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function Qs(t,e,n,r,i){if(navigator.sendBeacon(e,new Blob([t],n)))_.debug("sendBeacon - can send",t),r();else{var o=new $t("sendBeacon - cannot send "+t);i(o)}}function Zs(t,e,n,r,i,o){var a,u=setTimeout(function(){a=!0,c.abort()},r),c=new XMLHttpRequest;c.open("POST",e);var s={Accept:"application/json","Content-Type":"application/json"};Object.entries(at(at({},s),n)).forEach(function(l){var f=Js(l,2),d=f[0],h=f[1];c.setRequestHeader(d,h)}),c.send(t),c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)if(c.status>=200&&c.status<=299)clearTimeout(u),_.debug("xhr success",t),i();else if(a){var l=new $t("Request Timeout",c.status);o(l)}else{var l=new $t("Failed to export with XHR (status: "+c.status+")",c.status);clearTimeout(u),o(l)}}}var eu=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),tu=function(t){eu(e,t);function e(n){n===void 0&&(n={});var r=t.call(this,n)||this;return r._useXHR=!1,r._useXHR=!!n.headers||typeof navigator.sendBeacon!="function",r._useXHR?r._headers=Object.assign({},Xs(n.headers),_r(F().OTEL_EXPORTER_OTLP_HEADERS)):r._headers={},r}return e.prototype.onInit=function(){window.addEventListener("unload",this.shutdown)},e.prototype.onShutdown=function(){window.removeEventListener("unload",this.shutdown)},e.prototype.send=function(n,r,i){var o=this;if(this._shutdownOnce.isCalled){_.debug("Shutdown already started. Cannot send objects");return}var a=this.convert(n),u=JSON.stringify(a),c=new Promise(function(l,f){o._useXHR?Zs(u,o.url,o._headers,o.timeoutMillis,l,f):Qs(u,o.url,{type:"application/json"},l,f)}).then(r,i);this._sendingPromises.push(c);var s=function(){var l=o._sendingPromises.indexOf(c);o._sendingPromises.splice(l,1)};c.then(s,s)},e}($s),Hn;(function(t){t[t.SPAN_KIND_UNSPECIFIED=0]="SPAN_KIND_UNSPECIFIED",t[t.SPAN_KIND_INTERNAL=1]="SPAN_KIND_INTERNAL",t[t.SPAN_KIND_SERVER=2]="SPAN_KIND_SERVER",t[t.SPAN_KIND_CLIENT=3]="SPAN_KIND_CLIENT",t[t.SPAN_KIND_PRODUCER=4]="SPAN_KIND_PRODUCER",t[t.SPAN_KIND_CONSUMER=5]="SPAN_KIND_CONSUMER"})(Hn||(Hn={}));var nu=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function _t(t){return Object.keys(t).map(function(e){return kr(e,t[e])})}function kr(t,e){return{key:t,value:Br(e)}}function Br(t){var e=typeof t;return e==="string"?{stringValue:t}:e==="number"?Number.isInteger(t)?{intValue:t}:{doubleValue:t}:e==="boolean"?{boolValue:t}:t instanceof Uint8Array?{bytesValue:t}:Array.isArray(t)?{arrayValue:{values:t.map(Br)}}:e==="object"&&t!=null?{kvlistValue:{values:Object.entries(t).map(function(n){var r=nu(n,2),i=r[0],o=r[1];return kr(i,o)})}}:{}}function ru(t,e){var n=t.spanContext(),r=t.status,i=e?t.parentSpanId:t.parentSpanId!=null?Ce(t.parentSpanId):void 0;return{traceId:e?n.traceId:Ce(n.traceId),spanId:e?n.spanId:Ce(n.spanId),parentSpanId:i,name:t.name,kind:t.kind==null?0:t.kind+1,startTimeUnixNano:Ft(t.startTime),endTimeUnixNano:Ft(t.endTime),attributes:_t(t.attributes),droppedAttributesCount:0,events:t.events.map(ou),droppedEventsCount:0,status:{code:r.code,message:r.message},links:t.links.map(function(o){return iu(o,e)}),droppedLinksCount:0}}function iu(t,e){return{attributes:t.attributes?_t(t.attributes):[],spanId:e?t.context.spanId:Ce(t.context.spanId),traceId:e?t.context.traceId:Ce(t.context.traceId),droppedAttributesCount:0}}function ou(t){return{attributes:t.attributes?_t(t.attributes):[],name:t.name,timeUnixNano:Ft(t.time),droppedAttributesCount:0}}var au=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},su=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function uu(t,e){return{resourceSpans:lu(t,e)}}function cu(t){var e,n,r=new Map;try{for(var i=au(t),o=i.next();!o.done;o=i.next()){var a=o.value,u=r.get(a.resource);u||(u=new Map,r.set(a.resource,u));var c=a.instrumentationLibrary.name+"@"+(a.instrumentationLibrary.version||"")+":"+(a.instrumentationLibrary.schemaUrl||""),s=u.get(c);s||(s=[],u.set(c,s)),s.push(a)}}catch(l){e={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function lu(t,e){for(var n=cu(t),r=[],i=n.entries(),o=i.next();!o.done;){for(var a=su(o.value,2),u=a[0],c=a[1],s=[],l=c.values(),f=l.next();!f.done;){var d=f.value;if(d.length>0){var h=d[0].instrumentationLibrary,v=h.name,y=h.version,O=h.schemaUrl,b=d.map(function(C){return ru(C,e)});s.push({scope:{name:v,version:y},spans:b,schemaUrl:O})}f=l.next()}var A={resource:{attributes:_t(u.attributes),droppedAttributesCount:0},scopeSpans:s,schemaUrl:void 0};r.push(A),o=i.next()}return r}var he=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),fu=function(){function t(){}return t.prototype.createHistogram=function(e,n){return mu},t.prototype.createCounter=function(e,n){return yu},t.prototype.createUpDownCounter=function(e,n){return Tu},t.prototype.createObservableGauge=function(e,n){return Ou},t.prototype.createObservableCounter=function(e,n){return Su},t.prototype.createObservableUpDownCounter=function(e,n){return bu},t.prototype.addBatchObservableCallback=function(e,n){},t.prototype.removeBatchObservableCallback=function(e){},t}(),sn=function(){function t(){}return t}(),du=function(t){he(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(n,r){},e}(sn),_u=function(t){he(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(n,r){},e}(sn),hu=function(t){he(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(n,r){},e}(sn),un=function(){function t(){}return t.prototype.addCallback=function(e){},t.prototype.removeCallback=function(e){},t}(),pu=function(t){he(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(un),vu=function(t){he(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(un),Eu=function(t){he(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(un),gu=new fu,yu=new du,mu=new hu,Tu=new _u,Su=new pu,Ou=new vu,bu=new Eu,st;(function(t){t[t.INT=0]="INT",t[t.DOUBLE=1]="DOUBLE"})(st||(st={}));var Au=function(){function t(){}return t.prototype.getMeter=function(e,n,r){return gu},t}(),Xn=new Au,Ru=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},He=Symbol.for("io.opentelemetry.js.api.metrics"),ye=Ru;function Cu(t,e,n){return function(r){return r===t?e:n}}var Kn=4,Iu=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(e){return ye[He]?this.getMeterProvider():(ye[He]=Cu(Kn,e,Xn),e)},t.prototype.getMeterProvider=function(){var e,n;return(n=(e=ye[He])===null||e===void 0?void 0:e.call(ye,Kn))!==null&&n!==void 0?n:Xn},t.prototype.getMeter=function(e,n,r){return this.getMeterProvider().getMeter(e,n,r)},t.prototype.disable=function(){delete ye[He]},t}();Iu.getInstance();var ut;(function(t){t[t.DELTA=0]="DELTA",t[t.CUMULATIVE=1]="CUMULATIVE"})(ut||(ut={}));var Le;(function(t){t[t.HISTOGRAM=0]="HISTOGRAM",t[t.EXPONENTIAL_HISTOGRAM=1]="EXPONENTIAL_HISTOGRAM",t[t.GAUGE=2]="GAUGE",t[t.SUM=3]="SUM"})(Le||(Le={}));var wu=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();function Nu(t){var e=Object.keys(t);return e.length===0?"":(e=e.sort(),JSON.stringify(e.map(function(n){return[n,t[n]]})))}var Gr=function(t){wu(e,t);function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error);function qt(t,e){var n,r=new Promise(function(o,a){n=setTimeout(function(){a(new Gr("Operation timed out."))},e)});return Promise.race([t,r]).then(function(i){return clearTimeout(n),i},function(i){throw clearTimeout(n),i})}var de;(function(t){t[t.DROP=0]="DROP",t[t.SUM=1]="SUM",t[t.LAST_VALUE=2]="LAST_VALUE",t[t.HISTOGRAM=3]="HISTOGRAM"})(de||(de={}));var Mu=function(){function t(){this.kind=de.DROP}return t.prototype.createAccumulation=function(){},t.prototype.merge=function(e,n){},t.prototype.diff=function(e,n){},t.prototype.toMetricData=function(e,n,r,i){},t}(),I;(function(t){t.COUNTER="COUNTER",t.HISTOGRAM="HISTOGRAM",t.UP_DOWN_COUNTER="UP_DOWN_COUNTER",t.OBSERVABLE_COUNTER="OBSERVABLE_COUNTER",t.OBSERVABLE_GAUGE="OBSERVABLE_GAUGE",t.OBSERVABLE_UP_DOWN_COUNTER="OBSERVABLE_UP_DOWN_COUNTER"})(I||(I={}));function Pu(t,e,n){var r,i,o;return{name:t,type:e,description:(r=n==null?void 0:n.description)!==null&&r!==void 0?r:"",unit:(i=n==null?void 0:n.unit)!==null&&i!==void 0?i:"",valueType:(o=n==null?void 0:n.valueType)!==null&&o!==void 0?o:st.DOUBLE}}var Lu=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function Du(t){var e=t.map(function(){return 0});return e.push(0),{buckets:{boundaries:t,counts:e},sum:0,count:0,hasMinMax:!1,min:1/0,max:-1/0}}var Ct=function(){function t(e,n,r,i){r===void 0&&(r=!0),i===void 0&&(i=Du(n)),this.startTime=e,this._boundaries=n,this._recordMinMax=r,this._current=i}return t.prototype.record=function(e){this._current.count+=1,this._current.sum+=e,this._recordMinMax&&(this._current.min=Math.min(e,this._current.min),this._current.max=Math.max(e,this._current.max),this._current.hasMinMax=!0);for(var n=0;n<this._boundaries.length;n++)if(e<this._boundaries[n]){this._current.buckets.counts[n]+=1;return}this._current.buckets.counts[this._boundaries.length]+=1},t.prototype.setStartTime=function(e){this.startTime=e},t.prototype.toPointValue=function(){return this._current},t}(),Vr=function(){function t(e,n){this._boundaries=e,this._recordMinMax=n,this.kind=de.HISTOGRAM}return t.prototype.createAccumulation=function(e){return new Ct(e,this._boundaries,this._recordMinMax)},t.prototype.merge=function(e,n){for(var r=e.toPointValue(),i=n.toPointValue(),o=r.buckets.counts,a=i.buckets.counts,u=new Array(o.length),c=0;c<o.length;c++)u[c]=o[c]+a[c];var s=1/0,l=-1/0;return this._recordMinMax&&(r.hasMinMax&&i.hasMinMax?(s=Math.min(r.min,i.min),l=Math.max(r.max,i.max)):r.hasMinMax?(s=r.min,l=r.max):i.hasMinMax&&(s=i.min,l=i.max)),new Ct(e.startTime,r.buckets.boundaries,this._recordMinMax,{buckets:{boundaries:r.buckets.boundaries,counts:u},count:r.count+i.count,sum:r.sum+i.sum,hasMinMax:this._recordMinMax&&(r.hasMinMax||i.hasMinMax),min:s,max:l})},t.prototype.diff=function(e,n){for(var r=e.toPointValue(),i=n.toPointValue(),o=r.buckets.counts,a=i.buckets.counts,u=new Array(o.length),c=0;c<o.length;c++)u[c]=a[c]-o[c];return new Ct(n.startTime,r.buckets.boundaries,this._recordMinMax,{buckets:{boundaries:r.buckets.boundaries,counts:u},count:i.count-r.count,sum:i.sum-r.sum,hasMinMax:!1,min:1/0,max:-1/0})},t.prototype.toMetricData=function(e,n,r,i){return{descriptor:e,aggregationTemporality:n,dataPointType:Le.HISTOGRAM,dataPoints:r.map(function(o){var a=Lu(o,2),u=a[0],c=a[1],s=c.toPointValue(),l=e.type===I.UP_DOWN_COUNTER||e.type===I.OBSERVABLE_GAUGE||e.type===I.OBSERVABLE_UP_DOWN_COUNTER;return{attributes:u,startTime:c.startTime,endTime:i,value:{min:s.hasMinMax?s.min:void 0,max:s.hasMinMax?s.max:void 0,sum:l?void 0:s.sum,buckets:s.buckets,count:s.count}}})}},t}(),Uu=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},It=function(){function t(e,n,r){n===void 0&&(n=0),r===void 0&&(r=[0,0]),this.startTime=e,this._current=n,this.sampleTime=r}return t.prototype.record=function(e){this._current=e,this.sampleTime=vr()},t.prototype.setStartTime=function(e){this.startTime=e},t.prototype.toPointValue=function(){return this._current},t}(),xu=function(){function t(){this.kind=de.LAST_VALUE}return t.prototype.createAccumulation=function(e){return new It(e)},t.prototype.merge=function(e,n){var r=Ve(n.sampleTime)>=Ve(e.sampleTime)?n:e;return new It(e.startTime,r.toPointValue(),r.sampleTime)},t.prototype.diff=function(e,n){var r=Ve(n.sampleTime)>=Ve(e.sampleTime)?n:e;return new It(n.startTime,r.toPointValue(),r.sampleTime)},t.prototype.toMetricData=function(e,n,r,i){return{descriptor:e,aggregationTemporality:n,dataPointType:Le.GAUGE,dataPoints:r.map(function(o){var a=Uu(o,2),u=a[0],c=a[1];return{attributes:u,startTime:c.startTime,endTime:i,value:c.toPointValue()}})}},t}(),ku=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},me=function(){function t(e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1),this.startTime=e,this.monotonic=n,this._current=r,this.reset=i}return t.prototype.record=function(e){this.monotonic&&e<0||(this._current+=e)},t.prototype.setStartTime=function(e){this.startTime=e},t.prototype.toPointValue=function(){return this._current},t}(),Wn=function(){function t(e){this.monotonic=e,this.kind=de.SUM}return t.prototype.createAccumulation=function(e){return new me(e,this.monotonic)},t.prototype.merge=function(e,n){var r=e.toPointValue(),i=n.toPointValue();return n.reset?new me(n.startTime,this.monotonic,i,n.reset):new me(e.startTime,this.monotonic,r+i)},t.prototype.diff=function(e,n){var r=e.toPointValue(),i=n.toPointValue();return this.monotonic&&r>i?new me(n.startTime,this.monotonic,i,!0):new me(n.startTime,this.monotonic,i-r)},t.prototype.toMetricData=function(e,n,r,i){return{descriptor:e,aggregationTemporality:n,dataPointType:Le.SUM,dataPoints:r.map(function(o){var a=ku(o,2),u=a[0],c=a[1];return{attributes:u,startTime:c.startTime,endTime:i,value:c.toPointValue()}}),isMonotonic:this.monotonic}},t}(),pe=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),te=function(){function t(){}return t.Drop=function(){return jr},t.Sum=function(){return Fr},t.LastValue=function(){return Hr},t.Histogram=function(){return Xr},t.Default=function(){return Hu},t}(),Bu=function(t){pe(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.createAggregator=function(n){return e.DEFAULT_INSTANCE},e.DEFAULT_INSTANCE=new Mu,e}(te),Gu=function(t){pe(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.createAggregator=function(n){switch(n.type){case I.COUNTER:case I.OBSERVABLE_COUNTER:case I.HISTOGRAM:return e.MONOTONIC_INSTANCE;default:return e.NON_MONOTONIC_INSTANCE}},e.MONOTONIC_INSTANCE=new Wn(!0),e.NON_MONOTONIC_INSTANCE=new Wn(!1),e}(te),Vu=function(t){pe(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.createAggregator=function(n){return e.DEFAULT_INSTANCE},e.DEFAULT_INSTANCE=new xu,e}(te),ju=function(t){pe(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.createAggregator=function(n){return e.DEFAULT_INSTANCE},e.DEFAULT_INSTANCE=new Vr([0,5,10,25,50,75,100,250,500,1e3],!0),e}(te);(function(t){pe(e,t);function e(n,r){r===void 0&&(r=!0);var i=t.call(this)||this;if(i._recordMinMax=r,n===void 0||n.length===0)throw new Error("HistogramAggregator should be created with boundaries.");n=n.concat(),n=n.sort(function(u,c){return u-c});var o=n.lastIndexOf(-1/0),a=n.indexOf(1/0);return a===-1&&(a=void 0),i._boundaries=n.slice(o+1,a),i}return e.prototype.createAggregator=function(n){return new Vr(this._boundaries,this._recordMinMax)},e})(te);var Fu=function(t){pe(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype._resolve=function(n){switch(n.type){case I.COUNTER:case I.UP_DOWN_COUNTER:case I.OBSERVABLE_COUNTER:case I.OBSERVABLE_UP_DOWN_COUNTER:return Fr;case I.OBSERVABLE_GAUGE:return Hr;case I.HISTOGRAM:return Xr}return _.warn("Unable to recognize instrument type: "+n.type),jr},e.prototype.createAggregator=function(n){return this._resolve(n).createAggregator(n)},e}(te),jr=new Bu,Fr=new Gu,Hr=new Vu,Xr=new ju,Hu=new Fu,Xu=function(t){return te.Default()},Ku=function(t){return ut.CUMULATIVE},wt=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(l){try{s(r.next(l))}catch(f){a(f)}}function c(l){try{s(r.throw(l))}catch(f){a(f)}}function s(l){l.done?o(l.value):i(l.value).then(u,c)}s((r=r.apply(t,e||[])).next())})},Nt=function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(s){return function(l){return c([s,l])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=s[0]&2?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=e.call(t,n)}catch(l){s=[6,l],i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Wu=function(){function t(e){var n,r;this._shutdown=!1,this._aggregationSelector=(n=e==null?void 0:e.aggregationSelector)!==null&&n!==void 0?n:Xu,this._aggregationTemporalitySelector=(r=e==null?void 0:e.aggregationTemporalitySelector)!==null&&r!==void 0?r:Ku}return t.prototype.setMetricProducer=function(e){if(this._metricProducer)throw new Error("MetricReader can not be bound to a MeterProvider again.");this._metricProducer=e,this.onInitialized()},t.prototype.selectAggregation=function(e){return this._aggregationSelector(e)},t.prototype.selectAggregationTemporality=function(e){return this._aggregationTemporalitySelector(e)},t.prototype.onInitialized=function(){},t.prototype.collect=function(e){return wt(this,void 0,void 0,function(){return Nt(this,function(n){if(this._metricProducer===void 0)throw new Error("MetricReader is not bound to a MetricProducer");if(this._shutdown)throw new Error("MetricReader is shutdown");return[2,this._metricProducer.collect({timeoutMillis:e==null?void 0:e.timeoutMillis})]})})},t.prototype.shutdown=function(e){return wt(this,void 0,void 0,function(){return Nt(this,function(n){switch(n.label){case 0:return this._shutdown?(_.error("Cannot call shutdown twice."),[2]):(e==null?void 0:e.timeoutMillis)!=null?[3,2]:[4,this.onShutdown()];case 1:return n.sent(),[3,4];case 2:return[4,qt(this.onShutdown(),e.timeoutMillis)];case 3:n.sent(),n.label=4;case 4:return this._shutdown=!0,[2]}})})},t.prototype.forceFlush=function(e){return wt(this,void 0,void 0,function(){return Nt(this,function(n){switch(n.label){case 0:return this._shutdown?(_.warn("Cannot forceFlush on already shutdown MetricReader."),[2]):(e==null?void 0:e.timeoutMillis)!=null?[3,2]:[4,this.onForceFlush()];case 1:return n.sent(),[2];case 2:return[4,qt(this.onForceFlush(),e.timeoutMillis)];case 3:return n.sent(),[2]}})})},t}(),Yu=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Xe=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(l){try{s(r.next(l))}catch(f){a(f)}}function c(l){try{s(r.throw(l))}catch(f){a(f)}}function s(l){l.done?o(l.value):i(l.value).then(u,c)}s((r=r.apply(t,e||[])).next())})},Ke=function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(s){return function(l){return c([s,l])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=s[0]&2?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=e.call(t,n)}catch(l){s=[6,l],i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},zu=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},$u=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};(function(t){Yu(e,t);function e(n){var r,i,o,a,u=t.call(this,{aggregationSelector:(r=n.exporter.selectAggregation)===null||r===void 0?void 0:r.bind(n.exporter),aggregationTemporalitySelector:(i=n.exporter.selectAggregationTemporality)===null||i===void 0?void 0:i.bind(n.exporter)})||this;if(n.exportIntervalMillis!==void 0&&n.exportIntervalMillis<=0)throw Error("exportIntervalMillis must be greater than 0");if(n.exportTimeoutMillis!==void 0&&n.exportTimeoutMillis<=0)throw Error("exportTimeoutMillis must be greater than 0");if(n.exportTimeoutMillis!==void 0&&n.exportIntervalMillis!==void 0&&n.exportIntervalMillis<n.exportTimeoutMillis)throw Error("exportIntervalMillis must be greater than or equal to exportTimeoutMillis");return u._exportInterval=(o=n.exportIntervalMillis)!==null&&o!==void 0?o:6e4,u._exportTimeout=(a=n.exportTimeoutMillis)!==null&&a!==void 0?a:3e4,u._exporter=n.exporter,u}return e.prototype._runOnce=function(){return Xe(this,void 0,void 0,function(){var n,r,i,o,a=this;return Ke(this,function(u){switch(u.label){case 0:return[4,this.collect({})];case 1:return n=u.sent(),r=n.resourceMetrics,i=n.errors,i.length>0&&(o=_).error.apply(o,$u(["PeriodicExportingMetricReader: metrics collection errors"],zu(i),!1)),[2,new Promise(function(c,s){a._exporter.export(r,function(l){var f;l.code!==J.SUCCESS?s((f=l.error)!==null&&f!==void 0?f:new Error("PeriodicExportingMetricReader: metrics export failed (error "+l.error+")")):c()})})]}})})},e.prototype.onInitialized=function(){var n=this;this._interval=setInterval(function(){return Xe(n,void 0,void 0,function(){var r;return Ke(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,qt(this._runOnce(),this._exportTimeout)];case 1:return i.sent(),[3,3];case 2:return r=i.sent(),r instanceof Gr?(_.error("Export took longer than %s milliseconds and timed out.",this._exportTimeout),[2]):(Ro(r),[3,3]);case 3:return[2]}})})},this._exportInterval),this._interval},e.prototype.onForceFlush=function(){return Xe(this,void 0,void 0,function(){return Ke(this,function(n){switch(n.label){case 0:return[4,this._exporter.forceFlush()];case 1:return n.sent(),[2]}})})},e.prototype.onShutdown=function(){return Xe(this,void 0,void 0,function(){return Ke(this,function(n){switch(n.label){case 0:return this._interval&&clearInterval(this._interval),[4,this._exporter.shutdown()];case 1:return n.sent(),[2]}})})},e})(Wu);var ve=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),cn=function(){function t(e,n){this._writableMetricStorage=e,this._descriptor=n}return t.prototype._record=function(e,n,r){n===void 0&&(n={}),r===void 0&&(r=ee.active()),this._descriptor.valueType===st.INT&&!Number.isInteger(e)&&(_.warn("INT value type cannot accept a floating-point value for "+this._descriptor.name+", ignoring the fractional digits."),e=Math.trunc(e)),this._writableMetricStorage.record(e,n,r,vr())},t}();(function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(n,r,i){this._record(n,r,i)},e})(cn);(function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(n,r,i){if(n<0){_.warn("negative value provided to counter "+this._descriptor.name+": "+n);return}this._record(n,r,i)},e})(cn);(function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(n,r,i){if(n<0){_.warn("negative value provided to histogram "+this._descriptor.name+": "+n);return}this._record(n,r,i)},e})(cn);var ln=function(){function t(e,n,r){this._observableRegistry=r,this._descriptor=e,this._metricStorages=n}return t.prototype.addCallback=function(e){this._observableRegistry.addCallback(e,this)},t.prototype.removeCallback=function(e){this._observableRegistry.removeCallback(e,this)},t}();(function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(ln);(function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(ln);(function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(ln);var Kr=function(){function t(e){this._instrumentDescriptor=e}return t.prototype.getInstrumentDescriptor=function(){return this._instrumentDescriptor},t.prototype.updateDescription=function(e){this._instrumentDescriptor=Pu(this._instrumentDescriptor.name,this._instrumentDescriptor.type,{description:e,valueType:this._instrumentDescriptor.valueType,unit:this._instrumentDescriptor.unit})},t}(),qu=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Yn=function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(s){return function(l){return c([s,l])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=s[0]&2?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=e.call(t,n)}catch(l){s=[6,l],i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Ju=function(){function t(e){this._hash=e,this._valueMap=new Map,this._keyMap=new Map}return t.prototype.get=function(e,n){return n??(n=this._hash(e)),this._valueMap.get(n)},t.prototype.getOrDefault=function(e,n){var r=this._hash(e);if(this._valueMap.has(r))return this._valueMap.get(r);var i=n();return this._keyMap.has(r)||this._keyMap.set(r,e),this._valueMap.set(r,i),i},t.prototype.set=function(e,n,r){r??(r=this._hash(e)),this._keyMap.has(r)||this._keyMap.set(r,e),this._valueMap.set(r,n)},t.prototype.has=function(e,n){return n??(n=this._hash(e)),this._valueMap.has(n)},t.prototype.keys=function(){var e,n;return Yn(this,function(r){switch(r.label){case 0:e=this._keyMap.entries(),n=e.next(),r.label=1;case 1:return n.done===!0?[3,3]:[4,[n.value[1],n.value[0]]];case 2:return r.sent(),n=e.next(),[3,1];case 3:return[2]}})},t.prototype.entries=function(){var e,n;return Yn(this,function(r){switch(r.label){case 0:e=this._valueMap.entries(),n=e.next(),r.label=1;case 1:return n.done===!0?[3,3]:[4,[this._keyMap.get(n.value[0]),n.value[1],n.value[0]]];case 2:return r.sent(),n=e.next(),[3,1];case 3:return[2]}})},Object.defineProperty(t.prototype,"size",{get:function(){return this._valueMap.size},enumerable:!1,configurable:!0}),t}(),Ie=function(t){qu(e,t);function e(){return t.call(this,Nu)||this}return e}(Ju),Qu=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Wr=function(){function t(e){this._aggregator=e,this._activeCollectionStorage=new Ie,this._cumulativeMemoStorage=new Ie}return t.prototype.record=function(e,n,r,i){var o=this,a=this._activeCollectionStorage.getOrDefault(n,function(){return o._aggregator.createAccumulation(i)});a==null||a.record(e)},t.prototype.batchCumulate=function(e,n){var r=this;Array.from(e.entries()).forEach(function(i){var o=Qu(i,3),a=o[0],u=o[1],c=o[2],s=r._aggregator.createAccumulation(n);s==null||s.record(u);var l=s;if(r._cumulativeMemoStorage.has(a,c)){var f=r._cumulativeMemoStorage.get(a,c);l=r._aggregator.diff(f,s)}r._cumulativeMemoStorage.set(a,s,c),r._activeCollectionStorage.set(a,l,c)})},t.prototype.collect=function(){var e=this._activeCollectionStorage;return this._activeCollectionStorage=new Ie,e},t}(),zn=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},$n=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Yr=function(){function t(e){this._aggregator=e,this._unreportedAccumulations=new Map,this._reportHistory=new Map}return t.prototype.buildMetrics=function(e,n,r,i,o){this._stashAccumulations(n,i);var a=this._getMergedUnreportedAccumulations(e),u=a,c;if(this._reportHistory.has(e)){var s=this._reportHistory.get(e),l=s.collectionTime;c=s.aggregationTemporality,c===ut.CUMULATIVE?u=t.merge(s.accumulations,a,this._aggregator):u=t.calibrateStartTime(s.accumulations,a,l)}else c=e.selectAggregationTemporality(r.type);return this._reportHistory.set(e,{accumulations:u,collectionTime:o,aggregationTemporality:c}),this._aggregator.toMetricData(r,c,Zu(u),o)},t.prototype._stashAccumulations=function(e,n){var r=this;e.forEach(function(i){var o=r._unreportedAccumulations.get(i);o===void 0&&(o=[],r._unreportedAccumulations.set(i,o)),o.push(n)})},t.prototype._getMergedUnreportedAccumulations=function(e){var n,r,i=new Ie,o=this._unreportedAccumulations.get(e);if(this._unreportedAccumulations.set(e,[]),o===void 0)return i;try{for(var a=zn(o),u=a.next();!u.done;u=a.next()){var c=u.value;i=t.merge(i,c,this._aggregator)}}catch(s){n={error:s}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i},t.merge=function(e,n,r){for(var i=e,o=n.entries(),a=o.next();a.done!==!0;){var u=$n(a.value,3),c=u[0],s=u[1],l=u[2];if(e.has(c,l)){var f=e.get(c,l),d=r.merge(f,s);i.set(c,d,l)}else i.set(c,s,l);a=o.next()}return i},t.calibrateStartTime=function(e,n,r){var i,o;try{for(var a=zn(e.keys()),u=a.next();!u.done;u=a.next()){var c=$n(u.value,2),s=c[0],l=c[1],f=n.get(s,l);f==null||f.setStartTime(r)}}catch(d){i={error:d}}finally{try{u&&!u.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}return n},t}();function Zu(t){return Array.from(t.entries())}var ec=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),tc=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};(function(t){ec(e,t);function e(n,r,i){var o=t.call(this,n)||this;return o._attributesProcessor=i,o._deltaMetricStorage=new Wr(r),o._temporalMetricStorage=new Yr(r),o}return e.prototype.record=function(n,r){var i=this,o=new Ie;Array.from(n.entries()).forEach(function(a){var u=tc(a,2),c=u[0],s=u[1];o.set(i._attributesProcessor.process(c),s)}),this._deltaMetricStorage.batchCumulate(o,r)},e.prototype.collect=function(n,r,i){var o=this._deltaMetricStorage.collect();return this._temporalMetricStorage.buildMetrics(n,r,this._instrumentDescriptor,o,i)},e})(Kr);var nc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();(function(t){nc(e,t);function e(n,r,i){var o=t.call(this,n)||this;return o._attributesProcessor=i,o._deltaMetricStorage=new Wr(r),o._temporalMetricStorage=new Yr(r),o}return e.prototype.record=function(n,r,i,o){r=this._attributesProcessor.process(r,i),this._deltaMetricStorage.record(n,r,i,o)},e.prototype.collect=function(n,r,i){var o=this._deltaMetricStorage.collect();return this._temporalMetricStorage.buildMetrics(n,r,this._instrumentDescriptor,o,i)},e})(Kr);var zr=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),$r=function(){function t(){}return t.Noop=function(){return ic},t}(),rc=function(t){zr(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.process=function(n,r){return n},e}($r);(function(t){zr(e,t);function e(n){var r=t.call(this)||this;return r._allowedAttributeNames=n,r}return e.prototype.process=function(n,r){var i=this,o={};return Object.keys(n).filter(function(a){return i._allowedAttributeNames.includes(a)}).forEach(function(a){return o[a]=n[a]}),o},e})($r);var ic=new rc,oc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Jt="v1/traces",ac="http://localhost:4318/"+Jt,sc=function(t){oc(e,t);function e(n){n===void 0&&(n={});var r=t.call(this,n)||this;return r._headers=Object.assign(r._headers,_r(F().OTEL_EXPORTER_OTLP_TRACES_HEADERS)),r}return e.prototype.convert=function(n){return uu(n,!0)},e.prototype.getDefaultUrl=function(n){return typeof n.url=="string"?n.url:F().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT.length>0?Ws(F().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT,Jt):F().OTEL_EXPORTER_OTLP_ENDPOINT.length>0?Ks(F().OTEL_EXPORTER_OTLP_ENDPOINT,Jt):ac},e}(tu),qn="http://localhost:4318/v1/traces",Te=function(){var t,e;return{init:function(n){var r;e||(n.url=n.url||qn,n.webSDKVersion=n.webSDKVersion||"unknown",t=new Fs({resource:new zo((r={},r[M.SERVICE_NAME]="smwebsdk",r[M.SERVICE_VERSION]=n.webSDKVersion,r))}),t.addSpanProcessor(new Dr(new sc({url:n.url,headers:{Authorization:"Bearer "+n.jwt}}))),t.register(),e=t.getTracer("smwebsdk"))},isInitialized:function(){return!!e},getTracer:function(){return e},defaultUrl:qn}}();Object.freeze(Te);var uc=typeof process<"u"&&"15.7.0"||"unknown";function cc(t){return new Promise(function(e){return setTimeout(function(){return e()},t)})}var lc=50,fc=200,dc=1;function _c(t,e,n){return e===void 0&&(e={}),T(this,void 0,void 0,function(){var r,i,o,a,u,c;return S(this,function(s){switch(s.label){case 0:r=[],i=e.maxRetries||lc,o=e.delayMs||fc,u=0,s.label=1;case 1:if(!(u<i))return[3,8];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,t()];case 3:return a=s.sent(),n.connectionResult={message:"success",value:a,retries:r},[3,6];case 4:if(c=s.sent(),r.push(c),n.connectionResult={message:"failed",retries:r},c instanceof Error&&c.name==="noSessionToResume"&&Qe(),!(c instanceof Error)||c.name!=="noScene")throw c;if(r.length===i)throw console.warn("Retry gave up after ".concat(i,` retries:
`).concat(r.map(function(l){return l instanceof Error?l.message:l.toString()}).join(`
`))),c;return[4,cc(o)];case 5:return s.sent(),[3,7];case 6:return[3,8];case 7:return u++,[3,1];case 8:return[2,a]}})})}function hc(t,e,n){sessionStorage.setItem("sm-server",t),sessionStorage.setItem("sm-session-id",e),sessionStorage.setItem("sm-api-key",n)}function Jn(){return{server:sessionStorage.getItem("sm-server"),resumeSessionId:sessionStorage.getItem("sm-session-id"),savedApiKey:sessionStorage.getItem("sm-api-key")}}function Qe(){sessionStorage.removeItem("sm-server"),sessionStorage.removeItem("sm-session-id"),sessionStorage.removeItem("sm-api-key")}var qr=function(){function t(e,n,r,i,o,a,u){n===void 0&&(n=!1),r===void 0&&(r=p.MicrophoneAndCamera),i===void 0&&(i=p.Microphone);var c=this;if(this._onConversationResultEvents={},this._onSpeechMarkerEvents={},this._session=void 0,this._isWebSocketOnly=!1,this._transactionId=0,this._pendingResponses={},this._microphoneUnmuteTimer=void 0,this._echoCancellationEnabled=!0,this._serverControlledCameras=!1,this._stopSpeakingWhenNotVisible=!0,this._loggingConfig={session:{},contentAwareness:{}},this._logger=new H,this._tracerOptions={disableTracing:!1,parentCtx:z,url:Te.defaultUrl},this._sessionResumeEnabled=!1,this._isResumedSession=!1,this._sendMetadata={pageUrl:!1},this._onMicrophoneActive=new P,this._onCameraActive=new P,this.currentPersonaId=dc,this.version={webSdk:uc,platformSdk:"unknown"},this.iosVisibilityChange=function(){var f=document.visibilityState==="visible";setTimeout(function(){c._session&&c._session.sendRtcEvent("ui",{visible:f})},500)},this.stopSpeakingWhenNotVisible=function(){document.visibilityState!=="visible"&&c.sendRequest("stopSpeaking",{personaId:c.currentPersonaId})},this.stopSpeakingWhenUnloaded=function(){c.sendRequest("stopSpeaking",{personaId:c.currentPersonaId})},this.isSceneOptions(e)){var s=e;this._videoElement=s.videoElement,this._apiKey=s.apiKey,this._audioOnly=s.audioOnly||n,s.stopSpeakingWhenNotVisible===!1&&(this._stopSpeakingWhenNotVisible=!1),this._requestedUserMedia=An(s.requestedMediaDevices,r),this._requiredUserMedia=An(s.requiredMediaDevices,i),this.contentAwarenessDebounceTime=s.contentAwarenessDebounceTime,this._loggingConfig=x(x({},this._loggingConfig),s.loggingConfig||{}),s.sendMetadata&&(this._sendMetadata=s.sendMetadata),s.tracerOptions&&(this._tracerOptions=s.tracerOptions)}else this._videoElement=e,this._audioOnly=n,this._requestedUserMedia=r,this._requiredUserMedia=i,this.contentAwarenessDebounceTime=o,this._loggingConfig=x(x({},this._loggingConfig),a),u&&(this._tracerOptions=u);this._logger=new H(this._loggingConfig.session.minLogLevel,this._loggingConfig.session.enabled),this._onStateEvent=new P,this._onStateEvent.addListener(function(f,d){c._onState&&c._onState(f,d)}),this._onRecognizeResultsEvent=new P,this._onRecognizeResultsEvent.addListener(function(f,d,h,v){c._onRecognizeResults&&c._onRecognizeResults(f,d,h,v)}),this._onDisconnectedEvent=new P,this._onDisconnectedEvent.addListener(function(f,d,h){Qe(),c.cleanupEventListeners(),c._onDisconnected&&c._onDisconnected(f,d,h)}),this._onUserTextEvent=new P,this._onUserTextEvent.addListener(function(f,d){c._onUserText&&c._onUserText(f,d)}),this._onDemoModeEvent=new P,this._underRuntimeHost=!!window.SmIsUnderRuntimeHost;var l=new Uint32Array(3);window.crypto.getRandomValues(l),this._sceneId=l.toString().replace(/,/g,"-"),this.conversation=new vo,this.connectionState=new go,this._metadataSender=new Eo(this),this._logger.log("debug","websdk version:",this.version.webSdk)}return t.prototype.isSceneOptions=function(e){var n=!!e,r=!!(e!=null&&e.tagName);return n&&!r},t.prototype.connectionValid=function(){return!!(this._underRuntimeHost||this._session&&this._session.serverConnection)},t.prototype.isConnected=function(){return!!(this.connectionValid()&&this._session&&this._session.serverConnection&&this._session.serverConnection.readyState===this._session.serverConnection.OPEN)},t.prototype.keepAlive=function(){this._session&&this._session.peerConnection!==null&&this._session.sendRtcEvent("keepAlive",{})},t.prototype.disconnect=function(){var e,n;Qe(),this.cleanupEventListeners(),this.connectionState.reset(),this.conversation.reset(),(e=this.contentAwareness)===null||e===void 0||e.disconnect(),this._metadataSender.disconnect(),(n=this._session)===null||n===void 0||n.close(!0),this._session=void 0},t.prototype.connect=function(e,n,r,i){var o,a,u;return T(this,void 0,void 0,function(){var c,s,l,f,d,h,v,y,O,b,A,C,w=this;return S(this,function(R){switch(R.label){case 0:return c=Date.now(),s=this.connectArgsToConfig(e,n,r,i),f=function(E){l==null||l.addEvent(E.name)},this.connectionState.onConnectionStateUpdated.addListener(f),this._underRuntimeHost?(this._session=new ti(this._videoElement,this._logger),[3,8]):[3,1];case 1:if(d=s.tokenServerUri||s.tokenServerAccessToken,this._apiKey&&d&&this._logger.log("warn","You are trying to connect via an API key and a token server. Please use one or the other"),!(this._apiKey&&!d))return[3,6];R.label=2;case 2:return R.trys.push([2,5,,6]),[4,this.fetchAuthConfig(this._apiKey)];case 3:return h=R.sent(),[4,h.json()];case 4:return v=R.sent(),y=Jn().server,s.tokenServerUri=v.url,s.tokenServerAccessToken=v.jwt,y&&(s.tokenServerUri=Rn(v.url)+"server/"+y),[3,6];case 5:throw O=R.sent(),O instanceof Error&&O.message==="Broken API key"?this._logger.log("error","Broken API key. Please check your key or re copy the key from DDNA Studio."):this._logger.log("error","Invalid API key: Please check your key configuration in DDNA Studio. For more information click here https://soulmachines-support.atlassian.net/wiki/spaces/SSAS/pages/1320058919/Connecting+Using+API+Keys#Troubleshooting"),m("Invalid API key","serverConnectionFailed");case 6:if(!s.tokenServerUri||!s.tokenServerAccessToken)throw m("Please authenticate via an API key or with a serverUri and accessToken","serverConnectionFailed");return[4,this.initializeTracer(s.tokenServerUri,s.tokenServerAccessToken)];case 7:b=R.sent(),A=b.initTracerStartTime,C=b.initTracerEndTime,l=(u=(a=(o=Te.getTracer())===null||o===void 0?void 0:o.startSpan("createSessionAndConnect"))===null||a===void 0?void 0:a.setAttribute("sm.websdk.connection.pretraceinitduration.milliseconds",A-c))===null||u===void 0?void 0:u.setAttribute("sm.websdk.connection.traceinitduration.milliseconds",C-A),this._isWebSocketOnly?this._session=new ii(s.tokenServerUri,s.tokenServerAccessToken,this._logger):this._session=new ri(this._videoElement,s.tokenServerUri,s.userText,s.tokenServerAccessToken,this._audioOnly,this._requestedUserMedia,this._requiredUserMedia,this._echoCancellationEnabled,this._logger,this.connectionState),R.label=8;case 8:if(!this._session)throw m("Failed to create session","unknown");return this._session.onConnected=this.sessionConnected.bind(this),this._session.onMessage=this.onMessage.bind(this),this._session.onClose=this.sessionClosed.bind(this),this._session.onUserText=this.rtcUserText.bind(this),"microphoneActiveCallbacks"in this._session&&(this._session.microphoneActiveCallbacks=this._onMicrophoneActive),"cameraActiveCallbacks"in this._session&&(this._session.cameraActiveCallbacks=this._onCameraActive),this._session.features.isIos&&document.addEventListener("visibilitychange",this.iosVisibilityChange),[4,_c(function(){return T(w,void 0,void 0,function(){return S(this,function(E){switch(E.label){case 0:return[4,this._session.connect()];case 1:return[2,E.sent()]}})})},s.retryOptions,this).finally(function(){w.connectionState.onConnectionStateUpdated.removeListener(f),l==null||l.end()})];case 9:return[2,R.sent()]}})})},t.prototype.initializeTracer=function(e,n){return T(this,void 0,void 0,function(){var r,i,o;return S(this,function(a){switch(a.label){case 0:if(r=Date.now(),!(!this._tracerOptions.disableTracing&&!Te.isInitialized()))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.initTelemetryToken({tokenServerUri:e,authToken:n})];case 2:return a.sent(),[3,4];case 3:return i=a.sent(),o="Could not initialize tracer telemetry token: ",i instanceof ReferenceError&&i.message==="fetch is not defined"?this._logger.log("debug",o+i.name+": "+i.message):i instanceof Error?this._logger.log("warn",o+i.name+": "+i.message):this._logger.log("warn",o+"unknown error type"),[3,4];case 4:return[2,{initTracerStartTime:r,initTracerEndTime:Date.now()}]}})})},t.prototype.initTelemetryToken=function(e){var n=e.tokenServerUri,r=e.authToken;return T(this,void 0,void 0,function(){var i,o,a,u,c;return S(this,function(s){switch(s.label){case 0:return i="api/telemetry/jwt",o="api/telemetry/v1/traces",a=Rn(_o(n)),a?[4,fetch(a+i,{headers:{Authorization:"Bearer "+r}})]:(this._logger.log("debug","Could not initialize tracer telemetry token: invalid token server URI"),[2]);case 1:return u=s.sent(),u?u.ok?[4,u.json()]:(this._logger.log("warn","Failed to fetch otel token: "+u.status+": "+u.statusText),[2]):(this._logger.log("warn","Failed to receive response from otel token endpoint"),[2]);case 2:if(c=s.sent(),!c.success)return this._logger.log("warn","Failed: otel response not successful"),[2];try{Te.init({jwt:c.telemetryJwt,url:a+o,webSDKVersion:this.version.webSdk}),this._logger.log("log","Telemetry initialized")}catch(l){l instanceof Error?this._logger.log("warn","Failed to initialize tracer: "+l.message):this._logger.log("warn","Failed to initialize tracer: unknown error")}return[2]}})})},t.prototype.onMessage=function(e){var n=e.category;if(n==="scene"){var r=e;this.onSceneMessage(r);return}},t.prototype.sendOnewaySceneRequest=function(e,n){if(this._session){var r={name:e,body:n,category:et.Scene,kind:Oe.Request};this._session.sendMessage(r)}},t.prototype.sendRequest=function(e,n){var r=this;return n===void 0&&(n={}),new Promise(function(i,o){if(!r._session){o(m("No session available","noSession"));return}var a=r._sceneId+"_"+ ++r._transactionId,u={transaction:a,name:e,body:n,category:et.Scene,kind:Oe.Request},c={resolve:i,reject:o};r._pendingResponses[a]=c,r._session&&r._session.sendMessage(u)})},t.prototype.onSceneMessage=function(e){var n,r,i,o=e.name,a=e.body,u=e.kind,c=e.status,s=e.transaction;if(a&&o==="state"){var l=a;this._onStateEvent.call(this,l),!((n=l.scene)===null||n===void 0)&&n.featureFlags&&this.enableFlaggedFeatures(l.scene.featureFlags),!((r=l.scene)===null||r===void 0)&&r.sdkVersion&&(this.version.platformSdk=(i=l.scene)===null||i===void 0?void 0:i.sdkVersion,this._logger.log("debug","platformSdk version:",this.version.platformSdk)),this.conversation.processStateMessage(l),this.controlMicrophoneMute(a)}else if(a&&o==="recognizeResults"){var f=a,d=f.status,h=f.errorMessage,v=f.results;this.conversation.processRecognizeResultsMessage(a),this._onRecognizeResultsEvent.call(this,d,h,v)}else if(a&&o==="conversationResult"){this.conversation.onConversationResult(a);var y=a.personaId;if(y){var O=new Ze(this,y),b=this._onConversationResultEvents[y];b.call(O,a),this.currentPersonaId=y}}else if(a&&o==="speechMarker"){this.conversation.onSpeechMarker(a);var y=a.personaId;if(y){var O=new Ze(this,y),A=this._onSpeechMarkerEvents[y];A.call(O,a),this.currentPersonaId=y}}else a&&o==="demoMode"&&this._onDemoModeEvent.call(this,a);u===Oe.Response&&s&&this.processResponse(a,o,c,s)},t.prototype.processResponse=function(e,n,r,i){var o=this._pendingResponses[i];if(o){if(r===0)o.resolve(e);else{var a=new ni;a.requestName=n,a.status=r,a.responseBody=e,o.reject(a)}delete this._pendingResponses[i]}},t.prototype.controlMicrophoneMute=function(e){var n=this;if(e.persona&&this._session&&this._session.microphoneMuteDelay!==-1)for(var r in e.persona){var i=e.persona[r];i.speechState&&(i.speechState===we.Speaking?(this._session.microphoneMuted||(this._logger.log("warn","Persona is speaking - mute microphone"),this._session.microphoneMuted=!0),this._microphoneUnmuteTimer&&(clearTimeout(this._microphoneUnmuteTimer),this._microphoneUnmuteTimer=void 0)):this._session.microphoneMuted&&!this._microphoneUnmuteTimer&&(this._microphoneUnmuteTimer=setTimeout(function(){!n._session||!n._microphoneUnmuteTimer||(n._logger.log("warn","Persona is no longer speaking - unmute microphone"),n._session.microphoneMuted=!1,n._microphoneUnmuteTimer=void 0)},this._session.microphoneMuteDelay)))}},t.prototype.close=function(){this._session&&this._session.close(!0)},t.prototype.sessionConnected=function(e,n,r,i){this.contentAwareness=new Ii(this,this.contentAwarenessDebounceTime,new H(this._loggingConfig.contentAwareness.minLogLevel,this._loggingConfig.contentAwareness.enabled)),this._stopSpeakingWhenNotVisible&&document.addEventListener("visibilitychange",this.stopSpeakingWhenNotVisible),window.addEventListener("beforeunload",this.stopSpeakingWhenUnloaded),this._sendMetadata.pageUrl&&this._metadataSender.observeUrlChanges(),this._isResumedSession=n,e&&(this._sessionResumeEnabled=!0,hc(r,i,this._apiKey||"")),n&&this._sendMetadata.pageUrl&&this._metadataSender.send()},t.prototype.cleanupEventListeners=function(){var e;!((e=this._session)===null||e===void 0)&&e.features.isIos&&document.removeEventListener("visibilitychange",this.iosVisibilityChange),this._stopSpeakingWhenNotVisible&&document.removeEventListener("visibilitychange",this.stopSpeakingWhenNotVisible),window.removeEventListener("beforeunload",this.stopSpeakingWhenUnloaded)},t.prototype.sessionClosed=function(e){Qe(),this.cleanupEventListeners(),this._session&&(this.connectionState.reset(),this.conversation.reset(),this._onDisconnectedEvent.call(this,this._session.sessionId,e))},t.prototype.rtcUserText=function(e){this._onUserTextEvent.call(this,e)},t.prototype.enableFlaggedFeatures=function(e){this._serverControlledCameras=e.includes(xt.UI_SDK_CAMERA_CONTROL)},t.prototype.sendContent=function(){var e;this.contentAwareness||console.warn("ContentAwareness is not enabled for this project"),(e=this.contentAwareness)===null||e===void 0||e.measure()},t.prototype.sendVideoBounds=function(e,n){this._session&&this._session.sendVideoBounds(e,n)},t.prototype.configure=function(e){return this.sendRequest("configure",e)},t.prototype.sendUserText=function(e){this._session&&this._session.sendUserText(e)},t.prototype.startRecognize=function(e){var n={};return e!==void 0&&(n.audioSource=e),this.sendRequest("startRecognize",n)},t.prototype.stopRecognize=function(){return this.sendRequest("stopRecognize")},t.prototype.isMicrophoneConnected=function(){return this._session?this._session.isMicrophoneConnected:!1},t.prototype.isCameraConnected=function(){return this._session?this._session.isCameraConnected:!1},t.prototype.session=function(){return this._session},t.prototype.hasContentAwareness=function(){return!!this.contentAwareness},t.prototype.hasServerControlledCameras=function(){return this._serverControlledCameras},t.prototype.supportsSessionPersistence=function(){return this._sessionResumeEnabled},t.prototype.isResumedSession=function(){return this._isResumedSession},Object.defineProperty(t.prototype,"onConversationResultEvents",{get:function(){return this._onConversationResultEvents},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onSpeechMarkerEvents",{get:function(){return this._onSpeechMarkerEvents},enumerable:!1,configurable:!0}),t.prototype.getState=function(){return T(this,void 0,void 0,function(){return S(this,function(e){return[2,this.sendRequest("getState")]})})},Object.defineProperty(t.prototype,"onStateEvent",{get:function(){return this._onStateEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onState",{set:function(e){this._onState=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDisconnectedEvent",{get:function(){return this._onDisconnectedEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDisconnected",{set:function(e){this._onDisconnected=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRecognizeResultsEvent",{get:function(){return this._onRecognizeResultsEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRecognizeResults",{set:function(e){this._onRecognizeResults=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onUserTextEvent",{get:function(){return this._onUserTextEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"echoCancellationEnabled",{get:function(){return this._echoCancellationEnabled},set:function(e){this._echoCancellationEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDemoModeEvent",{get:function(){return this._onDemoModeEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoElement",{get:function(){return this._videoElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewerOffsetX",{get:function(){return this._session?this._session.offsetX:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewerOffsetY",{get:function(){return this._session?this._session.offsetY:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isWebSocketOnly",{get:function(){return this._isWebSocketOnly},set:function(e){this._isWebSocketOnly=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMicrophoneActive",{get:function(){return this._onMicrophoneActive},enumerable:!1,configurable:!0}),t.prototype.isMicrophoneActive=function(){var e;return!!(!((e=this._session)===null||e===void 0)&&e.isMicrophoneActive())},Object.defineProperty(t.prototype,"onCameraActive",{get:function(){return this._onCameraActive},enumerable:!1,configurable:!0}),t.prototype.isCameraActive=function(){var e;return!!(!((e=this._session)===null||e===void 0)&&e.isCameraActive())},t.prototype.setMediaDeviceActive=function(e){var n;return T(this,void 0,void 0,function(){return S(this,function(r){switch(r.label){case 0:return this.isConnected()?[4,(n=this._session)===null||n===void 0?void 0:n.setMediaDeviceActive({microphone:e.microphone,camera:e.camera})]:[3,2];case 1:return r.sent(),[3,3];case 2:throw m("Connection has not been established","noConnection");case 3:return[2]}})})},t.prototype.startVideo=function(e){return T(this,void 0,void 0,function(){var n;return S(this,function(r){switch(r.label){case 0:if(n=e||this._videoElement,!n)throw m("Cannot find HTMLVideoElement","noVideoElement");return[4,this.playVideo(n)];case 1:return r.sent()?[2,{video:!0,audio:!0}]:(n.muted=!0,[4,this.playVideo(n)]);case 2:if(r.sent())return[2,{video:!0,audio:!1}];throw m("Cannot start media playback","userInteractionRequired")}})})},t.prototype.playVideo=function(e){return T(this,void 0,void 0,function(){return S(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e.play()];case 1:return n.sent(),[2,!0];case 2:return n.sent(),[2,!1];case 3:return[2]}})})},t.prototype.fetchAuthConfig=function(e){var n;try{var r=JSON.parse(atob(e));n=r.authServer}catch{throw m("Broken API key","Failed to decode api key")}var i=Jn(),o=i.server,a=i.resumeSessionId,u=i.savedApiKey;return o&&a&&u===e&&(n=n+"?sessionId="+a),fetch(n,{headers:{key:e}})},t.prototype.connectArgsToConfig=function(e,n,r,i){var o,a;return typeof e=="string"?{tokenServerUri:e,tokenServerAccessToken:r,userText:n,retryOptions:i}:{tokenServerUri:((o=e==null?void 0:e.tokenServer)===null||o===void 0?void 0:o.uri)||"",tokenServerAccessToken:(a=e==null?void 0:e.tokenServer)===null||a===void 0?void 0:a.token,userText:e==null?void 0:e.userText,retryOptions:e==null?void 0:e.retryOptions}},t.prototype.isLoggingEnabled=function(){return this._logger.isEnabled},t.prototype.getMinLogLevel=function(){return this._logger.getMinLogLevel()},t.prototype.setLogging=function(e){this._logger.enableLogging(e)},t.prototype.setMinLogLevel=function(e){this._logger.setMinLogLevel(e)},t}(),Qn;(function(t){t[t.none=0]="none",t[t.microphone=1]="microphone",t[t.microphoneAndCamera=2]="microphoneAndCamera",t[t.camera=3]="camera"})(Qn||(Qn={}));var pc=function(){function t(){this.Scene=qr,this.Persona=Ze,this.userMedia={none:p.None,microphone:p.Microphone,microphoneAndCamera:p.MicrophoneAndCamera,camera:p.Camera},this.DetectCapabilities=function(){return new ct().detectWebRTCFeatures()},this.setLogging=function(e){}}return t}();new pc;let _e,Mt=null;const vc="1";async function Ec(){const t=document.getElementById("sm-video");_e=new qr({apiKey:"eyJzb3VsSWQiOiJkZG5hLXNhbmctaGFuLS1kZW1vYXBwIiwiYXV0aFNlcnZlciI6Imh0dHBzOi8vZGguYXouc291bG1hY2hpbmVzLmNsb3VkL2FwaS9qd3QiLCJhdXRoVG9rZW4iOiJhcGlrZXlfdjFfMDllYTEyN2YtYjU2NS00ZjZmLWJmNTUtMTFjNTQwZjU1MmUwIn0=",videoElement:t,requestedMediaDevices:{microphone:!0,camera:!0},requiredMediaDevices:{microphone:!0,camera:!0}}),await _e.connect().then(e=>gc(e)).catch(e=>yc(e))}function gc(t){console.info("success! session id:",t),_e.startVideo().then(e=>console.info("started video with state:",e)).catch(e=>console.warn("could not start video:",e))}function yc(t){switch(t.name){case"noUserMedia":console.warn("user blocked device access");break;case"noScene":case"serverConnectionFailed":console.warn("server connection failed");break;default:console.warn("unhandled error:",t)}}const Zn=document.getElementById("connect-button");Zn.addEventListener("click",()=>{const t=document.getElementById("sm-video");Ec(),Zn.style.display="none",t.style.height="100%",t.style.width="100%"});function mc(){console.log("stopSpeaking"),Mt||(Mt=new Ze(_e,vc)),Mt.stopSpeaking()}function Tc(){console.log("toggleUserMicrophone");const t=_e.isMicrophoneActive();_e.setMediaDeviceActive({microphone:!t}).then(()=>console.log("microphone active: "+t)).catch(e=>console.log("microphone update failed: ",e))}function Sc(t){const e=t.key||String.fromCharCode(t.keyCode);console.log("Key Code:",t.keyCode),console.log("Key Value:",e),e==="Enter"?mc():e===" "&&Tc()}document.addEventListener("keydown",Sc);
